##JJ: For pilot, (1) search for "control" and insert a # in front of every line or group of lines which contain 
#(loadvalue(login.email, "group") = "control") - Done.
# (2) Change email content, times of signup and outcome email. Take out testing names in subject line. Hash out RCT 4- and 7-month outcome emails and pages - Done.
# (3) Make sure showing correct info and outcome pages - Done. When showing correct info page remember to change links to info1rct/pilot i.e. login link - Done.
# (4) Change randomnumber function in allocation - Done.
# (6) Change email and session release timings, med lock out timing and dmenuprogress timings back from test timings (JB timings). Search on original and testing. - Done.
# (7) Testing shortcuts to come out. Info1rct/pilot, Baseline1a/b, pmenu, p1p03, p2p02 (error message hashed out), p3p04 - Done.
# (8) Check texts are working - sendtext where it is in logic - Done.
# (9) Read through whole logic - Done.


#Before RCT
# (1) Test logic for controls before RCT - done
# (2) Un-hash logic for RCT - done & checked
# (3) Take out testing shortcuts - welcomerct, baseline1a, awelcome, p2p05, quitsmokingaccess, outcome1rct4pa; outcome1rct4pb; outcome2rct2pa; outcome2rct2pb; baseline1b
# (4) Check "email-names" are all removed - done  
# (5) Read through whole logic
# (6) Re-direct site links; set-up text messaging; put in proper name
#

#JJ: Logic below is for setting a variable to send emails out at 4am or release sessions at 4am after a delay of a specific no. of days
#JJ: 4 hrs x 60 x60 = 14400. This will be 4am on the current day.; JB "Timings"
set delay4am to + (midnight(), 14400, (-1 * currenttime()))
#JJ: 1 day (the next day at 4am)      100800 = 28 hours(24 + 4 hours) x 60 mins x 60 secs
set delay24 to + (midnight(), 100800, (-1 * currenttime()))
#JJ: 2 days
set delay48 to + (midnight(), 187200, (-1 * currenttime()))
#JJ: 3 days
set delay72 to + (midnight(), 273600, (-1 * currenttime()))
#JJ: 4 days
set delay96 to + (midnight(), 360000, (-1 * currenttime()))
#JJ: 5 days
set delay120 to + (midnight(), 446400, (-1 * currenttime()))
#JJ: 6 days
set delay144 to + (midnight(), 532800, (-1 * currenttime()))
#JJ: 7 days
set delay168 to + (midnight(), 619200, (-1 * currenttime()))
#JJ: 8 days
set delay192 to + (midnight(), 705600, (-1 * currenttime()))
#JJ: 10 days
set delay240 to + (midnight(), 878400, (-1 * currenttime()))


#JB Adding timing to invite for dialogue 1 - testing times here - should coincide with testing times for release of each of these sessions; JB "Timings"
set d01invitetime to ((+(loadvalue (username, "quitdate"), (100800)))-currenttime())
set d01r1invitetime to ((+(loadvalue (username, "quitdate"), (187200)))-currenttime())
set d01r2invitetime to ((+(loadvalue (username, "quitdate"), (360000)))-currenttime())

set s4invitetime to ((+(loadvalue (username, "quitdate"), (14400)))-currenttime())
set s4r1invitetime to ((+(loadvalue (username, "quitdate"), (54000)))-currenttime())

set s3invitetime to ((+(loadvalue (username, "quitdate"), (-72000)))-currenttime())
set s3r1invitetime to ((+(loadvalue (username, "quitdate"), (-32400)))-currenttime())

#Sign up - This section creates a new user, it also contains the logic for the login pages. After the user sees login 1 
#login01 they jump straight to the main dialogue section that starts "awelcome02"
Begin signingup

#JJ: Pilot intro and consent page
#show welcomepilot
#show info1pilot
#show info2pilot
#show info3pilot
#show info4pilot
#show info5pilot
#show consent1pilot
#show consent2pilot

#JJ: RCT intro and consent pages (not needed for pilot)
show welcomerct
show info1rct
show info2rct
show info3rct
show info4rct
show info5rct
show consent1rct
show consent2rct
##

show signup
set username to signup.email
if (not(isempty(signup.email)))set username to signup.email
if (not(isempty(login.email)))set username to login.email
makenewuser(signup.email, signup.password)
#setemail(signup.username, signup.email)
#set email to getemail(username)
savevalue (username, "email", signup.email) 
save signup.email for username 
save signup.first_name for username

#RCT - email content
sendemail("welcome", username, "Welcome to UCL's Quit Smoking Internet Study", append ("Hello ",signup.first_name,",\n\nWelcome to UCL's Quit Smoking Internet Study\n\nThank you for ",...
			"agreeing to participate. You have agreed to use a stop-smoking website to help you make a serious attempt to stop smoking within the next month.\n\nBelow we provide you with a copy of your ",...
			"information and consent forms. Please email us on stopsmoking@ucl.ac.uk if you have any problems during the study.\n\nBest wishes,\n\nProfessor Robert West and Professor ",...
			"Susan Michie\n\nParticipant information:\n\n1. Purpose of the study and eligibility\n\nThis study compares the effectiveness of two websites designed to help smokers to stop. ",...
			"If you decide to take part, you will be randomly assigned to receive support from one of these. In order to be eligible for participation in this study, you need to be\n\na regular smoker,\n\nover 18 years,",...
			"old\n\nand prepared to make a serious attempt to stop smoking within the next month.\n\nPlease only consider participating if all these apply to you.\n\n2. What will happen if you decide to take part?\n\nWe ask that you use a ",...
			"stop smoking website to help you make a serious attempt to quit smoking within the next month. \n\nBefore quitting. During the time leading up to your quit attempt, we ask that you:\n\n1. Answer some questions about your ",...
			"background, smoking history, current smoking, mood and craving levels.\n\n2. Receive email reminders to visit the website.\n\n3. Use the website and read the advice it provides ",...
			"to prepare for an attempt to quit smoking.\n\nAfter quitting. During the month following your attempt to quit, you will be asked to:\n\n1. Receive email reminders to visit the ",...
			"website.\n\n2. Use the website and read the advice it provides.\n\n3. Answer questions about your smoking and the website\n\n2, 4 and 7 months from today. We will email to ",...
			"ask questions about the website and your quit attempt, including whether you are still not smoking. If you are not smoking after 7 months we may need to confirm that. If selected, we ask that you ",...
			"provide a small sample of saliva to be analysed for a nicotine by-product. The sample will be destroyed after testing. We would send you the kit ",...
			"through the post and you just return it using a pre-paid envelope. In return for your trouble, you would receive a twenty pounds gift voucher.\n\nImportant: The success of this study ",...
			"depends upon us being able to contact you and find out whether or not you have stopped smoking so please do not agree to take part in this study unless you are happy to provide that ",...
			"information to us 7 months from today, regardless of whether you have managed to stop smoking.\n\n3. Possible risks or discomfort\n\nYou may experience withdrawal symptoms such ",...
			"as irritability when you abstain from smoking, which you will be familiar with if you have previously attempted to stop.\n\n4. Possible benefits\n\nStopping smoking is the single ",...
			"most beneficial thing that smokers can do to improve their health. We hope that the results of this study will be of benefit to many thousands of other smokers who want to ",...
			"stop.\n\n5. Financial considerations\n\nThere are no financial costs to you for taking part. If you provide a saliva sample we will compensate you ",...
			"with a twenty pounds gift voucher.\n\n6. Confidentiality\n\nData collected and stored in this study will be done so in accordance with the Data Protection Act 1998. For your ",...
			"protection, we will assign you a number that will be used to label all information. The personal information, such as your name and how to contact you, will be ",...
			"destroyed after our last contact. No personal information such as your name or contact details will be kept with the ",...
			"questionnaire data. Your identity in this study will be treated as confidential. The results of the study, including laboratory and other data, may be published for scientific ",...
			"purposes but will not give your name or include information that will identify you. However, any records or data obtained as a result of your participation may be checked by the ",...
			"group that oversees research to make sure that human participants are protected.\n\n7. Termination of research study\n\nYou are free to choose whether or not to take part in this ",...
			"study. You can choose to stop participating at any time by emailing us at stopsmoking@ucl.ac.uk.\n\n8. Ethics review\n\nThis study has been approved by University College London's Committee ",...
			"on the Ethics of Non-NHS Human Research [UCL Ethics Project ID Number: 2808/001].\n\n9. Available sources of information\n\nIf you have any questions later or if you require additional ",...
			"information about the study and your rights as a participant please feel free to contact Dr Jamie Brown on +44 (0)20 3108 3179 or stopsmoking@ucl.ac.uk. Please also use this number in case ",...
			"of a research-related emergency.\n\nPrincipal Investigators: Professor Robert West and Professor Susan Michie\n\nBy consenting you indicated that:\n\nYou have read the information pages and ",...
			"had an opportunity to ask questions and are happy that you understand the study and what it involves for you.\n\nYou realise that you can withdraw from the study at any time.\n\nYou ",...
			"agree that the findings of the study can be published but that you will not be identified.\n\nAll the information you provide will be held in the strictest confidence and will be treated ",...
			"as strictly confidential and handled in accordance with the provisions of the Data Protection Act 1998. \n\nComments or concerns during the study. If you have any comments or concerns you ",...
			"should discuss these with the Principal Researcher. If you wish to go further and complain about any aspect of the way that you have been approached or treated during the course of this study, ",...
			"you should email the Chair of the UCL Committee for the Ethics of Non-NHS Human Research (gradschoolhead@ucl.ac.uk ) or send a letter to: The Graduate School, North Cloisters, Wilkins ",...
			"Building, UCL, Gower Street, London WC1E 6BT who will take the complaint forward as necessary. \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),10)

show signupconfirm
set signupconfirm.name to load signup.first_name for username
savevalue(signup.email, "signuptime", currenttime())
	
#JB - had to move other emails to after baseline8a, which is when they are actually included in study
#if they take a long time to answer baselines/opted out after seeing questionnaire, would have given incorrect data
##JJ: Pilot - hash out random number line below; JB timings
after signupconfirm if (and(...
						randomnumber(1,2) > 0,...
						savevalue (username, "group", "intervention"),...
						sendemail("baseline_a", username, "Quit smoking internet study reminder: your first questionnaire is pending", append ("Hello ",signup.first_name,...
						",\n\nThis is a reminder that you are currently participating in University College London's Quit Smoking Internet Study. When consenting to participate in the study, ",...
						"you agreed to use a website whilst making a serious attempt to quit smoking, and then to answer questions about your smoking and the website.\n\nThis is also a reminder ",...
						"that a short questionnaire we need you to complete is unfinished. Please take five minutes to log in and complete the questionnaire:\n\nhttp://www.stopadvisor.co.uk\n\n",...
						"If you are having problems logging in, please email us on stopsmoking@ucl.ac.uk\n\nAll the information you provide will be held in the strictest confidence, ",...
						"treated as strictly confidential and handled in accordance with the provisions of the Data Protection Act 1998.\n\nBest wishes,\n\nProfessor Robert West and ",...
						"Professor Susan Michie \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),86400),...
						sendemail("baseline_r1a", username, "Quit smoking internet study reminder: your first questionnaire is pending", append ("Hello ",signup.first_name,",\n\nThis is a ",...
						"reminder that you are currently participating in University College London's Quit Smoking Internet Study. When consenting to participate in the study, you agreed to ",...
						"use a website whilst making a serious attempt to quit smoking, and then to answer questions about your smoking and the website.\n\nThis is another reminder that a ",...
						"short questionnaire we need you to complete is unfinished. Please take five minutes to log in and complete the questionnaire:\n\nhttp://www.stopadvisor.co.uk\n\nIf you are ",...
						"having problems logging in, please email us on stopsmoking@ucl.ac.uk\n\nAll the information you provide will be held in the strictest confidence, treated as strictly ",...
						"confidential and handled in accordance with the provisions of the Data Protection Act 1998.\n\nBest wishes,\n\nProfessor Robert West and Professor Susan Michie \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),259200),...
						sendemail("baseline_r2a", username, "Quit smoking internet study final reminder: your first questionnaire is pending", append ("Hello ",signup.first_name,",\n\nThis ",...
						"is a reminder that you are currently participating in University College London's Quit Smoking Internet Study. When consenting to participate in the study, you agreed ",...
						"to use a website whilst making a serious attempt to quit smoking, and then to answer questions about your smoking and the website.\n\nThis is also a final reminder that ",...
						"a short questionnaire we need you to complete is unfinished. Please take five minutes to log in and complete the questionnaire:\n\nhttp://www.stopadvisor.co.uk\n\nIf you are ",...
						"having problems logging in, please email us on stopsmoking@ucl.ac.uk\n\nAll the information you provide will be held in the strictest confidence, treated as strictly ",...
						"confidential and handled in accordance with the provisions of the Data Protection Act 1998.\n\nBest wishes,\n\nProfessor Robert West and Professor Susan Michie\n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),604800),...
						sendemail(append(username, "ba_notcompleted"), "stopsmoking@ucl.ac.uk", "Participant has not completed baseline questions", append(signup.first_name," is in the ",...
						"intervention group and has not completed the baseline questions. Email:",signup.email), 691200)...
							)) goto baseline1a
							
#jb - created safeguard like this whereever sendemail exists inside 'after...if' or 'show...if' to mitigate against users pressing backwards and forwards, and then sendemail evaluating to false,
# and causing this logic to fail.							
							
after signupconfirm if (loadvalue(username, "group") = "intervention") goto baseline1a						

##JJ: RCT: Randomisation and emails - Control group - This needs testing so have left names in subject line - same for all control/RCT emails; jb email-names
##JJ: Pilot - hash out the lines below. These lines refer to the control group and are not needed.
after signupconfirm if (and(...
							savevalue(username, "group", "control"),...
						sendemail("baseline_b", username, "Quit smoking internet study reminder: your first questionnaire is pending", append ("Hello ",signup.first_name,...
						",\n\nThis is a reminder that you are currently participating in University College London's Quit Smoking Internet Study. When consenting to participate in the study, ",...
						"you agreed to use a website whilst making a serious attempt to quit smoking, and then to answer questions about your smoking and the website.\n\nThis is also a reminder ",...
						"that a short questionnaire we need you to complete is unfinished. Please take five minutes to log in and complete the questionnaire:\n\nhttp://www.quitsmokingstudy.co.uk\n\n",...
						"If you are having problems logging in, please email us on stopsmoking@ucl.ac.uk\n\nAll the information you provide will be held in the strictest confidence, ",...
						"treated as strictly confidential and handled in accordance with the provisions of the Data Protection Act 1998.\n\nBest wishes,\n\nProfessor Robert West and ",...
						"Professor Susan Michie \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),86400),...
						sendemail("baseline_r1b", username, "Quit smoking internet study reminder: your first questionnaire is pending", append ("Hello ",signup.first_name,",\n\nThis is a ",...
						"reminder that you are currently participating in University College London's Quit Smoking Internet Study. When consenting to participate in the study, you agreed to ",...
						"use a website whilst making a serious attempt to quit smoking, and then to answer questions about your smoking and the website.\n\nThis is another reminder that a ",...
						"short questionnaire we need you to complete is unfinished. Please take five minutes to log in and complete the questionnaire:\n\nhttp://www.quitsmokingstudy.co.uk\n\nIf you are ",...
						"having problems logging in, please email us on stopsmoking@ucl.ac.uk\n\nAll the information you provide will be held in the strictest confidence, treated as strictly ",...
						"confidential and handled in accordance with the provisions of the Data Protection Act 1998.\n\nBest wishes,\n\nProfessor Robert West and Professor Susan Michie \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),259200),...
						sendemail("baseline_r2b", username, "Quit smoking internet study final reminder: your first questionnaire is pending", append ("Hello ",signup.first_name,",\n\nThis ",...
						"is a reminder that you are currently participating in University College London's Quit Smoking Internet Study. When consenting to participate in the study, you agreed ",...
						"to use a website whilst making a serious attempt to quit smoking, and then to answer questions about your smoking and the website.\n\nThis is also a final reminder that ",...
						"a short questionnaire we need you to complete is unfinished. Please take five minutes to log in and complete the questionnaire:\n\nhttp://www.quitsmokingstudy.co.uk\n\nIf you are ",...
						"having problems logging in, please email us on stopsmoking@ucl.ac.uk\n\nAll the information you provide will be held in the strictest confidence, treated as strictly ",...
						"confidential and handled in accordance with the provisions of the Data Protection Act 1998.\n\nBest wishes,\n\nProfessor Robert West and Professor Susan Michie \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),604800),...
						sendemail (append(username, "bb_notcompleted"), "stopsmoking@ucl.ac.uk", "Participant has not completed baseline questions", append(signup.first_name," is in the control ",...
						"group and has not completed the baseline questions. Email:",signup.email), 691200)...
						)) goto baseline1b
		
after signupconfirm if (loadvalue(username, "group") = "control") goto baseline1b						
												
end #Ends signup

show login
show login_successful

#JJ: Logic for saving that users do not want to take medication on page p1p05
#JB: Added logic to reflect they can say no to meds three times
set notusingmeds to (or ((loadvalue(username, "none") = "notomed"),...
						 (loadvalue(username, "none1") = "notusemed"),...
						 (loadvalue(username, "none2") = "nomed02")))
						 

#JJ: Logic for saving which medication users selected on page p1p08confirmed01
#JB: Added logic to reflect that they can pick a medication twice
set usemedchamp to (or ((loadvalue(username, "usemed") = "champix"),...
						(loadvalue(username, "usemed4") = "champix_03"),...
						(loadvalue(username, "usemed2") = "champix_02")))
set usemedzyban to (or ((loadvalue(username, "usemed") = "zyban"),...
						(loadvalue(username, "usemed4") = "zyban_03"),...
						(loadvalue(username, "usemed2") = "zyban_02")))
set usemedgum to (or ((loadvalue(username, "usemed") = "gum"),...
						(loadvalue(username, "usemed4") = "gum_03"),...
						(loadvalue(username, "usemed2") = "gum_02")))
set usemedpatch to (or ((loadvalue(username, "usemed") = "patches"),...
						(loadvalue(username, "usemed4") = "patches_03"),...
						(loadvalue(username, "usemed2") = "patches_02")))
set usemedinhalator to (or ((loadvalue(username, "usemed") = "inhalator"),...
						(loadvalue(username, "usemed4") = "inhalator_03"),...
						(loadvalue(username, "usemed2") = "inhalator_02")))
set usemedlozenge to (or ((loadvalue(username, "usemed") = "lozenges"),...
						(loadvalue(username, "usemed4") = "lozenges_03"),...
						(loadvalue(username, "usemed2") = "lozenges_02")))
set usemedmicrotabs to (or ((loadvalue(username, "usemed") = "microtabs"),...
						(loadvalue(username, "usemed4") = "microtabs_03"),...
						(loadvalue(username, "usemed2") = "microtabs_02")))
set usemednasal to (or ((loadvalue(username, "usemed") = "nasal"),...
						(loadvalue(username, "usemed4") = "nasal_03"),...
						(loadvalue(username, "usemed2") = "nasal_02")))

set havemedication to (or ((loadvalue(username, "usemed") = "champix"),...
							(loadvalue(username, "usemed2") = "champix_02"),...
							(loadvalue(username, "usemed4") = "champix_03"),...
							(loadvalue(username, "usemed") = "zyban"),...
							(loadvalue(username, "usemed2") = "zyban_02"),...
							(loadvalue(username, "usemed4") = "zyban_03"),...
							(loadvalue(username, "usemed") = "gum"),...
							(loadvalue(username, "usemed2") = "gum_02"),...
							(loadvalue(username, "usemed4") = "gum_03"),...
							(loadvalue(username, "usemed") = "patches"),...
							(loadvalue(username, "usemed2") = "patches_02"),...
							(loadvalue(username, "usemed4") = "patches_03"),...
							(loadvalue(username, "usemed") = "inhalator"),...
							(loadvalue(username, "usemed2") = "inhalator_02"),...
							(loadvalue(username, "usemed4") = "inhalator_03"),...
							(loadvalue(username, "usemed") = "lozenges"),...
							(loadvalue(username, "usemed2") = "lozenges_02"),...
							(loadvalue(username, "usemed4") = "lozenges_03"),...
							(loadvalue(username, "usemed") = "microtabs"),...
							(loadvalue(username, "usemed2") = "microtabs_02"),...
							(loadvalue(username, "usemed4") = "microtabs_03"),...
							(loadvalue(username, "usemed") = "nasal"),...
							(loadvalue(username, "usemed2") = "nasal_02"),...
							(loadvalue(username, "usemed4") = "nasal_03")))

if (1=1) set usedmedexport to loadvalue(username, "usemed")
if (1=1) set usedmed2export to loadvalue(username, "usemed2")
if (1=1) set usedmed4export to loadvalue(username, "usemed4")

if (1=1) set noneexport to loadvalue(username, "none")
if (1=1) set none1export to loadvalue(username, "none1")
if (1=1) set none2export to loadvalue(username, "none2")
										
#JB this needed to be set as signup.first_name only works for emails queued during same sessions that signup was seen.
#Unfortunately, several additional separate 'email names' needed to be set for pre-quit emails, as a number of this may or may not be seen 
#during the same session as signup - so can't use signup or login when either is possible.
#The below is used for all emails to be sent that will definitely be queued AFTER a login.							
set dialogue_name to load signup.first_name for username
set dialogue_email to load signup.email for username
							
#JJ: Start of logic for directing users to correct pages based on time and what they have seen
#JJ: Pilot - priority is baseline, then 2 month outcome
#JJ: RCT - Priority is baseline, 7 months, 4months, 2 months

#JJ: Pilot & RCT - Logic for directing intervention group to baseline if they haven't completed it

#JB: had to add two additional "after login_successful" logic lines to prevent people who sign up and close browser on signup_confirm being permanently locked out
#and taken through baseline1a continually as never get assigned a group.; JB timings

##JB: RCT: Randomisation and emails - Control group
##JB: Pilot - hash out the lines below. These lines refer to the control group and are not needed.

after login_successful if (and(...
							randomnumber(1,2) > 0,...
							isempty(loadvalue(username, "group")),...
							savevalue (username, "group", "intervention"),...
							sendemail("baseline_a", username, "Quit smoking internet study reminder: your first questionnaire is pending", append ("Hello ",signup.first_name,...
						",\n\nThis is a reminder that you are currently participating in University College London's Quit Smoking Internet Study. When consenting to participate in the study, ",...
						"you agreed to use a website whilst making a serious attempt to quit smoking, and then to answer questions about your smoking and the website.\n\nThis is also a reminder ",...
						"that a short questionnaire we need you to complete is unfinished. Please take five minutes to log in and complete the questionnaire:\n\nhttp://www.stopadvisor.co.uk\n\n",...
						"If you are having problems logging in, please email us on stopsmoking@ucl.ac.uk\n\nAll the information you provide will be held in the strictest confidence, ",...
						"treated as strictly confidential and handled in accordance with the provisions of the Data Protection Act 1998.\n\nBest wishes,\n\nProfessor Robert West and ",...
						"Professor Susan Michie \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),86400),...
						sendemail("baseline_r1a", username, "Quit smoking internet study reminder: your first questionnaire is pending", append ("Hello ",signup.first_name,",\n\nThis is a ",...
						"reminder that you are currently participating in University College London's Quit Smoking Internet Study. When consenting to participate in the study, you agreed to ",...
						"use a website whilst making a serious attempt to quit smoking, and then to answer questions about your smoking and the website.\n\nThis is another reminder that a ",...
						"short questionnaire we need you to complete is unfinished. Please take five minutes to log in and complete the questionnaire:\n\nhttp://www.stopadvisor.co.uk\n\nIf you are ",...
						"having problems logging in, please email us on stopsmoking@ucl.ac.uk\n\nAll the information you provide will be held in the strictest confidence, treated as strictly ",...
						"confidential and handled in accordance with the provisions of the Data Protection Act 1998.\n\nBest wishes,\n\nProfessor Robert West and Professor Susan Michie \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),259200),...
						sendemail("baseline_r2a", username, "Quit smoking internet study final reminder: your first questionnaire is pending", append ("Hello ",signup.first_name,",\n\nThis ",...
						"is a reminder that you are currently participating in University College London's Quit Smoking Internet Study. When consenting to participate in the study, you agreed ",...
						"to use a website whilst making a serious attempt to quit smoking, and then to answer questions about your smoking and the website.\n\nThis is also a final reminder that ",...
						"a short questionnaire we need you to complete is unfinished. Please take five minutes to log in and complete the questionnaire:\n\nhttp://www.stopadvisor.co.uk\n\nIf you are ",...
						"having problems logging in, please email us on stopsmoking@ucl.ac.uk\n\nAll the information you provide will be held in the strictest confidence, treated as strictly ",...
						"confidential and handled in accordance with the provisions of the Data Protection Act 1998.\n\nBest wishes,\n\nProfessor Robert West and Professor Susan Michie\n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),604800),...
						sendemail(append(username, "ba_notcompleted"), "stopsmoking@ucl.ac.uk", "Participant has not completed baseline questions", append(signup.first_name," is in the ",...
						"intervention group and has not completed the baseline questions. Email:",signup.email), 691200)...
							)) goto baseline1a

							
after login_successful if (and(...
							(loadvalue(username, "group") = "intervention"),...
							isempty(loadvalue(username, "completedba"))...
							)) goto baseline1a
							
#JJ: RCT - Logic for directing control group to baseline if they haven't completed it - email-names
after login_successful if (and(...
							isempty(loadvalue(username, "group")),...
							savevalue(username, "group", "control"),...
						sendemail("baseline_b", username, "Quit smoking internet study reminder: your first questionnaire is pending", append ("Hello ",signup.first_name,...
						",\n\nThis is a reminder that you are currently participating in University College London's Quit Smoking Internet Study. When consenting to participate in the study, ",...
						"you agreed to use a website whilst making a serious attempt to quit smoking, and then to answer questions about your smoking and the website.\n\nThis is also a reminder ",...
						"that a short questionnaire we need you to complete is unfinished. Please take five minutes to log in and complete the questionnaire:\n\nhttp://www.quitsmokingstudy.co.uk\n\n",...
						"If you are having problems logging in, please email us on stopsmoking@ucl.ac.uk\n\nAll the information you provide will be held in the strictest confidence, ",...
						"treated as strictly confidential and handled in accordance with the provisions of the Data Protection Act 1998.\n\nBest wishes,\n\nProfessor Robert West and ",...
						"Professor Susan Michie \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),86400),...
						sendemail("baseline_r1b", username, "Quit smoking internet study reminder: your first questionnaire is pending", append ("Hello ",signup.first_name,",\n\nThis is a ",...
						"reminder that you are currently participating in University College London's Quit Smoking Internet Study. When consenting to participate in the study, you agreed to ",...
						"use a website whilst making a serious attempt to quit smoking, and then to answer questions about your smoking and the website.\n\nThis is another reminder that a ",...
						"short questionnaire we need you to complete is unfinished. Please take five minutes to log in and complete the questionnaire:\n\nhttp://www.quitsmokingstudy.co.uk\n\nIf you are ",...
						"having problems logging in, please email us on stopsmoking@ucl.ac.uk\n\nAll the information you provide will be held in the strictest confidence, treated as strictly ",...
						"confidential and handled in accordance with the provisions of the Data Protection Act 1998.\n\nBest wishes,\n\nProfessor Robert West and Professor Susan Michie \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),259200),...
						sendemail("baseline_r2b", username, "Quit smoking internet study final reminder: your first questionnaire is pending", append ("Hello ",signup.first_name,",\n\nThis ",...
						"is a reminder that you are currently participating in University College London's Quit Smoking Internet Study. When consenting to participate in the study, you agreed ",...
						"to use a website whilst making a serious attempt to quit smoking, and then to answer questions about your smoking and the website.\n\nThis is also a final reminder that ",...
						"a short questionnaire we need you to complete is unfinished. Please take five minutes to log in and complete the questionnaire:\n\nhttp://www.quitsmokingstudy.co.uk\n\nIf you are ",...
						"having problems logging in, please email us on stopsmoking@ucl.ac.uk\n\nAll the information you provide will be held in the strictest confidence, treated as strictly ",...
						"confidential and handled in accordance with the provisions of the Data Protection Act 1998.\n\nBest wishes,\n\nProfessor Robert West and Professor Susan Michie \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),604800),...
						sendemail (append(username, "bb_notcompleted"), "stopsmoking@ucl.ac.uk", "Participant has not completed baseline questions", append(signup.first_name," is in the control ",...
						"group and has not completed the baseline questions. Email:",signup.email), 691200)...
						)) goto baseline1b

after login_successful if (and(...
							(loadvalue(username, "group") = "control"),...
							isempty(loadvalue(username, "completedbb"))...
							)) goto baseline1b

##JJ: RCT 7 month follow-up
after login_successful if (and(...
				loadvalue(username, "group") = "intervention",...
				comparetimes(loadvalue(username, "allocatedtimea"), currenttime(),"days") >=196,...
				isempty(loadvalue(username, "completedrctm7a"))...
				)) goto outcome3rctp1a
			
after login_successful if (and(...
				loadvalue(username, "group") = "control",...
				comparetimes(loadvalue(username, "allocatedtimeb"), currenttime(),"days") >=196,...
				isempty(loadvalue(username, "completedrctm7b"))...
				)) goto outcome3rctp1b
								
##JJ: RCT 4 month follow-up	
after login_successful if (and(...
				loadvalue(username, "group") = "intervention",...
				comparetimes(loadvalue(username, "allocatedtimea"), currenttime(),"days") >=112,...
				isempty(loadvalue(username, "completedrctm4a"))...
				)) goto outcome2rctp1a
				
after login_successful if (and(...
				loadvalue(username, "group") = "control",...
				comparetimes(loadvalue(username, "allocatedtimeb"), currenttime(),"days") >=112,...
				isempty(loadvalue(username, "completedrctm4b"))...
				)) goto outcome2rctp1b
				
##JJ: RCT 2 month follow-up and Pilot (intervention group only)
after login_successful if (and(...
				loadvalue(username, "group") = "intervention",...
				comparetimes(loadvalue(username, "allocatedtimea"), currenttime(),"days") >=56,...
				isempty(loadvalue(username, "completedrctm2a"))...
				)) goto outcome1rctp1a
				
after login_successful if (and(...
				loadvalue(username, "group") = "control",...
				comparetimes(loadvalue(username, "allocatedtimeb"), currenttime(),"days") >=56,...
				isempty(loadvalue(username, "completedrctm2b"))...
				)) goto outcome1rctp1b
				
#JJ: RCT: If control group login again, but have not seen outcome1, go to not ready page with link to control website
after login_successful if (and(...
						(loadvalue(username, "group") = "control"),...
						(not(hasseen(username, "outcome1rctp1b")))...
						)) goto notreadyb1 #jb took out login.email - wasn't causing a problem but has eleswhere

#JJ: RCT: If control group login again and have seen outcome1, go to questions not ready page
after login_successful if (loadvalue(username, "group") = "control") goto notreadyb2
		
#JJ: Dialogue session logic (Sessions 5-13)
#JB - after moving sending emails to dasmok, there was nothing to evaluate all the d02-d013 sessions to false once session was 'done', 
#so had to change haseen last session (which prior to time elapsing is done by whether the next dtime was saved or not anyway) to not hasseen dasmok of next session.
#JB "Timings" - all next 13 sections
after login_successful if (and(...
				loadvalue(username, "group") = "intervention",...
				currenttime() > +(loadvalue (username, "d12time"), (delay96)),...
				(not(hasseen(username, "dasmok13")))...
				)) goto choice13	
							
after login_successful if (and(...
				loadvalue(username, "group") = "intervention",...
				currenttime() > +(loadvalue (username, "d11time"), (delay72)),...
				(not(hasseen(username, "dasmok12")))...
				)) goto choice12
				
after login_successful if (and(...
				loadvalue(username, "group") = "intervention",...
				currenttime() > +(loadvalue (username, "d10time"), (delay72)),...
				(not(hasseen(username, "dasmok11")))...
				)) goto choice11

after login_successful if (and(...
				loadvalue(username, "group") = "intervention",...
				currenttime() > +(loadvalue (username, "d9time"), (delay48)),...
				(not(hasseen(username, "dasmok10")))...
				)) goto choice10

after login_successful if (and(...
				loadvalue(username, "group") = "intervention",...
				currenttime() > +(loadvalue (username, "d8time"), (delay48)),...
				(not(hasseen(username, "dasmok09")))...
				)) goto choice9

after login_successful if (and(...
				loadvalue(username, "group") = "intervention",...
				currenttime() > +(loadvalue (username, "d7time"), (delay24)),...
				(not(hasseen(username, "dasmok08")))...
				)) goto choice8
				
after login_successful if (and(...
				loadvalue(username, "group") = "intervention",...
				currenttime() > +(loadvalue (username, "d6time"), (delay24)),...
				(not(hasseen(username, "dasmok07")))...
				)) goto choice7

after login_successful if (and(...
				loadvalue(username, "group") = "intervention",...
				currenttime() > +(loadvalue (username, "d5time"), (delay24)),...
				(not(hasseen(username, "dasmok06")))...
				)) goto choice6
				
after login_successful if (and(...
				loadvalue(username, "group") = "intervention",...
				currenttime() > +(loadvalue (username, "d4time"), (delay24)),...
				(not(hasseen(username, "dasmok05")))...
				)) goto choice5

after login_successful if (and(...
				loadvalue(username, "group") = "intervention",...
				currenttime() > +(loadvalue (username, "d3time"), (delay24)),...
				(not(hasseen(username, "dasmok04")))...
				)) goto choice4
		
after login_successful if (and(...
				loadvalue(username, "group") = "intervention",...
				currenttime() > +(loadvalue (username, "d2time"), (delay24)),...
				(not(hasseen(username, "dasmok03")))...
				)) goto choice3
				
after login_successful if (and(...
				loadvalue(username, "group") = "intervention",...
				currenttime() > +(loadvalue (username, "d1time"), (delay24)),...
				(not(hasseen(username, "dasmok02")))...
				)) goto choice2
				
after login_successful if (and(...
				loadvalue(username, "group") = "intervention",...
				currenttime() > +(loadvalue (username, "quitdate"), (100800)),...
				(not(hasseen(username, "dasmok01")))...
				)) goto choice1 # JB "Timings"				
				
#JJ: QUIT DATE LOGIC ##
#JB: If they login on the day of their first dialogue session between midnight and 4am go to session notready JB "Timings"
after login_successful if (and(...
							loadvalue(username, "group") = "intervention",...
							currenttime() > +(loadvalue (username, "quitdate"), (86400)),...
							currenttime() < +(loadvalue (username, "quitdate"), (100800))...
							)) goto notreadya3

#JJ: If they login on the day of their quit date after 4am, go to Session 4 (Quit date); JB "Timings"
after login_successful if (and(...
							loadvalue(username, "group") = "intervention",...
							currenttime() > +(loadvalue (username, "quitdate"), (14400)),...
							currenttime() < +(loadvalue (username, "quitdate"), (86400)),...
							not(hasseen (username, "p4p04"))...
							)) goto p4p01

#JJ: If they login on the day of their quit date after 4am, but have seen the quit date session, go to session not ready; JB "Timings"
after login_successful if (and(...
							loadvalue(username, "group") = "intervention",...
							currenttime() > +(loadvalue (username, "quitdate"), (14400)),...
							currenttime() < +(loadvalue (username, "quitdate"), (86400)),...
							hasseen (username, "p4p04")...
							)) goto notreadya3

#JJ: If they login on the day of their quit date between midnight and 4am go to session not ready page; JB "Timings"
after login_successful if (and(...
							loadvalue(username, "group") = "intervention",...
							currenttime() >= +(loadvalue (username, "quitdate"), (0)),...
							currenttime() < +(loadvalue (username, "quitdate"), (14400))...
							)) goto notreadya1##
							

#JJ: QUIT DATE-1 LOGIC ##
#JJ: If they login quit date-1 after 4am, go to quit date-1; JB "Timings"
after login_successful if (and(...
							loadvalue(username, "group") = "intervention",...
							currenttime() > +(loadvalue (username, "quitdate"), (-72000)),...
							currenttime() < +(loadvalue (username, "quitdate"), (0)),...
							not(hasseen (username, "p3p04"))...
							)) goto p3p01#
							
#JJ: If they login quit date-1 after 4am, but have seen quit date-1, go to session not ready; JB "Timings"
after login_successful if (and(...
							loadvalue(username, "group") = "intervention",...
							currenttime() > +(loadvalue (username, "quitdate"), (-72000)),...
							currenttime() < +(loadvalue (username, "quitdate"), (0)),...
							hasseen(username, "p3p04")...
							)) goto notreadya1
														
#JJ: If they login quit date-1 between midnight and 4am go to session not ready page; JB "Timings"
after login_successful if (and(...
							loadvalue(username, "group") = "intervention",...
							currenttime() >= +(loadvalue (username, "quitdate"), (-86400)),...
							currenttime() < +(loadvalue (username, "quitdate"), (-72000))...
							)) goto notreadya1
							
#JJ: PREQUIT LOGIC ##
#JJ: Quitting with medication

#JJ: If they have seen the first page of the pick quit date session, but not picked a quit date, go to beginning of
#quit date session.
after login_successful if (and(...
							loadvalue(username, "group") = "intervention",...
				 			hasseen(username, "p2p01"),...
				 			not(hasseen(username, "p2p03"))...
				 			)) goto p2p01
				 			
#JJ: If they chose to get meds and needed more time and login too early (within 24 hours of wanting more time), go to
# the session not ready page; JB "Timings"
after login_successful if (and(...
							loadvalue(username, "group") = "intervention",...
							comparetimes(loadvalue(username, "medmoretime2"), currenttime(), "minutes") < 1440,...
			                or(...
			                hasseen(username, "p1p08_3days02"),...
				 			hasseen(username, "p1p08_5days02"),...
				 			hasseen(username, "p1p08_1week02"))...
			              	)) goto notreadya1
			 			
#JJ: If they chose to get meds, but couldn't get them after a 2nd attempt, or did get them, go to pick quit date
after login_successful if (and(...
							loadvalue(username, "group") = "intervention",...
							or(...
					 		hasseen (username, "p1p08usechamp02"),...
					 		hasseen (username, "p1p08usezyban02"),...
					 		hasseen (username, "p1p08usegum02"),...
					 		hasseen (username, "p1p08usepatch02"),...
					 		hasseen (username, "p1p08useloz02"),...
					 		hasseen (username, "p1p08usemicro02"),...
					 		hasseen (username, "p1p08useinhal02"),...
					 		hasseen (username, "p1p08usenasal02"),...
					 		hasseen (username, "p1p07nomed3")),...
					 		not(hasseen (username, "p2p03"))...
							)) goto p2p01
							
#JJ: If they chose to get meds, but couldn't get them in time and have chosen another time, go to p1p08confirmmed02
after login_successful if (and(...
							loadvalue(username, "group") = "intervention",...
							not(hasseen(username, "p1p08confirmmed02")),...
							or(...
							hasseen(username, "p1p08_3days02"),...
				 			hasseen(username, "p1p08_5days02"),...
				 			hasseen(username, "p1p08_1week02")),...
				 			not(hasseen (username, "p2p03"))...
							)) goto p1p08confirmmed02
							
#JJ: If they chose to get meds, but couldn't get them in time, have chosen another time, but close their browser after
#they see p1p08confirmmed02 but before answering whether they have their meds, go back to p1p08confirmmed02
after login_successful if (and(...
							loadvalue(username, "group") = "intervention",...
							hasseen (username, "p1p08confirmmed02"),...
							not(hasseen (username, "p2p03"))...
				 			)) goto p1p08confirmmed02#Second 'Did you get your meds' page
				 	 			
#JJ: If they chose to get meds, have chosen which med they have, close browser before picking quit date,
# go to pick quit date
after login_successful if (and(...
							loadvalue(username, "group") = "intervention",...
							or(...
							hasseen (username, "p1p08usechamp"),...
							hasseen (username, "p1p08usezyban"),...
							hasseen (username, "p1p08usegum"),...
							hasseen (username, "p1p08usepatch"),...
							hasseen (username, "p1p08useloz"),...
							hasseen (username, "p1p08usemicro"),...
							hasseen (username, "p1p08useinhal"),...
							hasseen (username, "p1p08usenasal"),...
							hasseen(username, "p1p07nomed2")),...
							not(hasseen (username, "p2p03"))...
							)) goto p2p01 #	hasseen (username, "p1p08confirmmed01"),...

#JJ: If they chose to get meds, but couldn't get them in time, have seen p1p08confirmed01, but close their browser
#before picking again how long they need to get their meds, go to back to p1p08confirmmed01
after login_successful if (and(...
							loadvalue(username, "group") = "intervention",...
							hasseen (username, "p1p08confirmmed01"),...
							not(hasseen(username, "p2p03")),...
							not(hasseen(username, "p1p08_3days02")),...
				 			not(hasseen(username, "p1p08_5days02")),...
				 			not(hasseen(username, "p1p08_1week02"))...
				 			)) goto p1p08confirmmed01
                      
#JJ: If they chose to get meds and login within 24 hours of choosing meds, go to the session not ready page; JB "Timings"
after login_successful if (and(...
							loadvalue(username, "group") = "intervention",...
							or(...
							hasseen(username, "p1p08_3days"),...
				 			hasseen(username, "p1p08_5days"),...
				 			hasseen(username, "p1p08_1week")),...
					 	    comparetimes(loadvalue(username, "medmoretime1"), currenttime(), "minutes") < 1440 ...
			                 )) goto notreadya1
		
#JJ: If they chose to get meds and login after 24 hours, go to Did you get your meds?
after login_successful if (and(...
							loadvalue(username, "group") = "intervention",...
							or(...
							hasseen(username, "p1p08_3days"),...
				 			hasseen(username, "p1p08_5days"),...
				 			hasseen(username, "p1p08_1week")),...
				 			not(hasseen (username, "p2p03"))...
					 		)) goto p1p08confirmmed01#First 'Did you get your meds' page
					 		
#JJ: Quitting without medication
#JB: If they chose to quit without meds, or have meds already, but didn't go on to pick a quitdate, go to pick quit date
after login_successful if (and(...
							loadvalue(username, "group") = "intervention",...
							or(...
					 		hasseen (username, "p1p08usechamp03"),...
					 		hasseen (username, "p1p08usezyban03"),...
					 		hasseen (username, "p1p08usegum03"),...
					 		hasseen (username, "p1p08usepatch03"),...
					 		hasseen (username, "p1p08useloz03"),...
					 		hasseen (username, "p1p08usemicro03"),...
					 		hasseen (username, "p1p08useinhal03"),...
					 		hasseen (username, "p1p08usenasal03"),...
					 		hasseen (username, "p1p07nomed")),...
					 		not(hasseen (username, "p2p03"))...
							)) goto p2p01

#JJ: If they chose to quit without meds, have picked a quitdate, but login before quit date -1, go to pre-quit
#session not ready; JB "Timings"
after login_successful if (and(...
							loadvalue(username, "group") = "intervention",...
							hasseen(username, "p2p03"),...
					 	    currenttime() < +(loadvalue (username, "quitdate"), (-86400))...
							)) goto notreadya1

#JJ: If they have seen session 1 but didn't see the meds page or nomeds page, go to the beginning of session 1
after login_successful if (and(...
							loadvalue(username, "group") = "intervention",...
							not(hasseen(username, "p1p08_3days")),...
				 			not(hasseen(username, "p1p08_5days")),...
				 			not(hasseen(username, "p1p08_1week")),...
				 			not(hasseen(username, "p1p08usechamp03")),...
				 			not(hasseen(username, "p1p08usezyban03")),...
				 			not(hasseen(username, "p1p08usegum03")),...
				 			not(hasseen(username, "p1p08usepatch03")),...
				 			not(hasseen(username, "p1p08useloz03")),...
				 			not(hasseen(username, "p1p08usemicro03")),...
				 			not(hasseen(username, "p1p08useinhal03")),...
				 			not(hasseen(username, "p1p08usenasas03")),...
				 			not(hasseen(username, "p1p07nomed"))...
							)) goto awelcome

#JJ: If they have seen their quit date, but their next session is not ready yet, go to post-quit session not ready page
after login_successful if (and(...
							loadvalue(username, "group") = "intervention",...
							hasseen(username, "p2p03"),...
							not(hasseen(username, "dasmok13"))...
							)) goto notreadya3 #Post quit notready page with quick concerns link

#JJ: If they have not seen their quit date, but their next session is not ready yet, go to pre-quit session not ready page
after login_successful if (loadvalue(username, "group") = "intervention") goto notreadya2

#JB: Post-pilot
after login_successful if (isempty(loadvalue(username, "group"))) goto loggedout
							
#JJ: If they login on their quit date after 4am
#after login_successful if (and(...
#							loadvalue (username, "session") = 2,...
#							savevalue (username, "thirdlogintime", currenttime()),...
#							loadvalue(username, "group") = "intervention",...
#							currenttime() > +(loadvalue (username, "quitdate"), (-1*14400)),...
#							not(hasseen(username, "p2p03"))...
#				 			)) goto p4p01#Session 4 - Quit date page
#				 			#JJ: Note that the 14400 seconds above is 60s * 60m x 4h = 144000s.

#JJ: Pilot and RCT: Baseline pages for intervention group
#JB: Note sure why the two lines relating to setting group is needed - savevalue (username, "group", "intervention/control") exists after signup_confirm, and then always loaded in all other parts
#Probably a relic but not causing a problem, so leaving it.
#JB - post pilot - also if the reason ending up at baseline1a was becuase none of the above were applying also have show loggedout here as it will catch anything just flowing through.

show loggedout
 
show baseline1a
set group to loadvalue (username, "group")
if (1=0) set group to loadvalue (username, "group")
set outcomea_name to load signup.first_name for username
set outcomea_email to load signup.email for username
saveandload baseline1a for username
savevalue (username, "name", baseline1a.bname)
savevalue (username, "add1", baseline1a.baddress1)
savevalue (username, "add2", baseline1a.baddress2)
savevalue (username, "add3", baseline1a.baddress3)
savevalue (username, "add4", baseline1a.baddress4)
savevalue (username, "postcode", baseline1a.bpostcode)
savevalue (username, "bdttel", baseline1a.bdttel)
savevalue (username, "bevtel", baseline1a.bevtel)
savevalue (username, "bmobtel", baseline1a.bmobtel)

sendemail(append(username, "newparticipanta"),"stopsmoking@ucl.ac.uk", append(baseline1a.bname," has registered for the study and has been assigned to the intervention group"), append("Name: ",baseline1a.bname,"\nEmail: ",outcomea_email),10)

show baseline2a
saveandload baseline2a for username
show baseline3a
saveandload baseline3a for username
after baseline3a if (or(...
					baseline3a.bwork1 = "yes", baseline3a.bwork1 = "yes_student", baseline3a.bwork1 = "dont_know"...
					)) goto baseline4a 
after baseline3a if (baseline3a.bwork1 = "no") goto baseline5a					
show baseline4a
saveandload baseline4a for username
show baseline5a
saveandload baseline5a for username
show baseline6a
saveandload baseline6a for username
show baseline7a
saveandload baseline7a for username
show baseline8a
saveandload baseline8a for username

savevalue(username,"baseline8date", printtime(currenttime(),"H:m d-M-y"))
if (not(isempty(baseline8a.bfeel6))) set baseline8dateexport to loadvalue (username, "baseline8date")

set baseline8dateexport2 to 0
if (not(isempty(baseline8a.bfeel6))) set baseline8dateexport2 to currenttime()

savevalue(username, "completedba", "true") if (not(isempty(baseline8a.bfeel6)))

#JB - postpilot - changing order of code so that if already sent emails (i.e., reached this page in error) can't get a new allocatedtimea. Also, added not(hasseen) next page (awelcome).
#JB - RCT emails for outcomes; JB timings
after baseline8a if (and(...
					loadvalue(username, "group") = "intervention",...
					not(hasseen (username, "awelcome")),...
					savevalue(username, "allocatedtimea", currenttime()),...
					sendemail("rct_s1", username, "StopAdvisor - Your first session is unfinished", append ("Hello ",outcomea_name,",\n\nYou didn't finish your last session with ",...
					"StopAdvisor.\n\nPlease log in and start preparing to quit smoking: \n\nhttp://www.stopadvisor.co.uk \n\nBest wishes,\n\nYour StopAdvisor \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),delay24),...
					sendemail("rct_s1r1", username, "StopAdvisor reminder - Your first session is unfinished reminder", append ("Hello ",outcomea_name,",\n\nThis is a reminder that you ",...
					"didn't finish your last session with StopAdvisor.\n\nPlease log in and start preparing to quit smoking: \n\nhttp://www.stopadvisor.co.uk \n\nBest wishes,\n\nYour StopAdvisor \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),delay72),...
						sendemail("rct_m2a", username, "Quit smoking internet study: your second questionnaire is pending", append ("Hello ",outcomea_name,",\n\nYou are currently ",...
					"participating in University College London's Quit Smoking Internet Study. When consenting to participate in the study, you agreed to use a website whilst making a ",...
					"serious attempt to quit smoking, and then to answer questions about your smoking and the website.\n\nWe now need you to answer a short questionnaire about the study. ",...
					"Please take five minutes to log in and complete the questionnaire:\n\nhttp://www.stopadvisor.co.uk\n\nIf you are having problems logging in, please email us on ",...
					"stopsmoking@ucl.ac.uk\n\nAll the information you provide will be held in the strictest confidence, treated as strictly confidential and handled in accordance with ",...
					"the provisions of the Data Protection Act 1998.\n\nBest wishes,\n\nProfessor Robert West and Professor Susan Michie \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),4838400),...
						sendemail("rct_m2r1a", username, "Quit smoking internet study reminder: your second questionnaire is pending", append ("Hello ",outcomea_name,...
					",\n\nThis is a reminder that you are currently participating in University College London's Quit Smoking Internet Study. When consenting to participate in the study, ",...
					"you agreed to use a website whilst making a serious attempt to quit smoking, and then to answer questions about your smoking and the website.\n\nThis is also a reminder ",...
					"that a short questionnaire we need you to complete is unfinished. Please take five minutes to log in and complete the questionnaire:\n\nhttp://www.stopadvisor.co.uk\n\nFilling in ",...
					"the questionnaire will help us to improve the site, and hopefully benefit many thousands of other smokers who want to quit.\n\nIf you are having problems logging in, ",...
					"please email us on stopsmoking@ucl.ac.uk\n\nAll the information you provide will be held in the strictest confidence, treated as strictly confidential and handled in ",...
					"accordance with the provisions of the Data Protection Act 1998.\n\nBest wishes,\n\nProfessor Robert West and Professor Susan Michie \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),4924800),...
						sendemail("rct_m2r2a", username, "Quit smoking internet study reminder: your second questionnaire is pending", append ("Hello ",outcomea_name,",\n\nThis is a ",...
					"reminder that you are currently participating in University College London's Quit Smoking Internet Study. When consenting to participate in the study, you agreed to ",...
					"use a website whilst making a serious attempt to quit smoking, and then to answer questions about your smoking and the website.\n\nThis is another reminder that a ",...
					"short questionnaire we need you to complete is unfinished. Please take five minutes to log in and complete the questionnaire:\n\nhttp://www.stopadvisor.co.uk\n\nIf you are ",...
					"having problems logging in, please email us on stopsmoking@ucl.ac.uk\n\nAll the information you provide will be held in the strictest confidence, treated as strictly ",...
					"confidential and handled in accordance with the provisions of the Data Protection Act 1998.\n\nBest wishes,\n\nProfessor Robert West and Professor Susan Michie \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),5097600),...
						sendemail("rct_m2r3a", username, "Quit smoking internet study final reminder: your second questionnaire is pending", append ("Hello ",outcomea_name,",\n\nThis ",...
					"is a reminder that you are currently participating in University College London's Quit Smoking Internet Study. When consenting to participate in the study, you agreed ",...
					"to use a website whilst making a serious attempt to quit smoking, and then to answer questions about your smoking and the website.\n\nThis is also a final reminder that ",...
					"a short questionnaire we need you to complete is unfinished. Please take five minutes to log in and complete the questionnaire:\n\nhttp://www.stopadvisor.co.uk\n\nIf you are ",...
					"having problems logging in, please email us on stopsmoking@ucl.ac.uk\n\nAll the information you provide will be held in the strictest confidence, treated as strictly ",...
					"confidential and handled in accordance with the provisions of the Data Protection Act 1998.\n\nBest wishes,\n\nProfessor Robert West and Professor Susan Michie \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),5356800),...
					sendemail(append(username, "rct_m2a_notcompleted"), "stopsmoking@ucl.ac.uk", "Participant has not completed m2 outcomes", append(outcomea_email," has not completed the m2 questions"), 5443200),...
						sendemail("rct_m4a", username, "Quit smoking internet study: your third questionnaire is pending", append ("Hello ",outcomea_name,",\n\nYou are currently ",...
					"participating in University College London's Quit Smoking Internet Study. When consenting to participate in the study, you agreed to use a website whilst making a ",...
					"serious attempt to quit smoking, and then to answer questions about your smoking and the website.\n\nWe now need you to answer a short questionnaire about the study. ",...
					"Please take five minutes to log in and complete the questionnaire:\n\nhttp://www.stopadvisor.co.uk\n\nIf you are having problems logging in, please email us on ",...
					"stopsmoking@ucl.ac.uk\n\nAll the information you provide will be held in the strictest confidence, treated as strictly confidential and handled in accordance with ",...
					"the provisions of the Data Protection Act 1998.\n\nBest wishes,\n\nProfessor Robert West and Professor Susan Michie \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),9676800),...
						sendemail("rct_m4r1a", username, "Quit smoking internet study reminder: your third questionnaire is pending", append ("Hello ",outcomea_name,...
					",\n\nThis is a reminder that you are currently participating in University College London's Quit Smoking Internet Study. When consenting to participate in the study, ",...
					"you agreed to use a website whilst making a serious attempt to quit smoking, and then to answer questions about your smoking and the website.\n\nThis is also a reminder ",...
					"that a short questionnaire we need you to complete is unfinished. Please take five minutes to log in and complete the questionnaire:\n\nhttp://www.stopadvisor.co.uk\n\nFilling in ",...
					"the questionnaire will help us to improve the site, and hopefully benefit many thousands of other smokers who want to quit.\n\nIf you are having problems logging in, ",...
					"please email us on stopsmoking@ucl.ac.uk\n\nAll the information you provide will be held in the strictest confidence, treated as strictly confidential and handled in ",...
					"accordance with the provisions of the Data Protection Act 1998.\n\nBest wishes,\n\nProfessor Robert West and Professor Susan Michie \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),9763200),...
						sendemail("rct_m4r2a", username, "Quit smoking internet study reminder: your third questionnaire is pending", append ("Hello ",outcomea_name,",\n\nThis is a ",...
					"reminder that you are currently participating in University College London's Quit Smoking Internet Study. When consenting to participate in the study, you agreed to ",...
					"use a website whilst making a serious attempt to quit smoking, and then to answer questions about your smoking and the website.\n\nThis is another reminder that a ",...
					"short questionnaire we need you to complete is unfinished. Please take five minutes to log in and complete the questionnaire:\n\nhttp://www.stopadvisor.co.uk\n\nIf you are ",...
					"having problems logging in, please email us on stopsmoking@ucl.ac.uk\n\nAll the information you provide will be held in the strictest confidence, treated as strictly ",...
					"confidential and handled in accordance with the provisions of the Data Protection Act 1998.\n\nBest wishes,\n\nProfessor Robert West and Professor Susan Michie \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),9936000),...
						sendemail("rct_m4r3a", username, "Quit smoking internet study final reminder: your third questionnaire is pending", append ("Hello ",outcomea_name,",\n\nThis ",...
					"is a reminder that you are currently participating in University College London's Quit Smoking Internet Study. When consenting to participate in the study, you agreed ",...
					"to use a website whilst making a serious attempt to quit smoking, and then to answer questions about your smoking and the website.\n\nThis is also a final reminder that ",...
					"a short questionnaire we need you to complete is unfinished. Please take five minutes to log in and complete the questionnaire:\n\nhttp://www.stopadvisor.co.uk\n\nIf you are ",...
					"having problems logging in, please email us on stopsmoking@ucl.ac.uk\n\nAll the information you provide will be held in the strictest confidence, treated as strictly ",...
					"confidential and handled in accordance with the provisions of the Data Protection Act 1998.\n\nBest wishes,\n\nProfessor Robert West and Professor Susan Michie \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),10195200),...
					sendemail(append(username, "rct_m4a_notcompleted"), "stopsmoking@ucl.ac.uk", "Participant has not completed m4 outcomes", append(outcomea_email," has not completed the m4 questions"), 10281600),...
						sendemail("rct_m7a", username, "Quit smoking internet study: your final questionnaire is pending", append ("Hello ",outcomea_name,",\n\nYou are currently ",...
					"participating in University College London's Quit Smoking Internet Study. When consenting to participate in the study, you agreed to use a website whilst making a ",...
					"serious attempt to quit smoking, and then to answer questions about your smoking and the website.\n\nWe now need you to answer a short questionnaire about the study. ",...
					"Please take five minutes to log in and complete the questionnaire:\n\nhttp://www.stopadvisor.co.uk\n\nIf you are having problems logging in, please email us on ",...
					"stopsmoking@ucl.ac.uk\n\nAll the information you provide will be held in the strictest confidence, treated as strictly confidential and handled in accordance with ",...
					"the provisions of the Data Protection Act 1998.\n\nBest wishes,\n\nProfessor Robert West and Professor Susan Michie \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),16934400),...
						sendemail("rct_m7r1a", username, "Quit smoking internet study reminder: your final questionnaire is pending", append ("Hello ",outcomea_name,...
					",\n\nThis is a reminder that you are currently participating in University College London's Quit Smoking Internet Study. When consenting to participate in the study, ",...
					"you agreed to use a website whilst making a serious attempt to quit smoking, and then to answer questions about your smoking and the website.\n\nThis is also a reminder ",...
					"that a short questionnaire we need you to complete is unfinished. Please take five minutes to log in and complete the questionnaire:\n\nhttp://www.stopadvisor.co.uk\n\nFilling in ",...
					"the questionnaire will help us to improve the site, and hopefully benefit many thousands of other smokers who want to quit.\n\nIf you are having problems logging in, ",...
					"please email us on stopsmoking@ucl.ac.uk\n\nAll the information you provide will be held in the strictest confidence, treated as strictly confidential and handled in ",...
					"accordance with the provisions of the Data Protection Act 1998.\n\nBest wishes,\n\nProfessor Robert West and Professor Susan Michie \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),17020800),...
						sendemail("rct_m7r2a", username, "Quit smoking internet study reminder: your final questionnaire is pending", append ("Hello ",outcomea_name,",\n\nThis is a ",...
					"reminder that you are currently participating in University College London's Quit Smoking Internet Study. When consenting to participate in the study, you agreed to ",...
					"use a website whilst making a serious attempt to quit smoking, and then to answer questions about your smoking and the website.\n\nThis is another reminder that a ",...
					"short questionnaire we need you to complete is unfinished. Please take five minutes to log in and complete the questionnaire:\n\nhttp://www.stopadvisor.co.uk\n\nIf you are ",...
					"having problems logging in, please email us on stopsmoking@ucl.ac.uk\n\nAll the information you provide will be held in the strictest confidence, treated as strictly ",...
					"confidential and handled in accordance with the provisions of the Data Protection Act 1998.\n\nBest wishes,\n\nProfessor Robert West and Professor Susan Michie \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),17193600),...
						sendemail("rct_m7r3a", username, "Quit smoking internet study final reminder: your final questionnaire is pending", append ("Hello ",outcomea_name,",\n\nThis ",...
					"is a reminder that you are currently participating in University College London's Quit Smoking Internet Study. When consenting to participate in the study, you agreed ",...
					"to use a website whilst making a serious attempt to quit smoking, and then to answer questions about your smoking and the website.\n\nThis is also a final reminder that ",...
					"a short questionnaire we need you to complete is unfinished. Please take five minutes to log in and complete the questionnaire:\n\nhttp://www.stopadvisor.co.uk\n\nIf you are ",...
					"having problems logging in, please email us on stopsmoking@ucl.ac.uk\n\nAll the information you provide will be held in the strictest confidence, treated as strictly ",...
					"confidential and handled in accordance with the provisions of the Data Protection Act 1998.\n\nBest wishes,\n\nProfessor Robert West and Professor Susan Michie \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),17452800),...
					sendemail(append(username, "rct_m7a_notcompleted"), "stopsmoking@ucl.ac.uk", "Participant has not completed m7 outcomes", append(outcomea_email," has not completed the m7 questions"), 17539200),...
					sendemail("welcome_sa", username, "Welcome to StopAdvisor", append ("Hello ",welcome_sa_name,",\n\nWelcome to StopAdvisor: \n\nhttp://www.stopadvisor.co.uk \n\nWe will provide you ",...
					"with expert support and advice while you quit smoking.\n\nStopAdvisor comes as a series of short, interactive sessions - or, in other words, 'chats' with your StopAdvisor. In ",...
					"each one, we will ask you questions and then give you personal advice and tips.\n\nWhenever a new session is ready, we'll send you an email or text to let you know.\n\nPlan to ",...
					"log in when you have a spare 10 minutes and try to avoid logging off before the end - you'll miss important advice.\n\nIf you log in before a new session is ready, you can look ",...
					"through some general information and advice.\n\nPlease email us on stopsmoking@ucl.ac.uk if you have any problems with the website. We recommend viewing the site in Internet Explorer 7 or above, Firefox 3 or above or Chrome.\n\nBest wishes,\n\nYour StopAdvisor \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),10),...
					cancelemail ("baseline_a",loadvalue (username, "email")),...
					cancelemail("baseline_r1a",loadvalue (username, "email")),...
					cancelemail ("baseline_r2a",loadvalue (username, "email")),...
					cancelemail(append(username, "ba_notcompleted"), "stopsmoking@ucl.ac.uk")...
					)) goto awelcome
					
after baseline8a if (loadvalue(username, "group") = "intervention") goto awelcome					
							
#JJ: RCT: Baseline pages for control group
show baseline1b
set outcomeb_name to load signup.first_name for username
set outcomeb_email to load signup.email for username
saveandload baseline1b for username
savevalue (username, "name", baseline1b.bname)
savevalue (username, "add1", baseline1b.baddress1)
savevalue (username, "add2", baseline1b.baddress2)
savevalue (username, "add3", baseline1b.baddress3)
savevalue (username, "add4", baseline1b.baddress4)
savevalue (username, "postcode", baseline1b.bpostcode)
savevalue (username, "bdttel", baseline1b.bdttel)
savevalue (username, "bevtel", baseline1b.bevtel)
savevalue (username, "bmobtel", baseline1b.bmobtel)
sendemail(append(username, "newparticipantb"),"stopsmoking@ucl.ac.uk", append(baseline1b.bname," has registered for the study and is in the control group"), append("Name: ",baseline1b.bname,"\nEmail: ",outcomeb_email),10)
show baseline2b
saveandload baseline2b for username
show baseline3b
saveandload baseline3b for username
after baseline3b if (or(...
					baseline3b.bwork1 = "yes", baseline3b.bwork1 = "yes_student", baseline3b.bwork1 = "dont_know"...
					)) goto baseline4b
after baseline3b if (baseline3b.bwork1 = "no") goto baseline5b	
show baseline4b
saveandload baseline4b for username
show baseline5b
saveandload baseline5b for username
show baseline6b
saveandload baseline6b for username
show baseline7b
saveandload baseline7b for username
show baseline8b
saveandload baseline8b for username
savevalue(username, "completedbb", "true") if (not(isempty(baseline8b.bfeel6)))
after baseline8b if (and(...
					loadvalue(username, "group") = "control",...
					not(hasseen (username, "quitsmokingaccess")),...
					savevalue(username, "allocatedtimeb", currenttime()),...
						sendemail("rct_m2b", username, "Quit smoking internet study: your second questionnaire is pending", append ("Hello ",outcomeb_name,",\n\nYou are currently ",...
					"participating in University College London's Quit Smoking Internet Study. When consenting to participate in the study, you agreed to use a website whilst making a ",...
					"serious attempt to quit smoking, and then to answer questions about your smoking and the website.\n\nWe now need you to answer a short questionnaire about the study. ",...
					"Please take five minutes to log in and complete the questionnaire:\n\nhttp://www.quitsmokingstudy.co.uk\n\nIf you are having problems logging in, please email us on ",...
					"stopsmoking@ucl.ac.uk\n\nAll the information you provide will be held in the strictest confidence, treated as strictly confidential and handled in accordance with ",...
					"the provisions of the Data Protection Act 1998.\n\nBest wishes,\n\nProfessor Robert West and Professor Susan Michie \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),4838400),...
						sendemail("rct_m2r1b", username, "Quit smoking internet study reminder: your second questionnaire is pending", append ("Hello ",outcomeb_name,...
					",\n\nThis is a reminder that you are currently participating in University College London's Quit Smoking Internet Study. When consenting to participate in the study, ",...
					"you agreed to use a website whilst making a serious attempt to quit smoking, and then to answer questions about your smoking and the website.\n\nThis is also a reminder ",...
					"that a short questionnaire we need you to complete is unfinished. Please take five minutes to log in and complete the questionnaire:\n\nhttp://www.quitsmokingstudy.co.uk\n\nFilling in ",...
					"the questionnaire will help us to improve the site, and hopefully benefit many thousands of other smokers who want to quit.\n\nIf you are having problems logging in, ",...
					"please email us on stopsmoking@ucl.ac.uk\n\nAll the information you provide will be held in the strictest confidence, treated as strictly confidential and handled in ",...
					"accordance with the provisions of the Data Protection Act 1998.\n\nBest wishes,\n\nProfessor Robert West and Professor Susan Michie \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),4924800),...
						sendemail("rct_m2r2b", username, "Quit smoking internet study reminder: your second questionnaire is pending", append ("Hello ",outcomeb_name,",\n\nThis is a ",...
					"reminder that you are currently participating in University College London's Quit Smoking Internet Study. When consenting to participate in the study, you agreed to ",...
					"use a website whilst making a serious attempt to quit smoking, and then to answer questions about your smoking and the website.\n\nThis is another reminder that a ",...
					"short questionnaire we need you to complete is unfinished. Please take five minutes to log in and complete the questionnaire:\n\nhttp://www.quitsmokingstudy.co.uk\n\nIf you are ",...
					"having problems logging in, please email us on stopsmoking@ucl.ac.uk\n\nAll the information you provide will be held in the strictest confidence, treated as strictly ",...
					"confidential and handled in accordance with the provisions of the Data Protection Act 1998.\n\nBest wishes,\n\nProfessor Robert West and Professor Susan Michie \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),5097600),...
						sendemail("rct_m2r3b", username, "Quit smoking internet study final reminder: your second questionnaire is pending", append ("Hello ",outcomeb_name,",\n\nThis ",...
					"is a reminder that you are currently participating in University College London's Quit Smoking Internet Study. When consenting to participate in the study, you agreed ",...
					"to use a website whilst making a serious attempt to quit smoking, and then to answer questions about your smoking and the website.\n\nThis is also a final reminder that ",...
					"a short questionnaire we need you to complete is unfinished. Please take five minutes to log in and complete the questionnaire:\n\nhttp://www.quitsmokingstudy.co.uk\n\nIf you are ",...
					"having problems logging in, please email us on stopsmoking@ucl.ac.uk\n\nAll the information you provide will be held in the strictest confidence, treated as strictly ",...
					"confidential and handled in accordance with the provisions of the Data Protection Act 1998.\n\nBest wishes,\n\nProfessor Robert West and Professor Susan Michie \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),5356800),...
					sendemail(append(username, "rct_m2b_notcompleted"), "stopsmoking@ucl.ac.uk", "Participant has not completed m2 outcomes", append(outcomeb_email," has not completed the m2 questions"), 5443200),...
						sendemail("rct_m4b", username, "Quit smoking internet study: your third questionnaire is pending", append ("Hello ",outcomeb_name,",\n\nYou are currently ",...
					"participating in University College London's Quit Smoking Internet Study. When consenting to participate in the study, you agreed to use a website whilst making a ",...
					"serious attempt to quit smoking, and then to answer questions about your smoking and the website.\n\nWe now need you to answer a short questionnaire about the study. ",...
					"Please take five minutes to log in and complete the questionnaire:\n\nhttp://www.quitsmokingstudy.co.uk\n\nIf you are having problems logging in, please email us on ",...
					"stopsmoking@ucl.ac.uk\n\nAll the information you provide will be held in the strictest confidence, treated as strictly confidential and handled in accordance with ",...
					"the provisions of the Data Protection Act 1998.\n\nBest wishes,\n\nProfessor Robert West and Professor Susan Michie \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),9676800),...
						sendemail("rct_m4r1b", username, "Quit smoking internet study reminder: your third questionnaire is pending", append ("Hello ",outcomeb_name,...
					",\n\nThis is a reminder that you are currently participating in University College London's Quit Smoking Internet Study. When consenting to participate in the study, ",...
					"you agreed to use a website whilst making a serious attempt to quit smoking, and then to answer questions about your smoking and the website.\n\nThis is also a reminder ",...
					"that a short questionnaire we need you to complete is unfinished. Please take five minutes to log in and complete the questionnaire:\n\nhttp://www.quitsmokingstudy.co.uk\n\nFilling in ",...
					"the questionnaire will help us to improve the site, and hopefully benefit many thousands of other smokers who want to quit.\n\nIf you are having problems logging in, ",...
					"please email us on stopsmoking@ucl.ac.uk\n\nAll the information you provide will be held in the strictest confidence, treated as strictly confidential and handled in ",...
					"accordance with the provisions of the Data Protection Act 1998.\n\nBest wishes,\n\nProfessor Robert West and Professor Susan Michie \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),9763200),...
						sendemail("rct_m4r2b", username, "Quit smoking internet study reminder: your third questionnaire is pending", append ("Hello ",outcomeb_name,",\n\nThis is a ",...
					"reminder that you are currently participating in University College London's Quit Smoking Internet Study. When consenting to participate in the study, you agreed to ",...
					"use a website whilst making a serious attempt to quit smoking, and then to answer questions about your smoking and the website.\n\nThis is another reminder that a ",...
					"short questionnaire we need you to complete is unfinished. Please take five minutes to log in and complete the questionnaire:\n\nhttp://www.quitsmokingstudy.co.uk\n\nIf you are ",...
					"having problems logging in, please email us on stopsmoking@ucl.ac.uk\n\nAll the information you provide will be held in the strictest confidence, treated as strictly ",...
					"confidential and handled in accordance with the provisions of the Data Protection Act 1998.\n\nBest wishes,\n\nProfessor Robert West and Professor Susan Michie \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),9936000),...
						sendemail("rct_m4r3b", username, "Quit smoking internet study final reminder: your third questionnaire is pending", append ("Hello ",outcomeb_name,",\n\nThis ",...
					"is a reminder that you are currently participating in University College London's Quit Smoking Internet Study. When consenting to participate in the study, you agreed ",...
					"to use a website whilst making a serious attempt to quit smoking, and then to answer questions about your smoking and the website.\n\nThis is also a final reminder that ",...
					"a short questionnaire we need you to complete is unfinished. Please take five minutes to log in and complete the questionnaire:\n\nhttp://www.quitsmokingstudy.co.uk\n\nIf you are ",...
					"having problems logging in, please email us on stopsmoking@ucl.ac.uk\n\nAll the information you provide will be held in the strictest confidence, treated as strictly ",...
					"confidential and handled in accordance with the provisions of the Data Protection Act 1998.\n\nBest wishes,\n\nProfessor Robert West and Professor Susan Michie \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),10195200),...
					sendemail(append(username, "rct_m4b_notcompleted"), "stopsmoking@ucl.ac.uk", "Participant has not completed m4 outcomes", append(outcomeb_email," has not completed the m4 questions"), 10281600),...
						sendemail("rct_m7b", username, "Quit smoking internet study: your final questionnaire is pending", append ("Hello ",outcomeb_name,",\n\nYou are currently ",...
					"participating in University College London's Quit Smoking Internet Study. When consenting to participate in the study, you agreed to use a website whilst making a ",...
					"serious attempt to quit smoking, and then to answer questions about your smoking and the website.\n\nWe now need you to answer a short questionnaire about the study. ",...
					"Please take five minutes to log in and complete the questionnaire:\n\nhttp://www.quitsmokingstudy.co.uk\n\nIf you are having problems logging in, please email us on ",...
					"stopsmoking@ucl.ac.uk\n\nAll the information you provide will be held in the strictest confidence, treated as strictly confidential and handled in accordance with ",...
					"the provisions of the Data Protection Act 1998.\n\nBest wishes,\n\nProfessor Robert West and Professor Susan Michie \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),16934400),...
						sendemail("rct_m7r1b", username, "Quit smoking internet study reminder: your final questionnaire is pending", append ("Hello ",outcomeb_name,...
					",\n\nThis is a reminder that you are currently participating in University College London's Quit Smoking Internet Study. When consenting to participate in the study, ",...
					"you agreed to use a website whilst making a serious attempt to quit smoking, and then to answer questions about your smoking and the website.\n\nThis is also a reminder ",...
					"that a short questionnaire we need you to complete is unfinished. Please take five minutes to log in and complete the questionnaire:\n\nhttp://www.quitsmokingstudy.co.uk\n\nFilling in ",...
					"the questionnaire will help us to improve the site, and hopefully benefit many thousands of other smokers who want to quit.\n\nIf you are having problems logging in, ",...
					"please email us on stopsmoking@ucl.ac.uk\n\nAll the information you provide will be held in the strictest confidence, treated as strictly confidential and handled in ",...
					"accordance with the provisions of the Data Protection Act 1998.\n\nBest wishes,\n\nProfessor Robert West and Professor Susan Michie \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),17020800),...
						sendemail("rct_m7r2b", username, "Quit smoking internet study reminder: your final questionnaire is pending", append ("Hello ",outcomeb_name,",\n\nThis is a ",...
					"reminder that you are currently participating in University College London's Quit Smoking Internet Study. When consenting to participate in the study, you agreed to ",...
					"use a website whilst making a serious attempt to quit smoking, and then to answer questions about your smoking and the website.\n\nThis is another reminder that a ",...
					"short questionnaire we need you to complete is unfinished. Please take five minutes to log in and complete the questionnaire:\n\nhttp://www.quitsmokingstudy.co.uk\n\nIf you are ",...
					"having problems logging in, please email us on stopsmoking@ucl.ac.uk\n\nAll the information you provide will be held in the strictest confidence, treated as strictly ",...
					"confidential and handled in accordance with the provisions of the Data Protection Act 1998.\n\nBest wishes,\n\nProfessor Robert West and Professor Susan Michie \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),17193600),...
						sendemail("rct_m7r3b", username, "Quit smoking internet study final reminder: your final questionnaire is pending", append ("Hello ",outcomeb_name,",\n\nThis ",...
					"is a reminder that you are currently participating in University College London's Quit Smoking Internet Study. When consenting to participate in the study, you agreed ",...
					"to use a website whilst making a serious attempt to quit smoking, and then to answer questions about your smoking and the website.\n\nThis is also a final reminder that ",...
					"a short questionnaire we need you to complete is unfinished. Please take five minutes to log in and complete the questionnaire:\n\nhttp://www.quitsmokingstudy.co.uk\n\nIf you are ",...
					"having problems logging in, please email us on stopsmoking@ucl.ac.uk\n\nAll the information you provide will be held in the strictest confidence, treated as strictly ",...
					"confidential and handled in accordance with the provisions of the Data Protection Act 1998.\n\nBest wishes,\n\nProfessor Robert West and Professor Susan Michie \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),17452800),...
					sendemail(append(username, "rct_m7b_notcompleted"), "stopsmoking@ucl.ac.uk", "Participant has not completed m7 outcomes", append(outcomeb_email," has not completed the m7 questions"), 17539200),...
					sendemail("welcome_sb", username, "Welcome to your stop smoking website", append ("Hello ",outcomeb_name,",\n\nWelcome to your stop smoking website: http://www.quitsmokingstudy.co.uk\n\nThis site ",...
					"will provide you with expert advice while you quit smoking.\n\nPlease email us on stopsmoking@ucl.ac.uk if you have any problems with the website.\n\nBest wishes,\n\nUCL's Stop Smoking Team "),10),...
					cancelemail ("baseline_b", loadvalue (username, "email")),...
					cancelemail ("baseline_r1b", loadvalue (username, "email")),...
					cancelemail ("baseline_r2b", loadvalue (username, "email")),...
					cancelemail (append(username, "bb_notcompleted"), "stopsmoking@ucl.ac.uk")...
					)) goto quitsmokingaccess

#jb - email above still have names in subject to speed testing; email-names
					
after baseline8b if (loadvalue(username, "group") = "control") goto quitsmokingaccess					

#JJ: RCT intervention group and pilot outcomes month 2 (NB for RCT remove final 'show outcome1pilot5a', and make outcome pages identical between a and b versions).
#JB: RCT - Remove sendemail m2 done.
show outcome1rctp1a
saveandload outcome1rctp1a for username
show outcome1rctp2a
saveandload outcome1rctp2a for username
show outcome1rctp3a
saveandload outcome1rctp3a for username
savevalue(username,"outcome1rctp3adate", printtime(currenttime(),"H:m d-M-y"))
if (not(isempty(outcome1rctp3a.o1pmed1))) set outcome1rctp3adateexport to loadvalue (username, "outcome1rctp3adate")
savevalue(username, "completedrctm2a", "true") if (not(isempty(outcome1rctp3a.o1pmed1)))
cancelemail ("rct_m2a", loadvalue (username, "email"))
cancelemail ("rct_m2r1a", loadvalue (username, "email"))
cancelemail ("rct_m2r2a", loadvalue (username, "email"))
cancelemail ("rct_m2r3a", loadvalue (username, "email"))
set outcomem2adone_email to load signup.email for username
sendemail(append(username, "rct_m2a_completed"), "stopsmoking@ucl.ac.uk", "Participant has completed m2 outcomes", append(outcomem2adone_email," has completed the m2 questions"), 10)
cancelemail (append(username, "rct_m2a_notcompleted"), "stopsmoking@ucl.ac.uk")
show outcome1rctp4a

#JJ: RCT control group outcomes month 2 (remove for pilot)
show outcome1rctp1b
saveandload outcome1rctp1b for username
show outcome1rctp2b
saveandload outcome1rctp2b for username
show outcome1rctp3b
saveandload outcome1rctp3b for username
savevalue(username,"outcome1rctp3bdate", printtime(currenttime(),"H:m d-M-y"))
if (not(isempty(outcome1rctp3b.o1pmed1))) set outcome1rctp3bdateexport to loadvalue (username, "outcome1rctp3bdate")
savevalue(username, "completedrctm2b", "true") if (not(isempty(outcome1rctp3b.o1pmed1)))
cancelemail ("rct_m2b", loadvalue (username, "email"))
cancelemail ("rct_m2r1b", loadvalue (username, "email"))
cancelemail ("rct_m2r2b", loadvalue (username, "email"))
cancelemail ("rct_m2r3b", loadvalue (username, "email"))
set outcomem2bdone_email to load signup.email for username
sendemail(append(username, "rct_m2b_completed"), "stopsmoking@ucl.ac.uk", "Participant has completed m2 outcomes", append(outcomem2bdone_email," has completed the m2 questions"), 10)
cancelemail (append(username, "rct_m2b_notcompleted"), "stopsmoking@ucl.ac.uk")
show outcome1rctp4b

#JJ: RCT intervention group outcomes month 4 (remove for pilot)
show outcome2rctp1a
saveandload outcome2rctp1a for username
savevalue(username,"outcome2rctp1adate", printtime(currenttime(),"H:m d-M-y"))
if (not(isempty(outcome2rctp1a.o1psmoke))) set outcome2rctp1adateexport to loadvalue (username, "outcome2rctp1adate")
savevalue(username, "completedrctm4a", "true") if (not(isempty(outcome2rctp1a.o1psmoke)))
cancelemail ("rct_m4a", loadvalue (username, "email"))
cancelemail ("rct_m4r1a", loadvalue (username, "email"))
cancelemail ("rct_m4r2a", loadvalue (username, "email"))
cancelemail ("rct_m4r3a", loadvalue (username, "email"))
set outcomem4adone_email to load signup.email for username
sendemail(append(username, "rct_m4a_completed"), "stopsmoking@ucl.ac.uk", "Participant has completed m4 outcomes", append(outcomem4adone_email," has completed the m4 questions"), 10)
cancelemail (append(username, "rct_m4a_notcompleted"), "stopsmoking@ucl.ac.uk")
show outcome2rctp2a

#JJ: RCT control group outcomes month 4 (remove for pilot)
show outcome2rctp1b
saveandload outcome2rctp1b for username
savevalue(username,"outcome2rctp1bdate", printtime(currenttime(),"H:m d-M-y"))
if (not(isempty(outcome2rctp1b.o1psmoke))) set outcome2rctp1bdateexport to loadvalue (username, "outcome2rctp1bdate")
savevalue(username, "completedrctm4b", "true") if (not(isempty(outcome2rctp1b.o1psmoke)))
cancelemail ("rct_m4b", loadvalue (username, "email"))
cancelemail ("rct_m4r1b", loadvalue (username, "email"))
cancelemail ("rct_m4r2b", loadvalue (username, "email"))
cancelemail ("rct_m4r3b", loadvalue (username, "email"))
set outcomem4bdone_email to load signup.email for username
sendemail(append(username, "rct_m4b_completed"), "stopsmoking@ucl.ac.uk", "Participant has completed m4 outcomes", append(outcomem4bdone_email," has completed the m4 questions"), 10)
cancelemail (append(username, "rct_m4b_notcompleted"), "stopsmoking@ucl.ac.uk")
show outcome2rctp2b
					
#JJ: RCT intervention group outcomes month 7 (remove for pilot)
show outcome3rctp1a
saveandload outcome3rctp1a for username
show outcome3rctp2a
saveandload outcome3rctp2a for username
show outcome3rctp3a
saveandload outcome3rctp3a for username
savevalue(username,"outcome3rctp3adate", printtime(currenttime(),"H:m d-M-y"))
if (not(isempty(outcome3rctp3a.o1pmed1))) set outcome3rctp3adateexport to loadvalue (username, "outcome3rctp3adate")
savevalue(username, "completedrctm7a", "true") if (not(isempty(outcome3rctp3a.o1pmed1)))
cancelemail ("rct_m7a", loadvalue (username, "email"))
cancelemail ("rct_m7r1a", loadvalue (username, "email"))
cancelemail ("rct_m7r2a", loadvalue (username, "email"))
cancelemail ("rct_m7r3a", loadvalue (username, "email"))
set outcomem7adone_email to load signup.email for username
sendemail(append(username, "rct_m7a_completed"), "stopsmoking@ucl.ac.uk", "Participant has completed m7 outcomes", append(outcomem7adone_email," has completed the m7 questions"), 10)
cancelemail (append(username, "rct_m7a_notcompleted"), "stopsmoking@ucl.ac.uk")
show outcome3rctp4a
show outcome3rctp5a

#JJ: RCT control group outcomes month 7 (remove for pilot)
show outcome3rctp1b
saveandload outcome3rctp1b for username
show outcome3rctp2b
saveandload outcome3rctp2b for username
show outcome3rctp3b
saveandload outcome3rctp3b for username
savevalue(username,"outcome3rctp3bdate", printtime(currenttime(),"H:m d-M-y"))
if (not(isempty(outcome3rctp3b.o1pmed1))) set outcome3rctp3bdateexport to loadvalue (username, "outcome3rctp3bdate")
savevalue(username, "completedrctm7b", "true") if (not(isempty(outcome3rctp3b.o1pmed1)))
cancelemail ("rct_m7b", loadvalue (username, "email"))
cancelemail ("rct_m7r1b", loadvalue (username, "email"))
cancelemail ("rct_m7r2b", loadvalue (username, "email"))
cancelemail ("rct_m7r3b", loadvalue (username, "email"))
set outcomem7bdone_email to load signup.email for username
sendemail(append(username, "rct_m7b_completed"), "stopsmoking@ucl.ac.uk", "Participant has completed m7 outcomes", append(outcomem7bdone_email," has completed the m7 questions"), 10)
cancelemail (append(username, "rct_m7b_notcompleted"), "stopsmoking@ucl.ac.uk")
show outcome3rctp4b
show outcome3rctp5b

#JJ: Start of StopAdvisor
#JB added show pmenuteam04 and pmenuuse02 and 03
show awelcome
set welcome_sa_name to load signup.first_name for username

show pmenu
show pmenuwhystop
show pmenuuse
show pmenuuse02
show pmenuuse03
show pmenuteam
show pmenuteam02
show pmenuteam03
show pmenuteam04
show pmenuteam05
show pmenudifferent
show pmenudifferent02
show pmenufeel
show pmenufeel02
show pmenuneed
show pmenucontact
show pmenucredit

#SECTION ONE - PRE-QUIT (p1) - INTRO AND MEDICATION CHOICE - 
#This section is a simple section showing people information about cravings and the important
#information about medication sections.

begin introduction
show p1p01
show p1p02
show p1p02a
show p1p02b
show p1p02c
save p1p02c for username
savevalue(username, "motive1", "motivation1") if (p1p02c.stopreason contains "motivation1")
savevalue(username, "motive2", "motivation2") if (p1p02c.stopreason contains "motivation2")
savevalue(username, "motive3", "motivation3") if (p1p02c.stopreason contains "motivation3")
savevalue(username, "motive4", "motivation4") if (p1p02c.stopreason contains "motivation4")
savevalue(username, "motive5", "motivation5") if (p1p02c.stopreason contains "motivation5")

show p1p03
show p1p04
show p1p0402
show p1p04a
show p1p04b
show p1p04bpatch
show p1p04blozenge
show p1p04bgum
show p1p04binhalator
show p1p04bmicro
show p1p04bnasalspray

#S1: Chosing medication section
#In this section, users decide whether they would like to use medication with the website. Importantly, 
#variables yestomed and notomed are used in a section below to create a set variable that provides all participants
#medication information in one variable i.e. whether they are taking it or not, and if they are, what they are taking. 
#This will be explained in more detail further down the in the logic. The latter part of this section, shows each user
#a new page depending on how long they decide to allow themselves to get medication. After each page confirming how long a 
#user has chosen to get their medication, email logic is used to send out an email that matches the time they have 
#selected. So if they select they will take 3 days they will see 'p1p08_3days' then be sent an email three days later.

show p1p06concern
show p1p05
set p1p05.name01 to load signup.first_name for username
save p1p05.usemed01 for username

after p1p05 if (and(...
				loadvalue(username, "group") = "intervention",...
				(p1p05.usemed01 = "havemed03")...
				)) goto p1p08medselect03

after p1p05 if (and(...
				loadvalue(username, "group") = "intervention",...
				(p1p05.usemed01 = "yestomed"),...
				savevalue (username, "medmoretime1", currenttime())...
				)) goto p1p08withmed

#show p1p08withmed if (p1p05.usemed01 = "yestomed")

after p1p05 if (and(...
				loadvalue(username, "group") = "intervention",...
				(p1p05.usemed01 = "notomed"),...
				savevalue(username, "none", "notomed"),...
				cancelemail ("rct_s1", loadvalue (username, "email")),...
				cancelemail ("rct_s1r1", loadvalue (username, "email"))...
				)) goto p1p07nomed

show p1p08medselect03 

save p1p08medselect03.medchoice03 for username

after p1p08medselect03 if (and(...
						p1p05.usemed01 = "havemed03",...
						savevalue(username, "usemed4", p1p08medselect03.medchoice03),...
						savevalue(username, "usemed5", "havemed03"),...
						cancelemail ("rct_s1", loadvalue (username, "email")),...
						cancelemail ("rct_s1r1", loadvalue (username, "email")),...
						1=0)) goto p1p08usechamp03
						
show p1p08usechamp03 if (p1p08medselect03.medchoice03 = "champix_03")
show p1p08usezyban03 if (p1p08medselect03.medchoice03 = "zyban_03")
show p1p08usegum03 if (p1p08medselect03.medchoice03 = "gum_03")
show p1p08usepatch03 if (p1p08medselect03.medchoice03 = "patches_03")
show p1p08useloz03 if (p1p08medselect03.medchoice03 = "lozenges_03")
show p1p08usemicro03 if (p1p08medselect03.medchoice03 = "microtabs_03")
show p1p08useinhal03 if (p1p08medselect03.medchoice03 = "inhalator_03")
show p1p08usenasal03 if (p1p08medselect03.medchoice03 = "nasal_03")

show p1p08medselect03info

show p1p07nomed
show p1p08withmed
show p1p08withmeda
set gotmeds_name to load signup.first_name for username
save p1p08withmeda.days01 for username
# JB timings
after p1p08withmeda if (and(...
						(p1p08withmeda.days01 = "days_3"),...
						sendemail("gotmeds3days", username, "StopAdvisor - Did you get your medicine?", append ("Hello ",gotmeds_name,",\n\nYou said you would need three days to get ",...
						"your medicine. Log into your new session and tell us whether you have got it yet: \n\nhttp://www.stopadvisor.co.uk\n\nBest wishes,\n\nYour StopAdvisor \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),delay72),...
						sendemail("gotmeds3days_r1", username, "StopAdvisor reminder - Did you get your medicine?", append ("Hello ",gotmeds_name,",\n\nThis is a reminder ",...
						"that your newest StopAdvisor session is ready.\n\nPlease log in and tell us whether you have got your medicine, or whether you need more time: \n\nhttp://www.stopadvisor.co.uk",...
						"\n\nBest wishes,\n\nYour StopAdvisor \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),delay96),...
						sendemail("gotmeds3days_r2", username, "StopAdvisor final reminder - Did you get your medicine?", append ("Hello ",gotmeds_name,",\n\nThis is a last reminder ",...
						"that your newest StopAdvisor session is ready.\n\nPlease log in and tell us whether you need more time to get your medicine, or whether you'd prefer to quit without it: ",...
						"\n\nhttp://www.stopadvisor.co.uk\n\nWe won't email to remind you about this session again but it will be waiting for you whenever you log back in.\n\nBest wishes,\n\nYour ",...
						"StopAdvisor \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),delay144),...
						cancelemail ("rct_s1", loadvalue (username, "email")),...
						cancelemail ("rct_s1r1", loadvalue (username, "email"))...
					)) goto p1p08_3days
after p1p08withmeda if (p1p08withmeda.days01 = "days_3") goto p1p08_3days						
						
show p1p08_3days					
						
after p1p08withmeda if (and(...
					(p1p08withmeda.days01 = "days_5"),...
						sendemail("gotmeds5days", username, "StopAdvisor - Did you get your medicine?", append ("Hello ",gotmeds_name,",\n\nYou said you would need five days to get ",...
						"your medicine. Log into your new session and tell us whether you have got it yet: \n\nhttp://www.stopadvisor.co.uk\n\nBest wishes,\n\nYour StopAdvisor \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),delay120),...
						sendemail("gotmeds5days_r1", username, "StopAdvisor reminder - Did you get your medicine?", append ("Hello ",gotmeds_name,",\n\nThis is a reminder ",...
						"that your newest StopAdvisor session is ready.\n\nPlease log in and tell us whether you have got your medicine, or whether you need more time: \n\nhttp://www.stopadvisor.co.uk",...
						"\n\nBest wishes,\n\nYour StopAdvisor \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),delay144),...
						sendemail("gotmeds5days_r2", username, "StopAdvisor final reminder - Did you get your medicine?", append ("Hello ",gotmeds_name,",\n\nThis is a last reminder ",...
						"that your newest StopAdvisor session is ready.\n\nPlease log in and tell us whether you need more time to get your medicine, or whether you'd prefer to quit without it: ",...
						"\n\nhttp://www.stopadvisor.co.uk\n\nWe won't email to remind you about this session again but it will be waiting for you whenever you log back in.\n\nBest wishes,\n\nYour ",...
						"StopAdvisor \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),delay192),...
						cancelemail ("rct_s1", loadvalue (username, "email")),...
						cancelemail ("rct_s1r1", loadvalue (username, "email"))...
					)) goto p1p08_5days
after p1p08withmeda if (p1p08withmeda.days01 = "days_5") goto p1p08_5days
					
show p1p08_5days

after p1p08withmeda if (and(...
					(p1p08withmeda.days01 = "days_7"),...
						sendemail("gotmeds7days", username, "StopAdvisor - Did you get your medicine?", append ("Hello ",gotmeds_name,",\n\nYou said you would need a week to get ",...
						"your medicine. Log into your new session and tell us whether you have got it yet: \n\nhttp://www.stopadvisor.co.uk\n\nBest wishes,\n\nYour StopAdvisor \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),delay168),...
						sendemail("gotmeds7days_r1", username, "StopAdvisor reminder - Did you get your medicine?", append ("Hello ",gotmeds_name,",\n\nThis is a reminder ",...
						"that your newest StopAdvisor session is ready.\n\nPlease log in and tell us whether you have got your medicine, or whether you need more time: \n\nhttp://www.stopadvisor.co.uk",...
						"\n\nBest wishes,\n\nYour StopAdvisor \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),delay192),...
						sendemail("gotmeds7days_r2", username, "StopAdvisor final reminder - Did you get your medicine?", append ("Hello ",gotmeds_name,",\n\nThis is a last reminder ",...
						"that your newest StopAdvisor session is ready.\n\nPlease log in and tell us whether you need more time to get your medicine, or whether you'd prefer to quit without it: ",...
						"\n\nhttp://www.stopadvisor.co.uk\n\nWe won't email to remind you about this session again but it will be waiting for you whenever you log back in.\n\nBest wishes,\n\nYour ",...
						"StopAdvisor \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),delay240),...
						cancelemail ("rct_s1", loadvalue (username, "email")),...
						cancelemail ("rct_s1r1", loadvalue (username, "email"))...
					)) goto p1p08_1week
after p1p08withmeda if (p1p08withmeda.days01 = "days_7") goto p1p08_1week
					
show p1p08_1week

#same as prev pmenu section but has to be new pages so the navigation buttons don't take them back to the start again.
show p1p09
show p1menu
show p1menuwhystop
show p1menuuse
show p1menuuse02
show p1menuuse03
show p1menuteam
show p1menuteam02
show p1menuteam03
show p1menuteam04
show p1menuteam05
show p1menudifferent
show p1menudifferent02
show p1menufeel
show p1menufeel02
show p1menuneed
show p1menucontact
show p1menucredit

#SESSION 2- Telling us whether they have medication.

#In this section users login to confirm whether their attempts to get medication have been successful. They can also 
#select to have more time, or tell us that they have decided not to use medication. If they have got their medication,
#("havemed") they select which type of medication they got hold of.
# add WELCOME & PMENU pages

show p1p08confirmmed01
save p1p08confirmmed01.meds01 for username

#JJ: Cancel Session 1 medication reminder emails.
cancelemail ("gotmeds3days", loadvalue (username, "email"))
cancelemail ("gotmeds3days_r1", loadvalue (username, "email"))
cancelemail ("gotmeds3days_r2", loadvalue (username, "email"))
cancelemail ("gotmeds5days", loadvalue (username, "email"))
cancelemail ("gotmeds5days_r1", loadvalue (username, "email"))
cancelemail ("gotmeds5days_r2", loadvalue (username, "email"))
cancelemail ("gotmeds7days", loadvalue (username, "email"))
cancelemail ("gotmeds7days_r1", loadvalue (username, "email"))
cancelemail ("gotmeds7days_r2", loadvalue (username, "email"))

after p1p08confirmmed01 if (and(...
							p1p08confirmmed01.meds01 = "moretime",...
							savevalue (username, "medmoretime2", currenttime()))) goto p1p08medmoretime01
#JB to save fact these users have decided to not use meds
after p1p08confirmmed01 if (and(...
							p1p08confirmmed01.meds01 = "notusemed",...
							savevalue(username, "none1", "notusemed"))) goto p1p07nomed2

show p1p08medselect01 if (p1p08confirmmed01.meds01 = "havemed")
save p1p08medselect01.medchoice for username
							
after p1p08medselect01 if (and(...
						p1p08confirmmed01.meds01 = "havemed",...
						savevalue(username, "usemed", p1p08medselect01.medchoice),...
						savevalue(username, "usemed1", "havemed"),...
						1=0)) goto p1p08usechamp
													
show p1p08usechamp if (p1p08medselect01.medchoice = "champix")
show p1p08usezyban if (p1p08medselect01.medchoice = "zyban")
show p1p08usegum if (p1p08medselect01.medchoice = "gum")
show p1p08usepatch if (p1p08medselect01.medchoice = "patches")
show p1p08useloz if (p1p08medselect01.medchoice = "lozenges")
show p1p08usemicro if (p1p08medselect01.medchoice = "microtabs")
show p1p08useinhal if (p1p08medselect01.medchoice = "inhalator")
show p1p08usenasal if (p1p08medselect01.medchoice = "nasal")
						
show p1p08medmoretime01
set gotmeds2_name to load signup.first_name for username
save p1p08medmoretime01.days02 for username
show p1p07nomed2

show p1p08medselect01info

#SESSION 3 - For those who want more time
#This section is only for those who have chosen to have more time, and is essentially a repeat of the email section 
#above. The main thing here is that all the pages have different names, but the logic is the same.
# JB timings
after p1p08medmoretime01 if (and(...
					(p1p08medmoretime01.days02 = "days_3_02"),...
						sendemail("gotmeds3days2", username, "StopAdvisor - Did you get your medicine?", append ("Hello ",gotmeds2_name,",\n\nYou said you would need another three days to get ",...
						"your medicine. Log into your new session and tell us whether you have got it yet: \n\nhttp://www.stopadvisor.co.uk\n\nBest wishes,\n\nYour StopAdvisor \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),delay72),...
						sendemail("gotmeds3days2_r1", username, "StopAdvisor reminder - Did you get your medicine?", append ("Hello ",gotmeds2_name,",\n\nThis is a reminder ",...
						"that your newest StopAdvisor session is ready.\n\nPlease log in and tell us whether you have got your medicine, or whether you'd prefer to quit without it",...
						": \n\nhttp://www.stopadvisor.co.uk\n\nBest wishes,\n\nYour StopAdvisor \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),delay96),...
						sendemail("gotmeds3days2_r2", username, "StopAdvisor final reminder - Did you get your medicine?", append ("Hello ",gotmeds2_name,",\n\nThis is a last reminder ",...
						"that your newest StopAdvisor session is ready.\n\nPlease log in and tell us whether you have got your medicine, or whether you'd prefer to quit without it: ",...
						"\n\nhttp://www.stopadvisor.co.uk\n\nWe won't email to remind you about this session again but it will be waiting for you whenever you log back in.\n\nBest wishes,\n\nYour ",...
						"StopAdvisor \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),delay144)...
					)) goto p1p08_3days02
after p1p08medmoretime01 if (p1p08medmoretime01.days02 = "days_3_02") goto p1p08_3days02				
					
show p1p08_3days02

after p1p08medmoretime01 if (and(...
					(p1p08medmoretime01.days02 = "days_5_02"),...
						sendemail("gotmeds5days2", username, "StopAdvisor - Did you get your medicine? (gotmeds5days2)", append ("Hello ",gotmeds2_name,",\n\nYou said you would need another five days to get ",...
						"your medicine. Log into your new session and tell us whether you have got it yet: \n\nhttp://www.stopadvisor.co.uk\n\nBest wishes,\n\nYour StopAdvisor \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),delay120),...
						sendemail("gotmeds5days2_r1", username, "StopAdvisor reminder - Did you get your medicine?", append ("Hello ",gotmeds2_name,",\n\nThis is a reminder ",...
						"that your newest StopAdvisor session is ready.\n\nPlease log in and tell us whether you have got your medicine, or whether you'd prefer to quit without it",...
						": \n\nhttp://www.stopadvisor.co.uk\n\nBest wishes,\n\nYour StopAdvisor \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),delay144),...
						sendemail("gotmeds5days2_r2", username, "StopAdvisor final reminder - Did you get your medicine?", append ("Hello ",gotmeds2_name,",\n\nThis is a last reminder ",...
						"that your newest StopAdvisor session is ready.\n\nPlease log in and tell us whether you have got your medicine, or whether you'd prefer to quit without it: ",...
						"\n\nhttp://www.stopadvisor.co.uk\n\nWe won't email to remind you about this session again but it will be waiting for you whenever you log back in.\n\nBest wishes,\n\nYour ",...
						"StopAdvisor \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),delay192)...
					)) goto p1p08_5days02
after p1p08medmoretime01 if (p1p08medmoretime01.days02 = "days_5_02") goto p1p08_5days02					
					 
show p1p08_5days02 

after p1p08medmoretime01 if (and(...
					(p1p08medmoretime01.days02 = "days_7_02"),...
						sendemail("gotmeds7days2", username, "StopAdvisor - Did you get your medicine?", append ("Hello ",gotmeds2_name,",\n\nYou said you would need another week to get ",...
						"your medicine. Log into your new session and tell us whether you have got it yet: \n\nhttp://www.stopadvisor.co.uk\n\nBest wishes,\n\nYour StopAdvisor \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),delay168),...
						sendemail("gotmeds7days2_r1", username, "StopAdvisor reminder - Did you get your medicine?", append ("Hello ",gotmeds2_name,",\n\nThis is a reminder ",...
						"that your newest StopAdvisor session is ready.\n\nPlease log in and tell us whether you have got your medicine, or whether you'd prefer to quit without it",...
						": \n\nhttp://www.stopadvisor.co.uk\n\nBest wishes,\n\nYour StopAdvisor \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),delay192),...
						sendemail("gotmeds7days2_r2", username, "StopAdvisor final reminder - Did you get your medicine?", append ("Hello ",gotmeds2_name,",\n\nThis is a last reminder ",...
						"that your newest StopAdvisor session is ready.\n\nPlease log in and tell us whether you have got your medicine, or whether you'd prefer to quit without it: ",...
						"\n\nhttp://www.stopadvisor.co.uk\n\nWe won't email to remind you about this session again but it will be waiting for you whenever you log back in.\n\nBest wishes,\n\nYour ",...
						"StopAdvisor \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),delay240)...
					)) goto p1p08_1week02 
after p1p08medmoretime01 if (p1p08medmoretime01.days02 = "days_7_02") goto p1p08_1week02					
					
show p1p08_1week02

show p1p11

#Again, this allows users to tell us what they are doing after a second chance at getting medication. It essentially the
#the same logic as above, only with different page names.

#JB: Re-did logic here in line with first med select logic, which begins above at show p1p08confirmmed01
#JB: Added p1p07nomed3, as can say no to meds three times - opting against initially, or at either stage
#after more time.
show p1p08confirmmed02
save p1p08confirmmed02.meds02 for username

#JJ: Cancel Session 2 medication reminder emails.
cancelemail ("gotmeds3days2", loadvalue (username, "email"))
cancelemail ("gotmeds3days2_r1", loadvalue (username, "email"))
cancelemail ("gotmeds3days2_r2", loadvalue (username, "email"))
cancelemail ("gotmeds5days2", loadvalue (username, "email"))
cancelemail ("gotmeds5days2_r1", loadvalue (username, "email"))
cancelemail ("gotmeds5days2_r2", loadvalue (username, "email"))
cancelemail ("gotmeds7days2", loadvalue (username, "email"))
cancelemail ("gotmeds7days2_r1", loadvalue (username, "email"))
cancelemail ("gotmeds7days2_r2", loadvalue (username, "email"))

after p1p08confirmmed02 if (and(...
							p1p08confirmmed02.meds02 = "nomed02",...
							savevalue(username, "none2", "nomed02"))) goto p1p07nomed3
							
show p1p08medselect02 if (p1p08confirmmed02.meds02 = "havemed02")
save p1p08medselect02.medchoice02 for username

after p1p08medselect02 if (and(...
						p1p08confirmmed02.meds02 = "havemed02",...
						savevalue(username, "usemed2", p1p08medselect02.medchoice02),...
						savevalue(username, "usemed3", "havemed02"),...
						1=0)) goto p1p08usechamp02
						
show p1p08usechamp02 if (p1p08medselect02.medchoice02 = "champix_02")
show p1p08usezyban02 if (p1p08medselect02.medchoice02 = "zyban_02")
show p1p08usegum02 if (p1p08medselect02.medchoice02 = "gum_02")
show p1p08usepatch02 if (p1p08medselect02.medchoice02 = "patches_02")
show p1p08useloz02 if (p1p08medselect02.medchoice02 = "lozenges_02")
show p1p08usemicro02 if (p1p08medselect02.medchoice02 = "microtabs_02")
show p1p08useinhal02 if (p1p08medselect02.medchoice02 = "inhalator_02")
show p1p08usenasal02 if (p1p08medselect02.medchoice02 = "nasal_02")

show p1p07nomed3
show p1p08medselect02info

end

#SESSION 4 - This logic doesn't display pages, it works behind the scenes to create essentially a 'short-cut' variable. Basically
#it condenses and remembers whether a person is taking medication or not, and if they are, what type of medication they
#are taking down to a single variable name like 'usemedchamp'. This variable is for users who on a first try or a second
#try made a choice to about using medication. So, whether they chose to use it and what they are using, or if they decided 
#not to use it at any stage. 

show p2p01
#JB - added this to remind people to complete quit date. Essentially replaced completion of "s2". These are testing times should be delay24 and delay72
#JB - tried adding this rather than having sendemail standalone in text as these emails were not being cancelled if though cancelemail was below - if this
#solves issue need to do same for d01, s3 s4 emails below.
# -tested it, emails still not being cancelled. Not the issue.; JB timings

set quitdates_name to load signup.first_name for username
set quitdates_email to load signup.email for username

sendemail("quitselect_notcompleted", username, "StopAdvisor - Your session is unfinished", append ("Hello ",quitdates_name,",\n\nYou didn't finish your last session with StopAdvisor.",...
			"\n\nPlease log in and finish setting your quit date: \n\nhttp://www.stopadvisor.co.uk \n\nBest wishes,\n\nYour StopAdvisor \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),delay24)
sendemail("quitselect_notcompletedr1", username, "StopAdvisor final reminder - Your session is unfinished", append ("Hello ",quitdates_name,",\n\nThis is a reminder that you didn't ",...
			"finish your last session with StopAdvisor.\n\nPlease log in and finish setting your quit date: \n\nhttp://www.stopadvisor.co.uk \n\nWe won't email to remind you about this session again but it will be waiting for ",...
			"you whenever you log back in.\n\nBest wishes,\n\nYour StopAdvisor \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),delay72)
#S5- This section is a quit date selection section. 
#First users are given some information, then it uses the new medication information variable name (created above)
#to present users with tailored information if they have chosen to use medication. For instance, that they need to allow
#for a week to start taking champix before they quit, and they need to bare this in mind when setting a quit date. After 
#presenting tailored medication information, it presents a number of pages where a user then selects their quit date. 

#JJ: Logic below not working##
after p2p01 if (usemedchamp) goto p2p01champix#(loadvalue(username, "usemed") = "champix") goto p2p01champix
after p2p01 if (usemedzyban) goto p2p01zyban#(loadvalue(username, "usemed") = "zyban") goto p2p01zyban
after p2p01 if (usemedgum) goto p2p01gum
after p2p01 if (usemedpatch) goto p2p01patch
after p2p01 if (usemedlozenge) goto p2p01lozenge
after p2p01 if (usemedinhalator) goto p2p01inhalator
after p2p01 if (usemedmicrotabs) goto p2p01microtab
after p2p01 if (usemednasal) goto p2p01nasalspray
after p2p01 if (notusingmeds) goto p2p02

show p2p01zyban
show p2p01champix
show p2p01gum
show p2p01patch
show p2p01lozenge
show p2p01inhalator
show p2p01microtab
show p2p01nasalspray

show p2p02

#set datetext to printtime(p2p02.selectquit, "EEE, dd MMM yyyy")
if (isempty(loadvalue(username, "quitdatecatch"))) set daytext to printtime(p2p02.selectquit, "EEEEEEEEE")
if (isempty(loadvalue(username, "quitdatecatch"))) set datetext to printtime(p2p02.selectquit, "dd")
if (isempty(loadvalue(username, "quitdatecatch"))) set monthtext to printtime(p2p02.selectquit, "MMMMMMMM")
if (isempty(loadvalue(username, "quitdatecatch"))) set yeartext to printtime(p2p02.selectquit, "yyyy")

# JB timings
#post-pilot added email to confirm quit date

after p2p02 if (and(...
						(isempty(loadvalue(username, "quitdatecatch"))),...
						savevalue (username, "quitdate", p2p02.selectquit),...
						sendemail("quitdateconfirm", username, append ("StopAdvisor - Your quit date is ",datetext," ",monthtext," "), append ("Hello ",quitdates_name,",\n\nYou selected your quit date to be ",datetext," ",monthtext,".",...
						"\n\nIf you are taking medicine remember to start taking it before this date. We will email you to log in the day before - we'll have some more ideas to help you prepare.",...
						"\n\nRemember, now that you've selected your date with StopAdvisor it cannot be changed. Research shows that once you pick a date it's best to stick to it.",...
						"\n\nBest wishes,\n\nYour StopAdvisor \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),10),...
						sendemail("s3", username, "StopAdvisor - Your quit date is tomorrow", append ("Hello ",quitdates_name,",\n\nTomorrow is your quit date. We have more ideas to help you prepare. ",...
						"Log into your new session now:\n\nhttp://www.stopadvisor.co.uk\n\nBest wishes,\n\nYour StopAdvisor \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),s3invitetime),...
						sendemail("s3r1", username, "StopAdvisor Reminder - Your quit date is tomorrow", append ("Hello ",quitdates_name,",\n\nThis is a reminder that we have more ideas to help ",...
						"you prepare for your quit date tomorrow. Log into your new session now:\n\nhttp://www.stopadvisor.co.uk\n\nBest wishes,\n\nYour StopAdvisor \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),s3r1invitetime),...
						sendemail("s4", username, "StopAdvisor - Your quit date is here", append ("Hello ",quitdates_name,",\n\nCongratulations! Today is the first day of your new life as a ",...
						"non-smoker.\n\nOnce you've had your last cigarette, log in to your new session to celebrate with us:\n\nhttp://www.stopadvisor.co.uk\n\nBest wishes,\n\nYour StopAdvisor \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),s4invitetime),...
						sendemail("s4r1", username, "StopAdvisor Reminder - Your quit date is here", append ("Hello ",quitdates_name,",\n\nThis is a reminder that once you've had your last ",...
						"cigarette, we'd like you to log in and celebrate with us:\n\nhttp://www.stopadvisor.co.uk\n\nBest wishes,\n\nYour StopAdvisor \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),s4r1invitetime),...
						sendemail("d01", username, "StopAdvisor - Your next session is ready", append ("Hello ",quitdates_name,",\n\nHere is the link for today's new session: ",...
						"\n\nhttp://www.stopadvisor.co.uk\n\nThis is your first session since your quit date. Even if it's going well, you should still log in for your latest tips and advice",...
						". If you wait until it's going badly, it's usually too late.\n\nBest wishes,\n\nYour StopAdvisor\n\nPS - Not a puff, no matter what. \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),d01invitetime),...
						sendemail("d01r1", username, "StopAdvisor reminder - Your next session is ready", append ("Hello ",quitdates_name,",\n\nThis is a reminder that your newest StopAdvisor session is ready. ",...
						"It is your first session since your quit date. You can log in at: \n\nhttp://www.stopadvisor.co.uk\n\nIf it's going well, don't wait until it starts going badly - this is often too late! ",...
						"Log in now for your latest tips and advice. \n\nBest wishes,\n\nYour StopAdvisor\n\nPS - Not a puff, no matter what. \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),d01r1invitetime),...
						sendemail("d01r2", username, "StopAdvisor final reminder - Your next session is ready", append ("Hello ",quitdates_name,",\n\nThis is a last reminder that your newest StopAdvisor session is ready. ",...
						"It is your first session since your quit date. You can log in at: \n\nhttp://www.stopadvisor.co.uk\n\nWe won't email to remind you about this session again but it will be waiting for ",...
						"you whenever you log back in.\n\nRemember, if you wait until it's going badly, it's usually too late - log in for your latest tips and advice. \n\nBest wishes,\n\nYour ",...
						"StopAdvisor\n\nPS - Not a puff, no matter what. \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),d01r2invitetime)...
						)) goto p2p03

set daytextcatch to printtime((loadvalue (username, "quitdate")), "EEEEEEEEE")
set datetextcatch to printtime((loadvalue (username, "quitdate")), "dd")
set monthtextcatch to printtime((loadvalue (username, "quitdate")), "MMMMMMMM")
set yeartextcatch to printtime((loadvalue (username, "quitdate")), "yyyy")
					
show p2p03catch

set p2p03catch.quitdate1 to daytextcatch	
set p2p03catch.quitdate2 to datetextcatch
set p2p03catch.quitdate3 to monthtextcatch
set p2p03catch.quitdate4 to yeartextcatch

after p2p03catch if (1=1) goto p2p04
						
#set quitdate to printtime(p2p02.selectquit, "EEE, dd MM yyyy") 
show p2p03 if (and(...
savevalue(username, "quitdatecatch", "true"),...
cancelemail ("quitselect_notcompleted", loadvalue (username, "email")),...
cancelemail ("quitselect_notcompletedr1", loadvalue (username, "email"))...
))# page showing quitdate

#set p2p03.quitdate to datetext
set p2p03.quitdate1 to daytext
set p2p03.quitdate2 to datetext
set p2p03.quitdate3 to monthtext
set p2p03.quitdate4 to yeartext

show p2p04
show p2p04a
show p2p05

#DAY BEFORE QUIT DATE SESSION (P3)
#participants will be emailed or texted (tbc) inviting them to login the day before their set quit date. 
#add WELCOME, PMENU & LOGIN pages
#JJ: Added line below.
Begin section prequit3
show p3p01
cancelemail ("s3r1", loadvalue (username, "email"))
show p3p02
show p3p03

set mins to 0
if (p3p03.minlastcig = "lastcig_fifteen") set mins to 15
if (p3p03.minlastcig = "lastcig_thirty") set mins to 30
if (p3p03.minlastcig = "lastcig_fortyfive") set mins to 45
set lastcig to +(p3p03.datelastcig, (3600 * p3p03.hourlastcig), (60 * mins), (-1 * currenttime()))

show p3p03a

#send text message based on date and time entered for last cigarette. Text will be congratulations on becoming a non-smoker and login invite.
#for pilot have written this code so we receive an email detailing the request

if (not(isempty(p3p03a.mobtelquitdate))) set lastcigtime_email to printtime(+(p3p03.datelastcig, (3600 * p3p03.hourlastcig), (60 * mins)),"H:m d-M-y")
if (not(isempty(p3p03a.mobtelquitdate))) set mobtel_email to p3p03a.mobtelquitdate

after p3p03a if (and((not(isempty(p3p03a.mobtelquitdate))), sendemail( append(username, "quitdaytext"),"stopsmoking@ucl.ac.uk", append("Text at ", lastcigtime_email," on ", mobtel_email,". Congratulations on becoming a non-smoker! From now on, smoking is not an option - repeat it to yourself. ",...
			"We'll email about your next session soon."), append("Text at ", lastcigtime_email," on ", mobtel_email,". Congratulations on becoming a non-smoker! From now on, smoking is not an option - repeat it to yourself. ",...
			"We'll email about your next session soon."),10), sendtext ("lastcigtext", p3p03a.mobtelquitdate, "Congratulations on becoming a non-smoker! From now on, smoking is not an option - repeat it to yourself. We will email about your next session soon.", lastcig))) goto p3p04
show p3p04
end #end section prequit3

#QUIT DATE SESSION (P4)
#participants will be texted on last cigarette and invited to login. 
#add WELCOME, PMENU & LOGIN pages
Begin section prequit4
show p4p01
cancelemail ("s4r1", loadvalue (username, "email"))
show p4p03
set p4p03.name to load signup.first_name for username
show p4p03a
show p4p04
end #end section prequit4

#S5 - DIALOGUE SECTION

#S5.1 Smoking question.

#This is the main section of the intervention. It is based around a series of questions that 
#reoccur in each intervention session. Each section will be described as we move down the logic. 
#So, here is what the logic below works to achieve. After giving the users a choice about seeing a tailored session
#or looking at some quick concerns, the first question of the dialogue is asked. Users are asked it they have smoked at
#all or a little or a lot. If users have not smoked they jump to a message of support. If a user answers that
#they have smoked a little the logic works to determine if they are taking medication, and which medication 
#they are using, or whether they aren't using it. If they are using it, it presents them with some medication advice 
#before presenting them with more general advice. If they are not using medication it skips straight to the general advice.
#If they have smoked a lot and are now smoking as normal, it gives users some information, then directs them away
#from the website.
#If they haven't smoked they and it is the first time they have logged on, it will go to the first advice page. Each time they
#login and report not having smoked, the logic reads off which pages they have already seen, then shows them the next in 
#in the list of 'hasseen' commands. In this case it advice is a quick burst of positive reinforcement.

show choice1				
set choice1.name to load signup.first_name for username
show choice2
set choice2.name to load signup.first_name for username
show choice3
set choice3.name to load signup.first_name for username
show choice4
set choice4.name to load signup.first_name for username
show choice5
set choice5.name to load signup.first_name for username
show choice6
set choice6.name to load signup.first_name for username
show choice7
set choice7.name to load signup.first_name for username
show choice8
set choice8.name to load signup.first_name for username
show choice9
set choice9.name to load signup.first_name for username
show choice10
set choice10.name to load signup.first_name for username
show choice11
set choice11.name to load signup.first_name for username
show choice12
set choice12.name to load signup.first_name for username
show choice13
set choice13.name to load signup.first_name for username

# quick concern menu pages

#JB the code below needed a second 'dummy' page - when pressing back from any page which was shown
#after the top level it would jump there. Means important second menu level page was not
#next to page within its sub-levels.
show qcmenu01
show qcmenu02# named qcmenu02
show qcmenuchamp01
show qcmenuchamp02
show qcmenuchamp03
show qcmenuchamp04
show qcmenuchamp05
show qcmenuchamp06
show qcmenuchamp07
show qcmenuchamp08
show qcmenuchamp09
show qcmenuchamp10
show qcmenumed01
show qcmenueat01
show qcmenueat02
show qcmenueat03
show qcmenuhealth01
show qcmenuhealth02
show qcmenuhealth03
show qcmenuhealth04
show qcmenuhealth05
show qcmenuhealth06
show qcmenumood01
show qcmenumood02
show qcmenumood03
show qcmenumood04
show qcmenumood05
show qcmenugeneral01
show qcmenugeneral02
show qcmenugeneral03
show qcmenugeneral04
show qcmenugeneral05
show qcmenugeneral06
show qcmenugeneral07
show qcmenugeneral08
show qcmenunrtgum01
show qcmenunrtgum02
show qcmenunrtgum03
show qcmenunrtgum04
show qcmenunrtgum05
show qcmenunrtgum06
show qcmenunrtgum07
show qcmenunrtgum08
show qcmenunrtother01
show qcmenunrtother02
show qcmenunrtother03
show qcmenunrtother04
show qcmenunrtother05
show qcmenunrtpatch01
show qcmenunrtpatch02
show qcmenunrtpatch03
show qcmenunrtpatch04
show qcmenunrtpatch05
show qcmenuzyb01
show qcmenuzyb02
show qcmenuzyb03
show qcmenuzyb04

#jb - if users pressed forward then backward between choice and dasmok, sendemail would evalutate to false, and would go incorrectly through logic
#so, reverse order they appear in logic, added a 'current session not hasseen' for that page, and created a 'catch-all' generic dasmok14 to avoid this issue.; JB timings 

show dasmok13 if (and(...
(not(hasseen(username, "dasmok13", "true"))),...
cancelemail ("d13r1", loadvalue (username, "email")),...
cancelemail ("d13r2", loadvalue (username, "email"))...
))

after dasmok13 if (dasmok13.smoked13 = "not_smoked_01")goto dnsmok01p1
after dasmok13 if (dasmok13.smoked13 = "smoked_little_01")goto dsmokelittle01
after dasmok13 if (dasmok13.smoked13 = "smoked_same_01") goto dsmokealot01

show dasmok12 if (and(...
(not(hasseen(username, "dasmok12", "true"))),...
savevalue(username, "d12time", currenttime()),...
sendemail("d13", username, "StopAdvisor - Your next session is ready", append ("Hello ",dialogue_name,",\n\nHere is the link for today's new session: ",...
				"\n\nhttp://www.stopadvisor.co.uk\n\nThis is your final session. Even if it's going well, you should still log in for your latest tips and advice",...
				". If you wait until it's going badly, it's usually too late.\n\nBest wishes,\n\nYour StopAdvisor\n\nPS - Not a puff, no matter what. \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),delay96),...
				sendemail("d13r1", username, "StopAdvisor reminder - Your next session is ready", append ("Hello ",dialogue_name,",\n\nThis is a reminder that your newest StopAdvisor session is ready. ",...
				"It is your final session. You can log in at: \n\nhttp://www.stopadvisor.co.uk\n\nIf it's going well, don't wait until it starts going badly - this is often too late! ",...
				"Log in now for your latest tips and advice. \n\nBest wishes,\n\nYour StopAdvisor\n\nPS - Not a puff, no matter what. \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),delay120),...
				sendemail("d13r2", username, "StopAdvisor final reminder - Your next session is ready", append ("Hello ",dialogue_name,",\n\nThis is a last reminder that your newest StopAdvisor session is ready. ",...
				"It is your final session. You can log in at: \n\nhttp://www.stopadvisor.co.uk\n\nWe won't email to remind you about this session again but it will be waiting for ",...
				"you whenever you log back in.\n\nRemember, if you wait until it's going badly, it's usually too late - log in for your latest tips and advice. \n\nBest wishes,\n\nYour ",...
				"StopAdvisor\n\nPS - Not a puff, no matter what. \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),delay168),...
cancelemail ("d12r1", loadvalue (username, "email")),...
cancelemail ("d12r2", loadvalue (username, "email"))...
))

after dasmok12 if (dasmok12.smoked12 = "not_smoked_01")goto dnsmok01p1
after dasmok12 if (dasmok12.smoked12 = "smoked_little_01")goto dsmokelittle01
after dasmok12 if (dasmok12.smoked12 = "smoked_same_01") goto dsmokealot01

show dasmok11 if (and(...
(not(hasseen(username, "dasmok11", "true"))),...
savevalue(username, "d11time", currenttime()),...
sendemail("d12", username, "StopAdvisor - Your next session is ready", append ("Hello ",dialogue_name,",\n\nHere is the link for today's new session: ",...
				"\n\nhttp://www.stopadvisor.co.uk\n\nThis is your twelfth session since your quit date. Even if it's going well, you should still log in for your latest tips and advice",...
				". If you wait until it's going badly, it's usually too late.\n\nBest wishes,\n\nYour StopAdvisor\n\nPS - Not a puff, no matter what. \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),delay72),...
				sendemail("d12r1", username, "StopAdvisor reminder - Your next session is ready", append ("Hello ",dialogue_name,",\n\nThis is a reminder that your newest StopAdvisor session is ready. ",...
				"It is your twelfth session since your quit date. You can log in at: \n\nhttp://www.stopadvisor.co.uk\n\nIf it's going well, don't wait until it starts going badly - this is often too late! ",...
				"Log in now for your latest tips and advice. \n\nBest wishes,\n\nYour StopAdvisor\n\nPS - Not a puff, no matter what. \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),delay96),...
				sendemail("d12r2", username, "StopAdvisor final reminder - Your next session is ready", append ("Hello ",dialogue_name,",\n\nThis is a last reminder that your newest StopAdvisor session is ready. ",...
				"It is your twelfth session since your quit date. You can log in at: \n\nhttp://www.stopadvisor.co.uk\n\nWe won't email to remind you about this session again but it will be waiting for ",...
				"you whenever you log back in.\n\nRemember, if you wait until it's going badly, it's usually too late - log in for your latest tips and advice. \n\nBest wishes,\n\nYour ",...
				"StopAdvisor\n\nPS - Not a puff, no matter what. \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),delay144),...
cancelemail ("d11r1", loadvalue (username, "email")),...
cancelemail ("d11r2", loadvalue (username, "email"))...
))

after dasmok11 if (dasmok11.smoked11 = "not_smoked_01")goto dnsmok01p1
after dasmok11 if (dasmok11.smoked11 = "smoked_little_01")goto dsmokelittle01
after dasmok11 if (dasmok11.smoked11 = "smoked_same_01") goto dsmokealot01

show dasmok10 if (and(...
(not(hasseen(username, "dasmok10", "true"))),...
savevalue(username, "d10time", currenttime()),...
sendemail("d11", username, "StopAdvisor - Your next session is ready", append ("Hello ",dialogue_name,",\n\nHere is the link for today's new session: ",...
				"\n\nhttp://www.stopadvisor.co.uk\n\nThis is your eleventh session since your quit date. Even if it's going well, you should still log in for your latest tips and advice",...
				". If you wait until it's going badly, it's usually too late.\n\nBest wishes,\n\nYour StopAdvisor\n\nPS - Not a puff, no matter what. \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),delay72),...
				sendemail("d11r1", username, "StopAdvisor reminder - Your next session is ready", append ("Hello ",dialogue_name,",\n\nThis is a reminder that your newest StopAdvisor session is ready. ",...
				"It is your eleventh session since your quit date. You can log in at: \n\nhttp://www.stopadvisor.co.uk\n\nIf it's going well, don't wait until it starts going badly - this is often too late! ",...
				"Log in now for your latest tips and advice. \n\nBest wishes,\n\nYour StopAdvisor\n\nPS - Not a puff, no matter what. \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),delay96),...
				sendemail("d11r2", username, "StopAdvisor final reminder - Your next session is ready", append ("Hello ",dialogue_name,",\n\nThis is a last reminder that your newest StopAdvisor session is ready. ",...
				"It is your eleventh session since your quit date. You can log in at: \n\nhttp://www.stopadvisor.co.uk\n\nWe won't email to remind you about this session again but it will be waiting for ",...
				"you whenever you log back in.\n\nRemember, if you wait until it's going badly, it's usually too late - log in for your latest tips and advice. \n\nBest wishes,\n\nYour ",...
				"StopAdvisor\n\nPS - Not a puff, no matter what. \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),delay144),...
cancelemail ("d10r1", loadvalue (username, "email")),...
cancelemail ("d10r2", loadvalue (username, "email"))...
))

after dasmok10 if (dasmok10.smoked10 = "not_smoked_01")goto dnsmok01p1
after dasmok10 if (dasmok10.smoked10 = "smoked_little_01")goto dsmokelittle01
after dasmok10 if (dasmok10.smoked10 = "smoked_same_01") goto dsmokealot01

show dasmok09 if (and(...
(not(hasseen(username, "dasmok09", "true"))),...
sendemail("d10", username, "StopAdvisor - Your next session is ready", append ("Hello ",dialogue_name,",\n\nHere is the link for today's new session: ",...
				"\n\nhttp://www.stopadvisor.co.uk\n\nThis is your tenth session since your quit date. Even if it's going well, you should still log in for your latest tips and advice",...
				". If you wait until it's going badly, it's usually too late.\n\nBest wishes,\n\nYour StopAdvisor\n\nPS - Not a puff, no matter what. \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),delay48),...
				sendemail("d10r1", username, "StopAdvisor reminder - Your next session is ready", append ("Hello ",dialogue_name,",\n\nThis is a reminder that your newest StopAdvisor session is ready. ",...
				"It is your tenth session since your quit date. You can log in at: \n\nhttp://www.stopadvisor.co.uk\n\nIf it's going well, don't wait until it starts going badly - this is often too late! ",...
				"Log in now for your latest tips and advice. \n\nBest wishes,\n\nYour StopAdvisor\n\nPS - Not a puff, no matter what. \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),delay72),...
				sendemail("d10r2", username, "StopAdvisor final reminder - Your next session is ready", append ("Hello ",dialogue_name,",\n\nThis is a last reminder that your newest StopAdvisor session is ready. ",...
				"It is your tenth session since your quit date. You can log in at: \n\nhttp://www.stopadvisor.co.uk\n\nWe won't email to remind you about this session again but it will be waiting for ",...
				"you whenever you log back in.\n\nRemember, if you wait until it's going badly, it's usually too late - log in for your latest tips and advice. \n\nBest wishes,\n\nYour ",...
				"StopAdvisor\n\nPS - Not a puff, no matter what. \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),delay120),...
savevalue(username, "d9time", currenttime()),...
cancelemail ("d09r1", loadvalue (username, "email")),...
cancelemail ("d09r2", loadvalue (username, "email"))...
))

after dasmok09 if (dasmok09.smoked09 = "not_smoked_01")goto dnsmok01p1
after dasmok09 if (dasmok09.smoked09 = "smoked_little_01")goto dsmokelittle01
after dasmok09 if (dasmok09.smoked09 = "smoked_same_01") goto dsmokealot01

show dasmok08 if (and(...
(not(hasseen(username, "dasmok08", "true"))),...
savevalue(username, "d8time", currenttime()),...
sendemail("d09", username, "StopAdvisor - Your next session is ready", append ("Hello ",dialogue_name,",\n\nHere is the link for today's new session: ",...
				"\n\nhttp://www.stopadvisor.co.uk\n\nThis is your ninth session since your quit date. Even if it's going well, you should still log in for your latest tips and advice",...
				". If you wait until it's going badly, it's usually too late.\n\nBest wishes,\n\nYour StopAdvisor\n\nPS - Not a puff, no matter what. \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),delay48),...
				sendemail("d09r1", username, "StopAdvisor reminder - Your next session is ready", append ("Hello ",dialogue_name,",\n\nThis is a reminder that your newest StopAdvisor session is ready. ",...
				"It is your ninth session since your quit date. You can log in at: \n\nhttp://www.stopadvisor.co.uk\n\nIf it's going well, don't wait until it starts going badly - this is often too late! ",...
				"Log in now for your latest tips and advice. \n\nBest wishes,\n\nYour StopAdvisor\n\nPS - Not a puff, no matter what. \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),delay72),...
				sendemail("d09r2", username, "StopAdvisor final reminder - Your next session is ready", append ("Hello ",dialogue_name,",\n\nThis is a last reminder that your newest StopAdvisor session is ready. ",...
				"It is your ninth session since your quit date. You can log in at: \n\nhttp://www.stopadvisor.co.uk\n\nWe won't email to remind you about this session again but it will be waiting for ",...
				"you whenever you log back in.\n\nRemember, if you wait until it's going badly, it's usually too late - log in for your latest tips and advice. \n\nBest wishes,\n\nYour ",...
				"StopAdvisor\n\nPS - Not a puff, no matter what. \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),delay120),...
cancelemail ("d08r1", loadvalue (username, "email")),...
cancelemail ("d08r2", loadvalue (username, "email"))...
))

after dasmok08 if (dasmok08.smoked08 = "not_smoked_01")goto dnsmok01p1
after dasmok08 if (dasmok08.smoked08 = "smoked_little_01")goto dsmokelittle01
after dasmok08 if (dasmok08.smoked08 = "smoked_same_01") goto dsmokealot01

show dasmok07 if (and(...
(not(hasseen(username, "dasmok07", "true"))),...
savevalue(username, "d7time", currenttime()),...
sendemail("d08", username, "StopAdvisor - Your next session is ready", append ("Hello ",dialogue_name,",\n\nHere is the link for today's new session: ",...
				"\n\nhttp://www.stopadvisor.co.uk\n\nThis is your eighth session since your quit date. Even if it's going well, you should still log in for your latest tips and advice",...
				". If you wait until it's going badly, it's usually too late.\n\nBest wishes,\n\nYour StopAdvisor\n\nPS - Not a puff, no matter what. \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),delay24),...
				sendemail("d08r1", username, "StopAdvisor reminder - Your next session is ready", append ("Hello ",dialogue_name,",\n\nThis is a reminder that your newest StopAdvisor session is ready. ",...
				"It is your eighth session since your quit date. You can log in at: \n\nhttp://www.stopadvisor.co.uk\n\nIf it's going well, don't wait until it starts going badly - this is often too late! ",...
				"Log in now for your latest tips and advice. \n\nBest wishes,\n\nYour StopAdvisor\n\nPS - Not a puff, no matter what. \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),delay48),...
				sendemail("d08r2", username, "StopAdvisor final reminder - Your next session is ready", append ("Hello ",dialogue_name,",\n\nThis is a last reminder that your newest StopAdvisor session is ready. ",...
				"It is your eighth session since your quit date. You can log in at: \n\nhttp://www.stopadvisor.co.uk\n\nWe won't email to remind you about this session again but it will be waiting for ",...
				"you whenever you log back in.\n\nRemember, if you wait until it's going badly, it's usually too late - log in for your latest tips and advice. \n\nBest wishes,\n\nYour ",...
				"StopAdvisor\n\nPS - Not a puff, no matter what. \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),delay96),...
cancelemail ("d07r1", loadvalue (username, "email")),...
cancelemail ("d07r2", loadvalue (username, "email"))...
))

after dasmok07 if (dasmok07.smoked07 = "not_smoked_01")goto dnsmok01p1
after dasmok07 if (dasmok07.smoked07 = "smoked_little_01")goto dsmokelittle01
after dasmok07 if (dasmok07.smoked07 = "smoked_same_01") goto dsmokealot01

show dasmok06 if (and(...
(not(hasseen(username, "dasmok06", "true"))),...
savevalue(username, "d6time", currenttime()),...
sendemail("d07", username, "StopAdvisor - Your next session is ready", append ("Hello ",dialogue_name,",\n\nHere is the link for today's new session: ",...
				"\n\nhttp://www.stopadvisor.co.uk\n\nThis is your seventh session since your quit date. Even if it's going well, you should still log in for your latest tips and advice",...
				". If you wait until it's going badly, it's usually too late.\n\nBest wishes,\n\nYour StopAdvisor\n\nPS - Not a puff, no matter what. \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),delay24),...
				sendemail("d07r1", username, "StopAdvisor reminder - Your next session is ready", append ("Hello ",dialogue_name,",\n\nThis is a reminder that your newest StopAdvisor session is ready. ",...
				"It is your seventh session since your quit date. You can log in at: \n\nhttp://www.stopadvisor.co.uk\n\nIf it's going well, don't wait until it starts going badly - this is often too late! ",...
				"Log in now for your latest tips and advice. \n\nBest wishes,\n\nYour StopAdvisor\n\nPS - Not a puff, no matter what. \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),delay48),...
				sendemail("d07r2", username, "StopAdvisor final reminder - Your next session is ready", append ("Hello ",dialogue_name,",\n\nThis is a last reminder that your newest StopAdvisor session is ready. ",...
				"It is your seventh session since your quit date. You can log in at: \n\nhttp://www.stopadvisor.co.uk\n\nWe won't email to remind you about this session again but it will be waiting for ",...
				"you whenever you log back in.\n\nRemember, if you wait until it's going badly, it's usually too late - log in for your latest tips and advice. \n\nBest wishes,\n\nYour ",...
				"StopAdvisor\n\nPS - Not a puff, no matter what. \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),delay96),...
cancelemail ("d06r1", loadvalue (username, "email")),...
cancelemail ("d06r2", loadvalue (username, "email"))...
))

after dasmok06 if (dasmok06.smoked06 = "not_smoked_01")goto dnsmok01p1
after dasmok06 if (dasmok06.smoked06 = "smoked_little_01")goto dsmokelittle01
after dasmok06 if (dasmok06.smoked06 = "smoked_same_01") goto dsmokealot01

show dasmok05 if (and(...
(not(hasseen(username, "dasmok05", "true"))),...
sendemail("d06", username, "StopAdvisor - Your next session is ready", append ("Hello ",dialogue_name,",\n\nHere is the link for today's new session: ",...
				"\n\nhttp://www.stopadvisor.co.uk\n\nThis is your sixth session since your quit date. Even if it's going well, you should still log in for your latest tips and advice",...
				". If you wait until it's going badly, it's usually too late.\n\nBest wishes,\n\nYour StopAdvisor\n\nPS - Not a puff, no matter what. \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),delay24),...
				sendemail("d06r1", username, "StopAdvisor reminder - Your next session is ready", append ("Hello ",dialogue_name,",\n\nThis is a reminder that your newest StopAdvisor session is ready. ",...
				"It is your sixth session since your quit date. You can log in at: \n\nhttp://www.stopadvisor.co.uk\n\nIf it's going well, don't wait until it starts going badly - this is often too late! ",...
				"Log in now for your latest tips and advice. \n\nBest wishes,\n\nYour StopAdvisor\n\nPS - Not a puff, no matter what. \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),delay48),...
				sendemail("d06r2", username, "StopAdvisor final reminder - Your next session is ready", append ("Hello ",dialogue_name,",\n\nThis is a last reminder that your newest StopAdvisor session is ready. ",...
				"It is your sixth session since your quit date. You can log in at: \n\nhttp://www.stopadvisor.co.uk\n\nWe won't email to remind you about this session again but it will be waiting for ",...
				"you whenever you log back in.\n\nRemember, if you wait until it's going badly, it's usually too late - log in for your latest tips and advice. \n\nBest wishes,\n\nYour ",...
				"StopAdvisor\n\nPS - Not a puff, no matter what. \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),delay96),...
savevalue(username, "d5time", currenttime()),...
cancelemail ("d05r1", loadvalue (username, "email")),...
cancelemail ("d05r2", loadvalue (username, "email"))...
))

after dasmok05 if (dasmok05.smoked05 = "not_smoked_01")goto dnsmok01p1
after dasmok05 if (dasmok05.smoked05 = "smoked_little_01")goto dsmokelittle01
after dasmok05 if (dasmok05.smoked05 = "smoked_same_01") goto dsmokealot01

show dasmok04 if (and(...
(not(hasseen(username, "dasmok04", "true"))),...
savevalue(username, "d4time", currenttime()),...
sendemail("d05", username, "StopAdvisor - Your next session is ready", append ("Hello ",dialogue_name,",\n\nHere is the link for today's new session: ",...
				"\n\nhttp://www.stopadvisor.co.uk\n\nThis is your fifth session since your quit date. Even if it's going well, you should still log in for your latest tips and advice",...
				". If you wait until it's going badly, it's usually too late.\n\nBest wishes,\n\nYour StopAdvisor\n\nPS - Not a puff, no matter what. \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),delay24),...
				sendemail("d05r1", username, "StopAdvisor reminder - Your next session is ready", append ("Hello ",dialogue_name,",\n\nThis is a reminder that your newest StopAdvisor session is ready. ",...
				"It is your fifth session since your quit date. You can log in at: \n\nhttp://www.stopadvisor.co.uk\n\nIf it's going well, don't wait until it starts going badly - this is often too late! ",...
				"Log in now for your latest tips and advice. \n\nBest wishes,\n\nYour StopAdvisor\n\nPS - Not a puff, no matter what. \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),delay48),...
				sendemail("d05r2", username, "StopAdvisor final reminder - Your next session is ready", append ("Hello ",dialogue_name,",\n\nThis is a last reminder that your newest StopAdvisor session is ready. ",...
				"It is your fifth session since your quit date. You can log in at: \n\nhttp://www.stopadvisor.co.uk\n\nWe won't email to remind you about this session again but it will be waiting for ",...
				"you whenever you log back in.\n\nRemember, if you wait until it's going badly, it's usually too late - log in for your latest tips and advice. \n\nBest wishes,\n\nYour ",...
				"StopAdvisor\n\nPS - Not a puff, no matter what. \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),delay96),...
cancelemail ("d04r1", loadvalue (username, "email")),...
cancelemail ("d04r2", loadvalue (username, "email"))...
))

after dasmok04 if (dasmok04.smoked04 = "not_smoked_01")goto dnsmok01p1
after dasmok04 if (dasmok04.smoked04 = "smoked_little_01")goto dsmokelittle01
after dasmok04 if (dasmok04.smoked04 = "smoked_same_01") goto dsmokealot01

show dasmok03 if (and(...
(not(hasseen(username, "dasmok03", "true"))),...
savevalue(username, "d3time", currenttime()),...
sendemail("d04", username, "StopAdvisor - Your next session is ready", append ("Hello ",dialogue_name,",\n\nHere is the link for today's new session: ",...
				"\n\nhttp://www.stopadvisor.co.uk\n\nThis is your fourth session since your quit date. Even if it's going well, you should still log in for your latest tips and advice",...
				". If you wait until it's going badly, it's usually too late.\n\nBest wishes,\n\nYour StopAdvisor\n\nPS - Not a puff, no matter what. \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),delay24),...
				sendemail("d04r1", username, "StopAdvisor reminder - Your next session is ready", append ("Hello ",dialogue_name,",\n\nThis is a reminder that your newest StopAdvisor session is ready. ",...
				"It is your fourth session since your quit date. You can log in at: \n\nhttp://www.stopadvisor.co.uk\n\nIf it's going well, don't wait until it starts going badly - this is often too late! ",...
				"Log in now for your latest tips and advice. \n\nBest wishes,\n\nYour StopAdvisor\n\nPS - Not a puff, no matter what. \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),delay48),...
				sendemail("d04r2", username, "StopAdvisor final reminder - Your next session is ready", append ("Hello ",dialogue_name,",\n\nThis is a last reminder that your newest StopAdvisor session is ready. ",...
				"It is your fourth session since your quit date. You can log in at: \n\nhttp://www.stopadvisor.co.uk\n\nWe won't email to remind you about this session again but it will be waiting for ",...
				"you whenever you log back in.\n\nRemember, if you wait until it's going badly, it's usually too late - log in for your latest tips and advice. \n\nBest wishes,\n\nYour ",...
				"StopAdvisor\n\nPS - Not a puff, no matter what. \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),delay96),...
cancelemail ("d03r1", loadvalue (username, "email")),...
cancelemail ("d03r2", loadvalue (username, "email"))...
))

after dasmok03 if (dasmok03.smoked03 = "not_smoked_01")goto dnsmok01p1
after dasmok03 if (dasmok03.smoked03 = "smoked_little_01")goto dsmokelittle01
after dasmok03 if (dasmok03.smoked03 = "smoked_same_01") goto dsmokealot01

show dasmok02 if (and(...
(not(hasseen(username, "dasmok02", "true"))),...
savevalue(username, "d2time", currenttime()),...
sendemail("d03", username, "StopAdvisor - Your next session is ready", append ("Hello ",dialogue_name,",\n\nHere is the link for today's new session: ",...
				"\n\nhttp://www.stopadvisor.co.uk\n\nThis is your third session since your quit date. Even if it's going well, you should still log in for your latest tips and advice",...
				". If you wait until it's going badly, it's usually too late.\n\nBest wishes,\n\nYour StopAdvisor\n\nPS - Not a puff, no matter what. \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),delay24),...
				sendemail("d03r1", username, "StopAdvisor reminder - Your next session is ready", append ("Hello ",dialogue_name,",\n\nThis is a reminder that your newest StopAdvisor session is ready. ",...
				"It is your third session since your quit date. You can log in at: \n\nhttp://www.stopadvisor.co.uk\n\nIf it's going well, don't wait until it starts going badly - this is often too late! ",...
				"Log in now for your latest tips and advice. \n\nBest wishes,\n\nYour StopAdvisor\n\nPS - Not a puff, no matter what. \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),delay48),...
				sendemail("d03r2", username, "StopAdvisor final reminder - Your next session is ready", append ("Hello ",dialogue_name,",\n\nThis is a last reminder that your newest StopAdvisor session is ready. ",...
				"It is your third session since your quit date. You can log in at: \n\nhttp://www.stopadvisor.co.uk\n\nWe won't email to remind you about this session again but it will be waiting for ",...
				"you whenever you log back in.\n\nRemember, if you wait until it's going badly, it's usually too late - log in for your latest tips and advice. \n\nBest wishes,\n\nYour ",...
				"StopAdvisor\n\nPS - Not a puff, no matter what. \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),delay96),...
cancelemail ("d02r1", loadvalue (username, "email")),...
cancelemail ("d02r2", loadvalue (username, "email"))...
))

after dasmok02 if (dasmok02.smoked02 = "not_smoked_01")goto dnsmok01p1
after dasmok02 if (dasmok02.smoked02 = "smoked_little_01")goto dsmokelittle01
after dasmok02 if (dasmok02.smoked02 = "smoked_same_01") goto dsmokealot01

show dasmok01 if (and(...
(not(hasseen(username, "dasmok01", "true"))),...
savevalue(username, "d1time", currenttime()),...
sendemail ("d02", username, "StopAdvisor - Your next session is ready", append ("Hello ",dialogue_name,",\n\nHere is the link for today's new session: ",...
				"\n\nhttp://www.stopadvisor.co.uk\n\nThis is your second session since your quit date. Even if it's going well, you should still log in for your latest tips and advice",...
				". If you wait until it's going badly, it's usually too late.\n\nBest wishes,\n\nYour StopAdvisor\n\nPS - Not a puff, no matter what. \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),delay24),...
				sendemail("d02r1", username, "StopAdvisor reminder - Your next session is ready", append ("Hello ",dialogue_name,",\n\nThis is a reminder that your newest StopAdvisor session is ready. ",...
				"It is your second session since your quit date. You can log in at: \n\nhttp://www.stopadvisor.co.uk\n\nIf it's going well, don't wait until it starts going badly - this is often too late! ",...
				"Log in now for your latest tips and advice. \n\nBest wishes,\n\nYour StopAdvisor\n\nPS - Not a puff, no matter what. \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),delay48),...
				sendemail("d02r2", username, "StopAdvisor final reminder - Your next session is ready", append ("Hello ",dialogue_name,",\n\nThis is a last reminder that your newest StopAdvisor session is ready. ",...
				"It is your second session since your quit date. You can log in at: \n\nhttp://www.stopadvisor.co.uk\n\nWe won't email to remind you about this session again but it will be waiting for ",...
				"you whenever you log back in.\n\nRemember, if you wait until it's going badly, it's usually too late - log in for your latest tips and advice. \n\nBest wishes,\n\nYour ",...
				"StopAdvisor\n\nPS - Not a puff, no matter what. \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),delay96),...
cancelemail ("d01r1", loadvalue (username, "email")),...
cancelemail ("d01r2", loadvalue (username, "email"))...
))
	
after dasmok01 if (dasmok01.smoked01 = "not_smoked_01")goto dnsmok01p1
after dasmok01 if (dasmok01.smoked01 = "smoked_little_01") goto dsmokelittle01
after dasmok01 if (dasmok01.smoked01 = "smoked_same_01") goto dsmokealot01

show dasmok14 if (hasseen(username, "dasmok01", "this"))

after dasmok14 if (dasmok14.smoked14 = "not_smoked_01")goto dnsmok01p1
after dasmok14 if (dasmok14.smoked14 = "smoked_little_01")goto dsmokelittle01
after dasmok14 if (dasmok14.smoked14 = "smoked_same_01") goto dsmokealot01

show dasmok15

after dasmok15 if (dasmok15.smoked15 = "not_smoked_01")goto dnsmok01p1
after dasmok15 if (dasmok15.smoked15 = "smoked_little_01")goto dsmokelittle01
after dasmok15 if (dasmok15.smoked15 = "smoked_same_01") goto dsmokealot01

#jb pilot change - the wording on dasmok was inappropriate after the first session. Needed a catch-all for first session different to catch-all for all others.

show dsmokelittle01
after dsmokelittle01 if or(usemedchamp,usemedzyban,usemedgum,usemedpatch,usemedlozenge,usemedmicrotabs,usemedinhalator,usemednasal)goto dsmokelittlemeds01
after dsmokelittle01 if (notusingmeds) goto dsmokelittlenomed01p1
show dsmokealot01 if (and(...
cancelemail ("d01r1", loadvalue (username, "email")),...
cancelemail ("d01r2", loadvalue (username, "email")),...
cancelemail ("d02", loadvalue (username, "email")),...
cancelemail ("d02r1", loadvalue (username, "email")),...
cancelemail ("d02r2", loadvalue (username, "email")),...
cancelemail ("d03", loadvalue (username, "email")),...
cancelemail ("d03r1", loadvalue (username, "email")),...
cancelemail ("d03r2", loadvalue (username, "email")),...
cancelemail ("d04", loadvalue (username, "email")),...
cancelemail ("d04r1", loadvalue (username, "email")),...
cancelemail ("d04r2", loadvalue (username, "email")),...
cancelemail ("d05", loadvalue (username, "email")),...
cancelemail ("d05r1", loadvalue (username, "email")),...
cancelemail ("d05r2", loadvalue (username, "email")),...
cancelemail ("d06", loadvalue (username, "email")),...
cancelemail ("d06r1", loadvalue (username, "email")),...
cancelemail ("d06r2", loadvalue (username, "email")),...
cancelemail ("d07", loadvalue (username, "email")),...
cancelemail ("d07r1", loadvalue (username, "email")),...
cancelemail ("d07r2", loadvalue (username, "email")),...
cancelemail ("d08", loadvalue (username, "email")),...
cancelemail ("d08r1", loadvalue (username, "email")),...
cancelemail ("d08r2", loadvalue (username, "email")),...
cancelemail ("d09", loadvalue (username, "email")),...
cancelemail ("d09r1", loadvalue (username, "email")),...
cancelemail ("d09r2", loadvalue (username, "email")),...
cancelemail ("d10", loadvalue (username, "email")),...
cancelemail ("d10r1", loadvalue (username, "email")),...
cancelemail ("d10r2", loadvalue (username, "email")),...
cancelemail ("d11", loadvalue (username, "email")),...
cancelemail ("d11r1", loadvalue (username, "email")),...
cancelemail ("d11r2", loadvalue (username, "email")),...
cancelemail ("d12", loadvalue (username, "email")),...
cancelemail ("d12r1", loadvalue (username, "email")),...
cancelemail ("d12r2", loadvalue (username, "email")),...
cancelemail ("d13", loadvalue (username, "email")),...
cancelemail ("d13r1", loadvalue (username, "email")),...
cancelemail ("d13r2", loadvalue (username, "email"))...
))
#JB deleted append baseline1a.bemail, changed baseline1a.bname to signup.first_name due to people who are 'b'
sendemail( append(username, "smokealot"),"stopsmoking@ucl.ac.uk", append(dialogue_email," has smoked alot"), append("Name: ",dialogue_name, "Email: ",dialogue_email),10)
show dsmokealot02
show dsmokealot03

save dasmok01.smoked01 for username
show dsmokelittlemeds01
show dsmokelittlemeds02
show dsmokelittlemeds03
show dsmokelittlenomed01p1  
show dsmokelittlenomed01p2
show dsmokelittlep1p0402
show dsmokelittlep1p04a
show dsmokelittlep1p04b
show dsmokelittlep1p04bgum
show dsmokelittlep1p04binh
show dsmokelittlep1p04bloz
show dsmokelittlep1p04bmicro
show dsmokelittlep1p04bnas
show dsmokelittlep1p04patch
show dsmokelittlenomed01p3
show dsmokelittleadvice01p1
show dsmokelittleadvice01p2
show dsmokelittleadvice01p3
show dsmokelittleadvice01p4

show dnsmok01p1 if (not(hasseen(username, "dnsmok01p1")))
show dnsmok02p1 if (not(hasseen(username, "dnsmok02p1")))
show dnsmok03p1 if (not(hasseen(username, "dnsmok03p1")))
show dnsmok04p1 if (not(hasseen(username, "dnsmok04p1")))
show dnsmok05p1 if (not(hasseen(username, "dnsmok05p1")))
show dnsmok06p1 if (not(hasseen(username, "dnsmok06p1")))
show dnsmok07p1 if (not(hasseen(username, "dnsmok07p1")))
show dnsmok08p1 if (not(hasseen(username, "dnsmok08p1")))
show dnsmok09p1 if (not(hasseen(username, "dnsmok09p1")))
show dnsmok10p1 if (not(hasseen(username, "dnsmok10p1")))
show dnsmok11p1 if (not(hasseen(username, "dnsmok11p1")))
show dnsmok12p1 if (not(hasseen(username, "dnsmok12p1")))
show dnsmok13p1 if (not(hasseen(username, "dnsmok13p1"))) #All page next buttons jump to daconf01

#S5.2 Confidence question

#This section works much like the one above. If users report that they are not confident, or quite confident (the first
# 'after''if' lines of logic)they are shown some messages to boost their confidence. The first time they select either 
#of these two options they will jump to a block of 'hasseen' logic lines, this will show them a new message, if they
# have seen the previous one. This works in the same way if someone selects that they are very confident. The 
#logic 'goes to' a block of hasseen logic lines, and will show them a new page from the block every time they select
#that they are feeling very confident.

show daconf01
after daconf01 if (or((daconf01.conf01 = "n_confident_01"),(daconf01.conf01 = "q_confident_01")))goto dlconf01p1
after daconf01 if (daconf01.conf01 = "v_confident_01") goto dhconf01p1

show dlconf01p1 if (not(hasseen(username, "dlconf01p1")))
show dlconf02p1 if (not(hasseen(username, "dlconf02p1")))
show dlconf03p1 if (not(hasseen(username, "dlconf03p1")))
show dlconf03p2 if (not(hasseen(username, "dlconf03p1")))
show dlconf04p1 if (not(hasseen(username, "dlconf04p1")))
show dlconf04p2 if (not(hasseen(username, "dlconf04p1")))
show dlconf05p1 if (not(hasseen(username, "dlconf05p1")))
show dlconf05p2 if (not(hasseen(username, "dlconf05p1")))
show dlconf06p1 if (not(hasseen(username, "dlconf06p1")))
show dlconf07p1 if (not(hasseen(username, "dlconf07p1")))
show dlconf08p1 if (not(hasseen(username, "dlconf08p1")))
show dlconf09p1 if (not(hasseen(username, "dlconf09p1")))
show dlconf10p1 if (not(hasseen(username, "dlconf10p1")))
show dlconf11p1 if (not(hasseen(username, "dlconf11p1")))
show dlconf12p1 if (not(hasseen(username, "dlconf12p1")))
show dlconf13p1 if (not(hasseen(username, "dlconf13p1"))) #all pages jump to dacrav01

show dhconf01p1 if (not(hasseen(username, "dhconf01p1")))
show dhconf02p1 if (not(hasseen(username, "dhconf02p1")))
show dhconf03p1 if (not(hasseen(username, "dhconf03p1")))
show dhconf04p1 if (not(hasseen(username, "dhconf04p1")))
show dhconf05p1 if (not(hasseen(username, "dhconf05p1")))
show dhconf06p1 if (not(hasseen(username, "dhconf06p1")))
show dhconf07p1 if (not(hasseen(username, "dhconf07p1")))
show dhconf08p1 if (not(hasseen(username, "dhconf08p1")))
show dhconf09p1 if (not(hasseen(username, "dhconf09p1")))
show dhconf10p1 if (not(hasseen(username, "dhconf10p1")))
show dhconf11p1 if (not(hasseen(username, "dhconf11p1")))
show dhconf12p1 if (not(hasseen(username, "dhconf12p1")))
show dhconf13p1 if (not(hasseen(username, "dhconf13p1")))#all pages jump to dacrav01

#S5.3 - Craving question
# Again here, the first 'after' 'if' logic lines, split those user how are having quite bad or very bad cravings from 
# those who are not having bad cravings. If a user is craving, they jump to the first in a series of groups of pages 
# with advice on how to deal with high cravings. If they select either bad craving option again, they will see the next group 
# of high cravings pages in the logic block. Again, the user will see a new group of messages each time they login and tell
# us their cravings are bad. In the middle of the groups of pages in the logic below there are two after' 'if' logic lines.
# These lines simply give the user a chance to 'go to' the next section, without seeing extra advice. This might be useful
# if a user has less time on one occasion. So the logic works to either give them extra advice, or move them on. These two
# lines occur in the middle of each group of pages. If a user selects that they are experiencing low cravings, the logic goes to
# a block of 'hasseen' lines containing pages with low cravings messages. If a user has seen the first page already, it shows
# them the next page, and so on and so forth. 

show dacrav01
after dacrav01 if (or((dacrav01.craving01 = "quite_bad_01"),(dacrav01.craving01 = "very_bad_01")))goto dhcrav01ap1
after dacrav01 if (dacrav01.craving01 = "not_bad_01")goto dlcrav01p1

show dhcrav01ap1 if (not(hasseen(username, "dhcrav01ap1")))
show dhcrav01ap2 if (not(hasseen(username, "dhcrav01ap1")))
show dhcrav01apnt if (not(hasseen(username, "dhcrav01ap1")))
after dhcrav01apnt if (dhcrav01apnt.anothertip01 = "another_tip_01")goto  dhcrav01bp1 
after dhcrav01apnt if (dhcrav01apnt.anothertip01 = "next_sect_01")goto  dsectionsplit 
show dhcrav01bp1 if (not(hasseen(username, "dhcrav01ap1")))
show dhcrav02ap1 if (not(hasseen(username, "dhcrav02ap1")))
show dhcrav02ap2 if (not(hasseen(username, "dhcrav02ap1")))
show dhcrav02apnt if (not(hasseen(username, "dhcrav02ap1")))
after dhcrav02apnt if (dhcrav02apnt.anothertip02 = "another_tip_01")goto dhcrav02bp1
after dhcrav02apnt if (dhcrav02apnt.anothertip02 = "next_sect_01")goto dsectionsplit 
show dhcrav02bp1 if (not(hasseen(username, "dhcrav02ap1")))
show dhcrav02bp2 if (not(hasseen(username, "dhcrav02ap1")))
show dhcrav03ap1 if (not(hasseen(username, "dhcrav03ap1")))
show dhcrav03ap2 if (not(hasseen(username, "dhcrav03ap1")))
show dhcrav03apnt if (not(hasseen(username, "dhcrav03ap1")))
after dhcrav03apnt if (dhcrav03apnt.anothertip03 = "another_tip_01")goto dhcrav03bp1
after dhcrav03apnt if (dhcrav03apnt.anothertip03 = "next_sect_01")goto dsectionsplit 
show dhcrav03bp1 if (not(hasseen(username, "dhcrav03ap1")))
show dhcrav03bp2 if (not(hasseen(username, "dhcrav03ap1")))
show dhcrav03bp3 if (not(hasseen(username, "dhcrav03ap1")))
show dhcrav04ap1 if (not(hasseen(username, "dhcrav04ap1")))
show dhcrav04ap2 if (not(hasseen(username, "dhcrav04ap1")))
show dhcrav04apnt if (not(hasseen(username, "dhcrav04apnt")))
after dhcrav04apnt if (dhcrav04apnt.anothertip04 = "another_tip_01")goto dhcrav04bp1
after dhcrav04apnt if (dhcrav04apnt.anothertip04 = "next_sect_01")goto dsectionsplit 
show dhcrav04bp1 if (not(hasseen(username, "dhcrav04ap1")))
set dhcrav04bp1.showprogdays to decimalplaces (yourprogdays, 0)
show dhcrav05ap1 if (not(hasseen(username, "dhcrav05ap1")))
show dhcrav05ap2 if (not(hasseen(username, "dhcrav05ap1")))
show dhcrav05apnt if (not(hasseen(username, "dhcrav05ap1")))
after dhcrav05apnt if (dhcrav05apnt.anothertip05 = "another_tip_01")goto dhcrav05bp1
after dhcrav05apnt if (dhcrav05apnt.anothertip05 = "next_sect_01")goto dsectionsplit 
show dhcrav05bp1 if (not(hasseen(username, "dhcrav05ap1")))
save dhcrav05bp1.cravtriggers for username
show dhcrav05bp2 if (not(hasseen(username, "dhcrav05ap1")))
set dhcrav05bp2.dhcrav05bp1feedback to load dhcrav05bp1.cravtriggers for username
show dhcrav06ap1 if (not(hasseen(username, "dhcrav06ap1")))
show dhcrav06apnt if (not(hasseen(username, "dhcrav06ap1")))
after dhcrav06apnt if (dhcrav06apnt.anothertip06 = "another_tip_01")goto dhcrav06bp1
after dhcrav06apnt if (dhcrav06apnt.anothertip06 = "next_sect_01")goto dsectionsplit
show dhcrav06bp1 if (not(hasseen(username, "dhcrav06ap1")))
show dhcrav06bp2 if (not(hasseen(username, "dhcrav06ap1")))
show dhcrav07ap1 if (not(hasseen(username, "dhcrav07ap1")))
show dhcrav07ap2 if (not(hasseen(username, "dhcrav07ap1")))
show dhcrav07apnt if (not(hasseen(username, "dhcrav07ap1")))
after dhcrav07apnt if (dhcrav07apnt.anothertip07 = "another_tip_01")goto dhcrav07bp1
after dhcrav07apnt if (dhcrav07apnt.anothertip07 = "next_sect_01")goto dsectionsplit
show dhcrav07bp1 if (not(hasseen(username, "dhcrav07ap1")))
show dhcrav07bp2 if (not(hasseen(username, "dhcrav07ap1")))

#JJ: Feedback for reasons for quitting
#set dhcrav07bp2.live loadvalue (username, "motiv1")
#set dhcrav07bp2.health to loadvalue (username, "motiv2")
#set dhcrav07bp2.dr to loadvalue (username, "motiv3")
#set dhcrav07bp2.family to loadvalue(username, "motiv4")
#set dhcrav07bp2.money to loadvalue (username, "motiv5")

set motive1 to loadvalue (username, "motive1")
set motive2 to loadvalue (username, "motive2")
set motive3 to loadvalue (username, "motive3")
set motive4 to loadvalue (username, "motive4")
set motive5 to loadvalue (username, "motive5")

#show dhcrav07bp2.livelonger if (p1p02c.stopreason contains "motivation1")
#show dhcrav07bp2.healthy if (p1p02c.stopreason contains "motivation2")
#show dhcrav07bp2.healthissues if (p1p02c.stopreason contains "motivation3")
#show dhcrav07bp2.others if (p1p02c.stopreason contains "motivation4")
#show dhcrav07bp2.financial if (p1p02c.stopreason contains "motivation5")

show dhcrav07bp2.livelonger if (motive1 = "motivation1")
show dhcrav07bp2.healthy if (motive2 = "motivation2")
show dhcrav07bp2.healthissues if (motive3 = "motivation3")
show dhcrav07bp2.others if (motive4 = "motivation4")
show dhcrav07bp2.financial if (motive5 = "motivation5")

save dhcrav07bp2.reasonquit for username #if (not(isempty(dhcrav07bp2.reasonquit)))

#savevalue(username, "motive_extra", "motivation6") if (not(isempty(dhcrav07bp2.reasonquit)))

show dhcrav07bp3 if (not(hasseen(username, "dhcrav07ap1")))
show dhcrav08ap1 if (not(hasseen(username, "dhcrav08ap1")))
show dhcrav08ap2 if (not(hasseen(username, "dhcrav08ap1")))
show dhcrav08ap3 if (not(hasseen(username, "dhcrav08ap1")))
show dhcrav08apnt if (not(hasseen(username, "dhcrav08ap1")))
after dhcrav08apnt if (dhcrav08apnt.anothertip08 = "another_tip_01")goto dhcrav08bp1
after dhcrav08apnt if (dhcrav08apnt.anothertip08 = "next_sect_01")goto dsectionsplit
show dhcrav08bp1 if (not(hasseen(username, "dhcrav08ap1")))
show dhcrav09ap1 if (not(hasseen(username, "dhcrav09ap1")))
show dhcrav09ap2 if (not(hasseen(username, "dhcrav09ap1")))
show dhcrav09ap3 if (not(hasseen(username, "dhcrav09ap1")))
show dhcrav09apnt if (not(hasseen(username, "dhcrav09ap1")))
after dhcrav09apnt if (dhcrav09apnt.anothertip09 = "another_tip_01")goto dhcrav09bp1
after dhcrav09apnt if (dhcrav09apnt.anothertip09 = "next_sect_01")goto dsectionsplit
show dhcrav09bp1 if (not(hasseen(username, "dhcrav09ap1")))
show dhcrav09bp2 if (not(hasseen(username, "dhcrav09ap1")))
show dhcrav10ap1 if (not(hasseen(username, "dhcrav10ap1")))
show dhcrav10ap2 if (not(hasseen(username, "dhcrav10ap1")))
show dhcrav10apnt if (not(hasseen(username, "dhcrav10ap1")))
after dhcrav10apnt if (dhcrav10apnt.anothertip10 = "another_tip_01")goto dhcrav10bp1
after dhcrav10apnt if (dhcrav10apnt.anothertip10 = "next_sect_01")goto dsectionsplit
show dhcrav10bp1 if (not(hasseen(username, "dhcrav10ap1")))
show dhcrav11ap1 if (not(hasseen(username, "dhcrav11ap1")))
show dhcrav11apnt if (not(hasseen(username, "dhcrav11ap1")))
after dhcrav11apnt if (dhcrav11apnt.anothertip11 = "another_tip_01")goto dhcrav11bp1
after dhcrav11apnt if (dhcrav11apnt.anothertip11 = "next_sect_01")goto dsectionsplit
show dhcrav11bp1 if (not(hasseen(username, "dhcrav11ap1")))
#JJ: Feedback
show dhcrav11bp1.livelonger if (motive1 = "motivation1")
show dhcrav11bp1.healthy if (motive2 = "motivation2")
show dhcrav11bp1.healthissues if (motive3 = "motivation3")
show dhcrav11bp1.others if (motive4 = "motivation4")
show dhcrav11bp1.financial if (motive5 = "motivation5")
set dhcrav11bp1.otherreason to load dhcrav07bp2.reasonquit for username
#show dhcrav11bp1.reason if (not(isempty(dhcrav07bp2.reasonquit)))
#show dhcrav11bp1.reasonquit if (not(isempty(dhcrav07bp2.reasonquit)))

show dhcrav11bp2 if (not(hasseen(username, "dhcrav11ap1")))
show dhcrav12ap1 if (not(hasseen(username, "dhcrav12ap1")))
show dhcrav13p1 if (not(hasseen(username, "dhcrav13p1")))# all pages jump to dsectionsplit

show dlcrav01p1 if (not(hasseen(username, "dlcrav01p1")))
show dlcrav02p1 if (not(hasseen(username, "dlcrav02p1")))
show dlcrav03p1 if (not(hasseen(username, "dlcrav03p1")))
show dlcrav04p1 if (not(hasseen(username, "dlcrav04p1")))
show dlcrav05p1 if (not(hasseen(username, "dlcrav05p1")))
show dlcrav06p1 if (not(hasseen(username, "dlcrav06p1")))
show dlcrav07p1 if (not(hasseen(username, "dlcrav07p1")))
show dlcrav08p1 if (not(hasseen(username, "dlcrav08p1")))
show dlcrav09p1 if (not(hasseen(username, "dlcrav09p1")))
show dlcrav10p1 if (not(hasseen(username, "dlcrav10p1")))
show dlcrav11p1 if (not(hasseen(username, "dlcrav11p1")))
show dlcrav12p1 if (not(hasseen(username, "dlcrav12p1")))
show dlcrav13p1 if (not(hasseen(username, "dlcrav13p1")))

#S6 - Spliting those who are using medication, from those who are not.
# After the page 'dsectionsplit' this logic works to set a new variable 'havemedication'. This variable basically condenses
# all the previous information and chances users have had to tell us whether they have got their  medication into one variable.
# This allows us to just use this variable along side the variable created earlier 'notusingmeds', to be able to split people
# into those using medication ('havemedication') and those not using medication (notusingmeds).

show dsectionsplit

#JB - if needed to change to reflect usemed1 and usemed3 
#but didn't need any of these - better, and more robust to set "havemedication" at start?

#after dsectionsplit if (and(...
#savevalue(username, "havemedication", (or(usemed1 = "havemed", usemed3 = "havemed02"))),...
#0=1))goto damed01

#after dsectionsplit if (and(...
#savevalue(username, "havemedication", (or(p1p08confirmmed01.meds01 = "havemed", p1p08confirmmed02.meds02 = "havemed02"))),...
#0=1))goto damed01

#set havemedication to loadvalue(username, "havemedication")


#The below part of S6, shows the users different things based on the variables 'havemedication' and 'notusingmeds'. If 
# the users 'havemedication' they go to a question about whether they are still using it (damed01). If they not using it 
#notusingmeds, they are taken to on of the final sections of the dialogue. This section at the latter part of the dialogue 
# session is about planning for tricky times in the up coming week. As we only want users to see the these pages at the
#start of a week, and not for medweek sessions, the braketed section of logic containing "numlogins" works to do this. 
#Using a line of logic from the very being in the sign up section, this logic block works to recall how many times a user
# has loged in previously, and then shows them a planning page after key, start the week logins. On mid week days users go 
#straight to on the final pages.

#JB - re-wrote this logic. First, even if numlogins was working, this wouldn't work with way we define a session (i.e. only if seen dasmok page)
#Second, the 26 relevant lines appeared as errors after upgrading to LG 1.1.4.19.

after dsectionsplit if (and(...
				(notusingmeds),...
				hasseen(username, "dasmok13", "true")...
				)) goto dplan01p1

after dsectionsplit if (and(...
				(notusingmeds),...
				hasseen(username, "dasmok12", "true")...
				)) goto dfreeexplore01
	
after dsectionsplit if (and(...
				(notusingmeds),...
				hasseen(username, "dasmok11", "true")...
				)) goto dplan01p1
	
after dsectionsplit if (and(...
				(notusingmeds),...
				hasseen(username, "dasmok10", "true")...
				)) goto dfreeexplore01
	
after dsectionsplit if (and(...
				(notusingmeds),...
				hasseen(username, "dasmok09", "true")...
				)) goto dfreeexplore01
	
after dsectionsplit if (and(...
				(notusingmeds),...
				hasseen(username, "dasmok08", "true")...
				)) goto dplan01p1
	
after dsectionsplit if (and(...
				(notusingmeds),...
				hasseen(username, "dasmok07", "true")...
				)) goto dfreeexplore01
	
after dsectionsplit if (and(...
				(notusingmeds),...
				hasseen(username, "dasmok06", "true")...
				)) goto dfreeexplore01
	
after dsectionsplit if (and(...
				(notusingmeds),...
				hasseen(username, "dasmok05", "true")...
				)) goto dfreeexplore01
	
after dsectionsplit if (and(...
				(notusingmeds),...
				hasseen(username, "dasmok04", "true")...
				)) goto dfreeexplore01
	
after dsectionsplit if (and(...
				(notusingmeds),...
				hasseen(username, "dasmok03", "true")...
				)) goto dfreeexplore01
	
after dsectionsplit if (and(...
				(notusingmeds),...
				hasseen(username, "dasmok02", "true")...
				)) goto dfreeexplore01

#JB - testing - after dsectionsplit if (notusingmeds) goto dplan01p1 - this works and branches people to dplan01p1 . When testing, by adding hasseen, or hassen on its own means it just shows damed

after dsectionsplit if (and(...
				(notusingmeds),...
				(hasseen(username, "dasmok01", "true"))...
				)) goto dplan01p1
	
after dsectionsplit if (havemedication) goto damed01

#after dsectionsplit if (and(notusingmeds,loadvalue(username, "numlogins") = 1)) goto dplan01p1
#after dsectionsplit if (and(notusingmeds,loadvalue(username, "numlogins") = 2)) goto dfreeexplore01
#after dsectionsplit if (and(notusingmeds,loadvalue(username, "numlogins") = 3)) goto dfreeexplore01
#after dsectionsplit if (and(notusingmeds,loadvalue(username, "numlogins") = 4)) goto dfreeexplore01
#after dsectionsplit if (and(notusingmeds,loadvalue(username, "numlogins") = 5)) goto dfreeexplore01
#after dsectionsplit if (and(notusingmeds,loadvalue(username, "numlogins") = 6)) goto dfreeexplore01
#after dsectionsplit if (and(notusingmeds,loadvalue(username, "numlogins") = 7)) goto dfreeexplore01
#after dsectionsplit if (and(notusingmeds,loadvalue(username, "numlogins") = 8)) goto dplan01p1
#after dsectionsplit if (and(notusingmeds,loadvalue(username, "numlogins") = 9)) goto dfreeexplore01
#after dsectionsplit if (and(notusingmeds,loadvalue(username, "numlogins") = 10)) goto dfreeexplore01
#after dsectionsplit if (and(notusingmeds,loadvalue(username, "numlogins") = 11)) goto dplan01p1
#after dsectionsplit if (and(notusingmeds,loadvalue(username, "numlogins") = 12)) goto dfreeexplore01
#after dsectionsplit if (and(notusingmeds,loadvalue(username, "numlogins") = 13)) goto dplan01p1

# For those who have medication, they are now asked if they are using it. If they say no they go to a hasseen 
#block of 13 different messages for those who say they have stopped taking their medication. If they have seen the first
#message already, they will be automatically shown the second one and so on. 

# For those who respond that 'yes'they are still taking their medication, the subsequent lines of logic work to establish 
# what medication they are using (for example 'usemedchamp' or 'usemedgum') and whether they are experiencing high, or low
# cravings. It will take people to a different hasseen block to work through depending on the medication they are taking 
# and their reported craving level. 

#after dsectionsplit if (notusingmeds) goto damed01
show damed01

after damed01 if (damed01.stilltakingmed = "no")goto medstopped01

after damed01 if and(usemedchamp, damed01.stilltakingmed = "yes", (or(dacrav01.craving01 = "quite_bad_01", dacrav01.craving01 = "very_bad_01")))goto medchamphi01
after damed01 if and(usemedchamp, damed01.stilltakingmed = "yes", dacrav01.craving01 = "not_bad_01")goto medchamplow01

after damed01 if and(usemedzyban, damed01.stilltakingmed = "yes", (or(dacrav01.craving01 = "quite_bad_01", dacrav01.craving01 = "very_bad_01")))goto medzybhi01
after damed01 if and(usemedzyban, damed01.stilltakingmed = "yes", dacrav01.craving01 = "not_bad_01")goto medzyblow01

after damed01 if and(usemedgum, damed01.stilltakingmed = "yes", (or(dacrav01.craving01 = "quite_bad_01", dacrav01.craving01 = "very_bad_01")))goto medgumhi01
after damed01 if and(usemedgum, damed01.stilltakingmed = "yes", dacrav01.craving01 = "not_bad_01")goto medgumlow01

after damed01 if and(usemedpatch, damed01.stilltakingmed = "yes", (or(dacrav01.craving01 = "quite_bad_01", dacrav01.craving01 = "very_bad_01")))goto medpathi01
after damed01 if and(usemedpatch, damed01.stilltakingmed = "yes", dacrav01.craving01 = "not_bad_01")goto medpatlow01

after damed01 if and(usemedlozenge, damed01.stilltakingmed = "yes", (or(dacrav01.craving01 = "quite_bad_01", dacrav01.craving01 = "very_bad_01")))goto medlozhi01
after damed01 if and(usemedlozenge, damed01.stilltakingmed = "yes", dacrav01.craving01 = "not_bad_01")goto medlozlow01

after damed01 if and(usemedmicrotabs, damed01.stilltakingmed = "yes", (or(dacrav01.craving01 = "quite_bad_01", dacrav01.craving01 = "very_bad_01")))goto Medmichi01
after damed01 if and(usemedmicrotabs, damed01.stilltakingmed = "yes", dacrav01.craving01 = "not_bad_01")goto medmiclow01

after damed01 if and(usemedinhalator, damed01.stilltakingmed = "yes", (or(dacrav01.craving01 = "quite_bad_01", dacrav01.craving01 = "very_bad_01")))goto medinhhi01
after damed01 if and(usemedinhalator, damed01.stilltakingmed = "yes", dacrav01.craving01 = "not_bad_01")goto medinhlow01

after damed01 if and(usemednasal, damed01.stilltakingmed = "yes", (or(dacrav01.craving01 = "quite_bad_01", dacrav01.craving01 = "very_bad_01")))goto mednashi01
after damed01 if and(usemednasal, damed01.stilltakingmed = "yes", dacrav01.craving01 = "not_bad_01")goto mednaslow01


show medchamphi01 if (not(hasseen(username,"medchamphi01")))
show medchamphi02 if (not(hasseen(username,"medchamphi02")))
show medchamphi03 if (not(hasseen(username,"medchamphi03")))
show medchamphi04 if (not(hasseen(username,"medchamphi04")))
show medchamphi05 if (not(hasseen(username,"medchamphi05")))
show medchamphi06 if (not(hasseen(username,"medchamphi06")))
show medchamphi07 if (not(hasseen(username,"medchamphi07")))
show medchamphi08 if (not(hasseen(username,"medchamphi08")))
show medchamphi09 if (not(hasseen(username,"medchamphi09")))
show medchamphi10 if (not(hasseen(username,"medchamphi10")))
show medchamphi11 if (not(hasseen(username,"medchamphi11")))
show medchamphi12 if (not(hasseen(username,"medchamphi12")))
show medchamphi13 if (not(hasseen(username,"medchamphi13")))


show medchamplow01 if (not(hasseen(username,"medchamplow01")))
show medchamplow02 if (not(hasseen(username,"medchamplow02")))
show medchamplow03 if (not(hasseen(username,"medchamplow03"))) 
show medchamplow04 if (not(hasseen(username,"medchamplow04")))
show medchamplow05 if (not(hasseen(username,"medchamplow05")))
show medchamplow06 if (not(hasseen(username,"medchamplow06")))
show medchamplow07 if (not(hasseen(username,"medchamplow07")))
show medchamplow08 if (not(hasseen(username,"medchamplow08")))
show medchamplow09 if (not(hasseen(username,"medchamplow09")))
show medchamplow10 if (not(hasseen(username,"medchamplow10")))
show medchamplow11 if (not(hasseen(username,"medchamplow11")))
show medchamplow12 if (not(hasseen(username,"medchamplow12")))
show medchamplow13 if (not(hasseen(username,"medchamplow13")))


show medzybhi01 if (not(hasseen(username, "medzybhi01")))
show medzybhi02 if (not(hasseen(username, "medzybhi02")))
show medzybhi03 if (not(hasseen(username, "medzybhi03")))
show medzybhi04 if (not(hasseen(username, "medzybhi04")))
show medzybhi05 if (not(hasseen(username, "medzybhi05")))
show medzybhi06 if (not(hasseen(username, "medzybhi06")))
show medzybhi07 if (not(hasseen(username, "medzybhi07")))
show medzybhi08 if (not(hasseen(username, "medzybhi08")))
show medzybhi09 if (not(hasseen(username, "medzybhi09")))
show medzybhi10 if (not(hasseen(username, "medzybhi10")))
show medzybhi11 if (not(hasseen(username, "medzybhi11")))
show medzybhi12 if (not(hasseen(username, "medzybhi12")))
show medzybhi13 if (not(hasseen(username, "medzybhi13")))


show medzyblow01 if (not(hasseen(username, "medzyblow01")))
show medzyblow02 if (not(hasseen(username, "medzyblow02")))
show medzyblow03 if (not(hasseen(username, "medzyblow03")))
show medzyblow04 if (not(hasseen(username, "medzyblow04")))
show medzyblow05 if (not(hasseen(username, "medzyblow05")))
show medzyblow06 if (not(hasseen(username, "medzyblow06")))
show medzyblow07 if (not(hasseen(username, "medzyblow07")))
show medzyblow08 if (not(hasseen(username, "medzyblow08")))
show medzyblow09 if (not(hasseen(username, "medzyblow09")))
show medzyblow10 if (not(hasseen(username, "medzyblow10")))
show medzyblow11 if (not(hasseen(username, "medzyblow11")))
show medzyblow12 if (not(hasseen(username, "medzyblow12")))
show medzyblow13 if (not(hasseen(username, "medzyblow13")))


show medgumhi01 if (not(hasseen(username, "medgumhi01")))
show medgumhi02 if (not(hasseen(username, "medgumhi02")))
show medgumhi03 if (not(hasseen(username, "medgumhi03")))
show medgumhi04 if (not(hasseen(username, "medgumhi04")))
show medgumhi05 if (not(hasseen(username, "medgumhi05")))
show medgumhi06 if (not(hasseen(username, "medgumhi06")))
show medgumhi07 if (not(hasseen(username, "medgumhi07")))
show medgumhi08 if (not(hasseen(username, "medgumhi08")))
show medgumhi09 if (not(hasseen(username, "medgumhi09")))
show medgumhi10 if (not(hasseen(username, "medgumhi10")))
show medgumhi11 if (not(hasseen(username, "medgumhi11")))
show medgumhi12 if (not(hasseen(username, "medgumhi12")))
show medgumhi13 if (not(hasseen(username, "medgumhi13")))


show medgumlow01 if (not(hasseen(username, "medgumlow01")))
show medgumlow02 if (not(hasseen(username, "medgumlow02")))
show medgumlow03 if (not(hasseen(username, "medgumlow03")))
show medgumlow04 if (not(hasseen(username, "medgumlow04")))
show medgumlow05 if (not(hasseen(username, "medgumlow05")))
show medgumlow06 if (not(hasseen(username, "medgumlow06")))
show medgumlow07 if (not(hasseen(username, "medgumlow07")))
show medgumlow08 if (not(hasseen(username, "medgumlow08")))
show medgumlow09 if (not(hasseen(username, "medgumlow09")))
show medgumlow10 if (not(hasseen(username, "medgumlow10")))
show medgumlow11 if (not(hasseen(username, "medgumlow11")))
show medgumlow12 if (not(hasseen(username, "medgumlow12")))
show medgumlow13 if (not(hasseen(username, "medgumlow13")))


show medpathi01 if (not(hasseen(username, "medpathi01")))
show medpathi02 if (not(hasseen(username, "medpathi02")))
show medpathi03 if (not(hasseen(username, "medpathi03")))
show medpathi04 if (not(hasseen(username, "medpathi04")))
show medpathi05 if (not(hasseen(username, "medpathi05")))
show medpathi06 if (not(hasseen(username, "medpathi06")))
show medpathi07 if (not(hasseen(username, "medpathi07")))
show medpathi08 if (not(hasseen(username, "medpathi08")))
show medpathi09 if (not(hasseen(username, "medpathi09")))
show medpathi10 if (not(hasseen(username, "medpathi10")))
show medpathi11 if (not(hasseen(username, "medpathi11")))
show medpathi12 if (not(hasseen(username, "medpathi12")))
show medpathi13 if (not(hasseen(username, "medpathi13")))


show medpatlow01 if (not(hasseen(username, "medpatlow01")))
show medpatlow02 if (not(hasseen(username, "medpatlow02")))
show medpatlow03 if (not(hasseen(username, "medpatlow03")))
show medpatlow04 if (not(hasseen(username, "medpatlow04")))
show Medpatlow05 if (not(hasseen(username, "Medpatlow05")))
show medpatlow06 if (not(hasseen(username, "medpatlow06")))
show medpatlow07 if (not(hasseen(username, "medpatlow07")))
show medpatlow08 if (not(hasseen(username, "medpatlow08")))
show medpatlow09 if (not(hasseen(username, "medpatlow09")))
show medpatlow10 if (not(hasseen(username, "medpatlow10")))
show medpatlow11 if (not(hasseen(username, "medpatlow11")))
show Medpatlow12 if (not(hasseen(username, "Medpatlow12")))
show medpatlow13 if (not(hasseen(username, "medpatlow13")))

show medlozhi01 if (not(hasseen(username, "medlozhi01")))
show medlozhi02 if (not(hasseen(username, "medlozhi02")))
show medlozhi03 if (not(hasseen(username, "medlozhi03")))
show medlozhi04 if (not(hasseen(username, "medlozhi04")))
show medlozhi05 if (not(hasseen(username, "medlozhi05")))
show medlozhi06 if (not(hasseen(username, "medlozhi06")))
show medlozhi07 if (not(hasseen(username, "medlozhi07")))
show medlozhi08 if (not(hasseen(username, "medlozhi08")))
show medlozhi09 if (not(hasseen(username, "medlozhi09")))
show medlozhi10 if (not(hasseen(username, "medlozhi10")))
show medlozhi11 if (not(hasseen(username, "medlozhi11")))
show medlozhi12 if (not(hasseen(username, "medlozhi12")))
show medlozhi13 if (not(hasseen(username, "medlozhi13")))


show medlozlow01 if (not(hasseen(username, "medlozlow01")))
show Medlozlow02 if (not(hasseen(username, "Medlozlow02")))
show medlozlow03 if (not(hasseen(username, "medlozlow03")))
show medlozlow04 if (not(hasseen(username, "medlozlow04")))
show medlozlow05 if (not(hasseen(username, "medlozlow05")))
show medlozlow06 if (not(hasseen(username, "medlozlow06")))
show medlozlow07 if (not(hasseen(username, "medlozlow07")))
show medlozlow08 if (not(hasseen(username, "medlozlow08")))
show medlozlow09 if (not(hasseen(username, "medlozlow09")))
show medlozlow10 if (not(hasseen(username, "medlozlow10")))
show medlozlow11 if (not(hasseen(username, "medlozlow11")))
show medlozlow12 if (not(hasseen(username, "medlozlow12")))
show medlozlow13 if (not(hasseen(username, "medlozlow13")))

show Medmichi01 if (not(hasseen(username, "Medmichi01")))
show medmichi02 if (not(hasseen(username, "medmichi02")))
show medmichi03 if (not(hasseen(username, "medmichi03")))
show medmichi04 if (not(hasseen(username, "medmichi04")))
show medmichi05 if (not(hasseen(username, "medmichi05")))
show medmichi06 if (not(hasseen(username, "medmichi06")))
show medmichi07 if (not(hasseen(username, "medmichi07")))
show medmichi08 if (not(hasseen(username, "medmichi08")))
show medmichi09 if (not(hasseen(username, "medmichi09")))
show medmichi10 if (not(hasseen(username, "medmichi10")))
show medmichi11 if (not(hasseen(username, "medmichi11")))
show medmichi12 if (not(hasseen(username, "medmichi12")))
show medmichi13 if (not(hasseen(username, "medmichi13")))

show medmiclow01 if (not(hasseen(username, "medmiclow01")))
show medmiclow02 if (not(hasseen(username, "medmiclow02")))
show medmiclow03 if (not(hasseen(username, "medmiclow03")))
show medmiclow04 if (not(hasseen(username, "medmiclow04")))
show medmiclow05 if (not(hasseen(username, "medmiclow05")))
show medmiclow06 if (not(hasseen(username, "medmiclow06")))
show medmiclow07 if (not(hasseen(username, "medmiclow07")))
show medmiclow08 if (not(hasseen(username, "medmiclow08")))
show medmiclow09 if (not(hasseen(username, "medmiclow09")))
show medmiclow10 if (not(hasseen(username, "medmiclow10")))
show medmiclow11 if (not(hasseen(username, "medmiclow11")))
show medmiclow12 if (not(hasseen(username, "medmiclow12")))
show medmiclow13 if (not(hasseen(username, "medmiclow13")))

show medinhhi01 if (not(hasseen(username, "medinhhi01")))
show medinhhi02 if (not(hasseen(username, "medinhhi02")))
show medinhhi03 if (not(hasseen(username, "medinhhi03")))
show medinhhi04 if (not(hasseen(username, "medinhhi04")))
show medinhhi05 if (not(hasseen(username, "medinhhi05")))
show medinhhi06 if (not(hasseen(username, "medinhhi06")))
show medinhhi07 if (not(hasseen(username, "medinhhi07")))
show medinhhi08 if (not(hasseen(username, "medinhhi08")))
show medinhhi09 if (not(hasseen(username, "medinhhi09")))
show medinhhi10 if (not(hasseen(username, "medinhhi10")))
show medinhhi11 if (not(hasseen(username, "medinhhi11")))
show medinhhi12 if (not(hasseen(username, "medinhhi12")))
show medinhhi13 if (not(hasseen(username, "medinhhi13")))

show medinhlow01 if (not(hasseen(username, "medinhlow01")))
show medinhlow02 if (not(hasseen(username, "medinhlow02")))
show medinhlow03 if (not(hasseen(username, "medinhlow03")))
show medinhlow04 if (not(hasseen(username, "medinhlow04")))
show medinhlow05 if (not(hasseen(username, "medinhlow05")))
show medinhlow06 if (not(hasseen(username, "medinhlow06")))
show medinhlow07 if (not(hasseen(username, "medinhlow07")))
show medinhlow08 if (not(hasseen(username, "medinhlow08")))
show medinhlow09 if (not(hasseen(username, "medinhlow09")))
show medinhlow10 if (not(hasseen(username, "medinhlow10")))
show medinhlow11 if (not(hasseen(username, "medinhlow11")))
show medinhlow12 if (not(hasseen(username, "medinhlow12")))
show medinhlow13 if (not(hasseen(username, "medinhlow13")))

show mednashi01 if (not(hasseen(username, "mednashi01")))
show mednashi02 if (not(hasseen(username, "mednashi02")))
show mednashi03 if (not(hasseen(username, "mednashi03")))
show mednashi04 if (not(hasseen(username, "mednashi04")))
show mednashi05 if (not(hasseen(username, "mednashi05")))
show mednashi06 if (not(hasseen(username, "mednashi06")))
show mednashi07 if (not(hasseen(username, "mednashi07")))
show mednashi08 if (not(hasseen(username, "mednashi08")))
show mednashi09 if (not(hasseen(username, "mednashi09")))
show mednashi10 if (not(hasseen(username, "mednashi10")))
show mednashi11 if (not(hasseen(username, "mednashi11")))
show mednashi12 if (not(hasseen(username, "mednashi12")))
show mednashi13 if (not(hasseen(username, "mednashi13")))

show mednaslow01 if (not(hasseen(username, "mednaslow01")))
show mednaslow02 if (not(hasseen(username, "mednaslow02")))
show mednaslow03 if (not(hasseen(username, "mednaslow03")))
show mednaslow04 if (not(hasseen(username, "mednaslow04")))
show mednaslow05 if (not(hasseen(username, "mednaslow05")))
show mednaslow06 if (not(hasseen(username, "mednaslow06")))
show mednaslow07 if (not(hasseen(username, "mednaslow07")))
show mednaslow08 if (not(hasseen(username, "mednaslow08")))
show mednaslow09 if (not(hasseen(username, "mednaslow09")))
show mednaslow10 if (not(hasseen(username, "mednaslow10")))
show mednaslow11 if (not(hasseen(username, "mednaslow11")))
show mednaslow12 if (not(hasseen(username, "mednaslow12")))
show mednaslow13 if (not(hasseen(username, "mednaslow13")))

show medstopped01 if (not(hasseen(username, "medstopped01")))
show medstopped02 if (not(hasseen(username, "medstopped02")))
show medstopped03 if (not(hasseen(username, "medstopped03")))
show medstopped04 if (not(hasseen(username, "medstopped04")))
show medstopped05 if (not(hasseen(username, "medstopped05")))
show medstopped06 if (not(hasseen(username, "medstopped06")))
show medstopped07 if (not(hasseen(username, "medstopped07")))
show medstopped08 if (not(hasseen(username, "medstopped08")))
show medstopped09 if (not(hasseen(username, "medstopped09")))
show medstopped10 if (not(hasseen(username, "medstopped10")))
show medstopped11 if (not(hasseen(username, "medstopped11")))
show medstopped12 if (not(hasseen(username, "medstopped12")))
show medstopped13 if (not(hasseen(username, "medstopped13")))

#S7 - This section repeats the first part of S7 for those who have medication

show dsectionsplit02

after dsectionsplit02 if (hasseen(username, "dasmok13", "true")) goto dplan01p1
after dsectionsplit02 if (hasseen(username, "dasmok12", "true")) goto dfreeexplore01
after dsectionsplit02 if (hasseen(username, "dasmok11", "true")) goto dplan01p1
after dsectionsplit02 if (hasseen(username, "dasmok10", "true")) goto dfreeexplore01
after dsectionsplit02 if (hasseen(username, "dasmok09", "true")) goto dfreeexplore01
after dsectionsplit02 if (hasseen(username, "dasmok08", "true")) goto dplan01p1
after dsectionsplit02 if (hasseen(username, "dasmok07", "true")) goto dfreeexplore01
after dsectionsplit02 if (hasseen(username, "dasmok06", "true")) goto dfreeexplore01
after dsectionsplit02 if (hasseen(username, "dasmok05", "true")) goto dfreeexplore01
after dsectionsplit02 if (hasseen(username, "dasmok04", "true")) goto dfreeexplore01
after dsectionsplit02 if (hasseen(username, "dasmok03", "true")) goto dfreeexplore01
after dsectionsplit02 if (hasseen(username, "dasmok02", "true")) goto dfreeexplore01
after dsectionsplit02 if (hasseen(username, "dasmok01", "true")) goto dplan01p1
	
#S8 - Planning for the week ahead, and homework tasks

#First this logic shows two pages about planning for social events or stressful events. Then the logic moves users to 
#different sections depending on whether they have a social event, or a stressfull event, or no events coming up in the
#week ahead. Depending on the answer to this question, the logic goes to a respective hasseen block for each option, social
#stressful or none. As the are four weeks in the intervention period, people will only see the planning pages four times. 
#Thus, each hasseen block contains four pages. The their is only one take home/homework exercise page per week, so there
#are just four pages (forming a small hasseen block).

show dplan01p1 
after dplan01p1 if (dplan01p1.planning01 = "social")goto dplansocial01
after dplan01p1 if (dplan01p1.planning01 = "stressful")goto dplanstressful01
after dplan01p1 if (dplan01p1.planning01 = "none")goto dplannone01

show dplansocial01 if (not(hasseen(username, "dplansocial01")))
show dplansocial02 if (not(hasseen(username, "dplansocial02")))
show dplansocial03 if (not(hasseen(username, "dplansocial03")))
show dplansocial04 if (not(hasseen(username, "dplansocial04")))

show dplanstressful01 if (not(hasseen(username, "dplanstressful01")))
show dplanstressful02 if (not(hasseen(username, "dplanstressful02")))
show dplanstressful03 if (not(hasseen(username, "dplanstressful03")))
show dplanstressful04 if (not(hasseen(username, "dplanstressful04")))

show dplannone01 if (not(hasseen(username, "dplannone01")))
show dplannone02 if (not(hasseen(username, "dplannone02")))
show dplannone03 if (not(hasseen(username, "dplannone03")))
show dplannone04 if (not(hasseen(username, "dplannone04")))

#Optional texts - Planning for social events

#re: the timings for the optional texts - the 4 different social texts are to be sent at date and time chosen on the 
#4 different #dplansocialXXp2 - one for each. The relevant interactions are labelled socialtxtdateX, socialtxthourX
#and socialtxtminX on each of the 4 pages. The pages and interactions are equivalent for the stress texts 
#(i.e., dplanstressfulXXp2 and stresstxtdateX, stresstxthourX & stresstxtminX).
show dplansocial01p2

set mins1 to 0
if (dplansocial01p2.socialtxtmin1 = "fifteen") set mins1 to 15
if (dplansocial01p2.socialtxtmin1 = "thirty") set mins1 to 30
if (dplansocial01p2.socialtxtmin1 = "fortyfive") set mins1 to 45
set socialtext1 to +(dplansocial01p2.socialtxtdate1, (3600 * dplansocial01p2.socialtxthour1), (60 * mins1), (-1 * currenttime()))

if (not(isempty(dplansocial01p2.mobtelsocial))) set socialtexttime_email to printtime(+(dplansocial01p2.socialtxtdate1, (3600 * dplansocial01p2.socialtxthour1), (60 * mins1)),"H:m d-M-y")
if (not(isempty(dplansocial01p2.mobtelsocial))) set socialmob_email to dplansocial01p2.mobtelsocial

after dplansocial01p2 if (and((not(isempty(dplansocial01p2.mobtelsocial))), sendemail(append(username, "socialtext"),"stopsmoking@ucl.ac.uk", append("Text at ", socialtexttime_email," on ", socialmob_email,". Hi. You asked us to text you at your social event. Remember - not a puff, no matter what. If someone offers you a cigarette, you can just say: 'No thanks, I'm giving up and haven't smoked since..'"),append("Text",...
						" at ", socialtexttime_email," on ", socialmob_email,". Hi. You asked us to text you at your social event. Remember - not a puff, no matter what. If someone offers you a cigarette, you can just say: 'No thanks, I'm giving up and haven't smoked since..' "),10),...
						sendtext("social_1", dplansocial01p2.mobtelsocial, "Hi. You asked us to text you at your social event. Remember - not a puff, no matter what. If someone offers you a cigarette, you can just say: 'No thanks, I'm giving up and haven't smoked since..'", socialtext1)))...
						goto dfreeexplore01
			
after dplansocial01p2 if (1=1) goto dfreeexplore01

show dplansocial02p2

set mins2 to 0
if (dplansocial02p2.socialtxtmin2 = "fifteen") set mins2 to 15
if (dplansocial02p2.socialtxtmin2 = "thirty") set mins2 to 30
if (dplansocial02p2.socialtxtmin2 = "fortyfive") set mins2 to 45
set socialtext2 to +(dplansocial02p2.socialtxtdate2, (3600 * dplansocial02p2.socialtxthour2), (60 * mins2), (-1 * currenttime()))


if (not(isempty(dplansocial02p2.mobtelsocial2))) set socialtexttime2_email to printtime(+(dplansocial02p2.socialtxtdate2, (3600 * dplansocial02p2.socialtxthour2), (60 * mins2)),"H:m d-M-y")
if (not(isempty(dplansocial02p2.mobtelsocial2))) set socialmob2_email to dplansocial02p2.mobtelsocial2

after dplansocial02p2 if (and((not(isempty(dplansocial02p2.mobtelsocial2))), sendemail(append(username, "socialtext2"),"stopsmoking@ucl.ac.uk", append("Text at ", socialtexttime2_email," on ", socialmob2_email,". Hi. We hope your social event is going well. Remember you're committed to your 'not a puff, no matter what' rule. If things are getting bad, then get out of the situation - at least for a little while."),append("Text",...
						" at ", socialtexttime2_email," on ", socialmob2_email,". Hi. We hope your social event is going well. Remember you're committed to your 'not a puff, no matter what' rule. If things are getting bad, then get out of the situation - at least for a little while. "),10),...
						sendtext("social_2", dplansocial02p2.mobtelsocial2, "Hi. We hope your social event is going well. Remember you're committed to your 'not a puff, no matter what' rule. If things are getting bad, then get out of the situation - at least for a little while.", socialtext2)))...
						goto dfreeexplore01
			
after dplansocial02p2 if (1=1) goto dfreeexplore01

show dplansocial03p2

set mins3 to 0
if (dplansocial03p2.socialtxtmin3 = "fifteen") set mins3 to 15
if (dplansocial03p2.socialtxtmin3 = "thirty") set mins3 to 30
if (dplansocial03p2.socialtxtmin3 = "fortyfive") set mins3 to 45
set socialtext3 to +(dplansocial03p2.socialtxtdate3, (3600 * dplansocial03p2.socialtxthour3), (60 * mins3), (-1 * currenttime()))

if (not(isempty(dplansocial03p2.mobtelsocial3))) set socialtexttime3_email to printtime(+(dplansocial03p2.socialtxtdate3, (3600 * dplansocial03p2.socialtxthour3), (60 * mins3)),"H:m d-M-y")
if (not(isempty(dplansocial03p2.mobtelsocial3))) set socialmob3_email to dplansocial03p2.mobtelsocial3

after dplansocial03p2 if (and((not(isempty(dplansocial03p2.mobtelsocial3))), sendemail(append(username, "socialtext3"),"stopsmoking@ucl.ac.uk", append("Text at ", socialtexttime3_email," on ", socialmob3_email,". Hi. We hope your socialising is going well. Remember the only thing that matters is avoiding a puff. If you're tempted think how bad you'd feel. And how great you'll feel when you resist."),append("Text",...
						" at ", socialtexttime3_email," on ", socialmob3_email,". Hi. We hope your socialising is going well. Remember the only thing that matters is avoiding a puff. If you're tempted think how bad you'd feel. And how great you'll feel when you resist. "),10),...
						sendtext("social_3", dplansocial03p2.mobtelsocial3, "Hi. We hope your socialising is going well. Remember the only thing that matters is avoiding a puff. If you're tempted think how bad you'd feel. And how great you'll feel when you resist.", socialtext3)))...
						goto dfreeexplore01
			
after dplansocial03p2 if (1=1) goto dfreeexplore01

show dplansocial04p2

set mins4 to 0
if (dplansocial04p2.socialtxtmin4 = "fifteen") set mins4 to 15
if (dplansocial04p2.socialtxtmin4 = "thirty") set mins4 to 30
if (dplansocial04p2.socialtxtmin4 = "fortyfive") set mins4 to 45
set socialtext4 to +(dplansocial04p2.socialtxtdate4, (3600 * dplansocial04p2.socialtxthour4), (60 * mins4), (-1 * currenttime()))

if (not(isempty(dplansocial04p2.mobtelsocial4))) set socialtexttime4_email to printtime(+(dplansocial04p2.socialtxtdate4, (3600 * dplansocial04p2.socialtxthour4), (60 * mins4)),"H:m d-M-y")
if (not(isempty(dplansocial04p2.mobtelsocial4))) set socialmob4_email to dplansocial04p2.mobtelsocial4

after dplansocial04p2 if (and((not(isempty(dplansocial04p2.mobtelsocial4))), sendemail(append(username, "socialtext4"),"stopsmoking@ucl.ac.uk", append("Text at ", socialtexttime4_email," on ", socialmob4_email,". Hi. We hope you're coping with the socialising. You've made it a long way and this is a great sign you'll stay off cigarettes for good. Remember, not a puff, no matter what."),append("Text",...
						" at ", socialtexttime4_email," on ", socialmob4_email,". Hi. We hope you're coping with the socialising. You've made it a long way and this is a great sign you'll stay off cigarettes for good. Remember, not a puff, no matter what. "),10),...
						sendtext("social_4", dplansocial04p2.mobtelsocial4, "Hi. We hope you're coping with the socialising. You've made it a long way and this is a great sign you'll stay off cigarettes for good. Remember, not a puff, no matter what.", socialtext4)))...
						goto dfreeexplore01
			
after dplansocial04p2 if (1=1) goto dfreeexplore01

#Optional texts - Planning for stressful events

show dplanstressful01p2

set mins01 to 0
if (dplanstressful01p2.stresstxtmin1 = "fifteen") set mins01 to 15
if (dplanstressful01p2.stresstxtmin1 = "thirty") set mins01 to 30
if (dplanstressful01p2.stresstxtmin1 = "fortyfive") set mins01 to 45
set stresstext1 to +(dplanstressful01p2.stresstxtdate1, (3600 * dplanstressful01p2.stresstxthour1), (60 * mins01), (-1 * currenttime()))

if (not(isempty(dplanstressful01p2.mobtelstress))) set stresstexttime1_email to printtime(+(dplanstressful01p2.stresstxtdate1, (3600 * dplanstressful01p2.stresstxthour1), (60 * mins01)),"H:m d-M-y")
if (not(isempty(dplanstressful01p2.mobtelstress))) set stressmob1_email to dplanstressful01p2.mobtelstress

after dplanstressful01p2 if (and((not(isempty(dplanstressful01p2.mobtelstress))), sendemail(append(username, "stresstext1"),"stopsmoking@ucl.ac.uk", append("Text at ", stresstexttime1_email," on ", stressmob1_email,". Hi. You asked us to text you at a stressful time. Remember you're committed to your 'not a puff, no matter what' rule. Also, do something before and afterwards you enjoy, or keeps your mind busy."),append("Text",...
						" at ", stresstexttime1_email," on ", stressmob1_email,". Hi. You asked us to text you at a stressful time. Remember you're committed to your 'not a puff, no matter what' rule. Also, do something before and afterwards you enjoy, or keeps your mind busy. "),10),...
						sendtext("stress_1", dplanstressful01p2.mobtelstress, "Hi. You asked us to text you at a stressful time. Remember you're committed to your 'not a puff, no matter what' rule. Also, do something before and afterwards you enjoy, or keeps your mind busy.", stresstext1)))...
						goto dfreeexplore01
			
after dplanstressful01p2 if (1=1) goto dfreeexplore01

show dplanstressful02p2

set mins02 to 0
if (dplanstressful02p2.stresstxtmin2 = "fifteen") set mins02 to 15
if (dplanstressful02p2.stresstxtmin2 = "thirty") set mins02 to 30
if (dplanstressful02p2.stresstxtmin2 = "fortyfive") set mins02 to 45
set stresstext2 to +(dplanstressful02p2.stresstxtdate2, (3600 * dplanstressful02p2.stresstxthour2), (60 * mins02), (-1 * currenttime()))

if (not(isempty(dplanstressful02p2.mobtelstress2))) set stresstexttime2_email to printtime(+(dplanstressful02p2.stresstxtdate2, (3600 * dplanstressful02p2.stresstxthour2), (60 * mins02)),"H:m d-M-y")
if (not(isempty(dplanstressful02p2.mobtelstress2))) set stressmob2_email to dplanstressful02p2.mobtelstress2

after dplanstressful02p2 if (and((not(isempty(dplanstressful02p2.mobtelstress2))), sendemail(append(username, "stresstext2"),"stopsmoking@ucl.ac.uk", append("Text at ", stresstexttime2_email," on ", stressmob2_email,". Hi. We hope you aren't too stressed. Remember - not a puff, no matter what. If things are getting bad, distract yourself from it - at least for a little while. And, later, treat yourself to something you enjoy."),append("Text",...
						" at ", stresstexttime2_email," on ", stressmob2_email,". Hi. We hope you aren't too stressed. Remember - not a puff, no matter what. If things are getting bad, distract yourself from it - at least for a little while. And, later, treat yourself to something you enjoy. "),10),...
						sendtext("stress_2", dplanstressful02p2.mobtelstress2, "Hi. We hope you aren't too stressed. Remember - not a puff, no matter what. If things are getting bad, distract yourself from it - at least for a little while. And, later, treat yourself to something you enjoy.", stresstext2)))...
						goto dfreeexplore01
			
after dplanstressful02p2 if (1=1) goto dfreeexplore01

show dplanstressful03p2

set mins03 to 0
if (dplanstressful03p2.stresstxtmin3 = "fifteen") set mins03 to 15
if (dplanstressful03p2.stresstxtmin3 = "thirty") set mins03 to 30
if (dplanstressful03p2.stresstxtmin3 = "fortyfive") set mins03 to 45
set stresstext3 to +(dplanstressful03p2.stresstxtdate3, (3600 * dplanstressful03p2.stresstxthour3), (60 * mins03), (-1 * currenttime()))

if (not(isempty(dplanstressful03p2.mobtelstress3))) set stresstexttime3_email to printtime(+(dplanstressful03p2.stresstxtdate3, (3600 * dplanstressful03p2.stresstxthour3), (60 * mins03)),"H:m d-M-y")
if (not(isempty(dplanstressful03p2.mobtelstress3))) set stressmob3_email to dplanstressful03p2.mobtelstress3

after dplanstressful03p2 if (and((not(isempty(dplanstressful03p2.mobtelstress3))), sendemail(append(username, "stresstext3"),"stopsmoking@ucl.ac.uk", append("Text at ", stresstexttime3_email," on ", stressmob3_email,". Hi. We hope you're handling the stressful situation. Remember all that matters is avoiding a puff. If you're tempted think how bad you'd feel. And how great you'll feel knowing you resisted."),append("Text",...
						" at ", stresstexttime3_email," on ", stressmob3_email,". Hi. We hope you're handling the stressful situation. Remember all that matters is avoiding a puff. If you're tempted think how bad you'd feel. And how great you'll feel knowing you resisted. "),10),...
						sendtext("stress_3", dplanstressful03p2.mobtelstress3, "Hi. We hope you're handling the stressful situation. Remember all that matters is avoiding a puff. If you're tempted think how bad you'd feel. And how great you'll feel knowing you resisted.", stresstext3)))...
						goto dfreeexplore01
			
after dplanstressful03p2 if (1=1) goto dfreeexplore01

show dplanstressful04p2

set mins04 to 0
if (dplanstressful04p2.stresstxtmin4 = "fifteen") set mins04 to 15
if (dplanstressful04p2.stresstxtmin4 = "thirty") set mins04 to 30
if (dplanstressful04p2.stresstxtmin4 = "fortyfive") set mins04 to 45
set stresstext4 to +(dplanstressful04p2.stresstxtdate4, (3600 * dplanstressful04p2.stresstxthour4), (60 * mins04), (-1 * currenttime()))

if (not(isempty(dplanstressful04p2.mobtelstress4))) set stresstexttime4_email to printtime(+(dplanstressful04p2.stresstxtdate4, (3600 * dplanstressful04p2.stresstxthour4), (60 * mins04)),"H:m d-M-y")
if (not(isempty(dplanstressful04p2.mobtelstress4))) set stressmob4_email to dplanstressful04p2.mobtelstress4

after dplanstressful04p2 if (and((not(isempty(dplanstressful04p2.mobtelstress4))), sendemail(append(username, "stresstext4"),"stopsmoking@ucl.ac.uk", append("Text at ", stresstexttime4_email," on ", stressmob4_email,". Hi. We hope you're coping with the stress. You've made it a long way and this is a great sign you'll stay off cigarettes for good. Remember, not a puff, no matter what."),append("Text",...
						" at ", stresstexttime4_email," on ", stressmob4_email,". Hi. We hope you're coping with the stress. You've made it a long way and this is a great sign you'll stay off cigarettes for good. Remember, not a puff, no matter what. "),10),...
						sendtext("stress_4", dplanstressful04p2.mobtelstress4, "Hi. We hope you're coping with the stress. You've made it a long way and this is a great sign you'll stay off cigarettes for good. Remember, not a puff, no matter what.", stresstext4)))...
						goto dfreeexplore01
			
after dplanstressful04p2 if (1=1) goto dfreeexplore01

#S8- Sending emails to come back to the website
#This section sends out emails after people have completed a section. Essentially, after seeing the page 'dfreetoexplore'
# this triggers an automatic email to be sent out depending on the particular time required before their next login.
#As each email is unique, it need a new page to be sent out after. The freetoexplore pages all have similar content. 
#they are simply numbered differently.

#JB - deleted these old emails. Now triggered at start of session to allow for users not reaching very end.

show dfreeexplore01 if (not(hasseen(username,"dfreeexplore01")))
#after dfreeexplore01 if sendemail ("login1", username, "Using StopAdvisor Today", append ("Dear ",signup.first_name,",\n\n Here is a link to take you to today's StopAdvisor session \n\n http://www.lifeguideonline.org/player/play/stopafullv1?jumpto=login&thiz=awelcome \n\n Remember if you forget your username or password email xxx@xxx for a new one. \n\n Best wishes \n\n StopAdvisor Team"),10) goto dmenu01 # after testing set to 86400

show dfreeexplore02 if (not(hasseen(username,"dfreeexplore02")))
#after dfreeexplore02 if sendemail ("login2", username, "Using StopAdvisor Today", append ("Dear ",signup.first_name,",\n\n Here is a link to take you to today's StopAdvisor session \n\n http://www.lifeguideonline.org/player/play/stopafullv1?jumpto=login&thiz=awelcome \n\n Remember if you forget your username or password email xxx@xxx for a new one. \n\n Best wishes \n\n StopAdvisor Team"),10) goto dmenu01 # after testing set to 86400

show dfreeexplore03 if (not(hasseen(username,"dfreeexplore03")))
#after dfreeexplore03 if sendemail ("login3", username, "Using StopAdvisor Today", append ("Dear ",signup.first_name,",\n\n Here is a link to take you to today's StopAdvisor session \n\n http://www.lifeguideonline.org/player/play/stopafullv1?jumpto=login&thiz=awelcome \n\n Remember if you forget your username or password email xxx@xxx for a new one. \n\n Best wishes \n\n StopAdvisor Team"),10) goto dmenu01 # after testing set to 86400

show dfreeexplore04 if (not(hasseen(username,"dfreeexplore04")))
#after dfreeexplore04 if sendemail ("login5", username, "Using StopAdvisor Today", append ("Dear ",signup.first_name,",\n\n Here is a link to take you to today's StopAdvisor session \n\n http://www.lifeguideonline.org/player/play/stopafullv1?jumpto=login&thiz=awelcome \n\n Remember if you forget your username or password email xxx@xxx for a new one. \n\n Best wishes \n\n StopAdvisor Team"),10) goto dmenu01 # after testing set to 86400

show dfreeexplore05 if (not(hasseen(username,"dfreeexplore05")))
#after dfreeexplore05 if sendemail ("login5", username, "Using StopAdvisor Today", append ("Dear ",signup.first_name,",\n\n Here is a link to take you to today's StopAdvisor session \n\n http://www.lifeguideonline.org/player/play/stopafullv1?jumpto=login&thiz=awelcome \n\n Remember if you forget your username or password email xxx@xxx for a new one. \n\n Best wishes \n\n StopAdvisor Team"),10) goto dmenu01 # after testing set to 86400

show dfreeexplore06 if (not(hasseen(username,"dfreeexplore06")))
#after dfreeexplore06 if sendemail ("login6", username, "Using StopAdvisor Today", append ("Dear ",signup.first_name,",\n\n Here is a link to take you to today's StopAdvisor session \n\n http://www.lifeguideonline.org/player/play/stopafullv1?jumpto=login&thiz=awelcome \n\n Remember if you forget your username or password email xxx@xxx for a new one. \n\n Best wishes \n\n StopAdvisor Team"),10) goto dmenu01 # after testing set to 86400

show dfreeexplore07 if (not(hasseen(username,"dfreeexplore07")))
#after dfreeexplore07 if sendemail ("login7", username, "Using StopAdvisor Today", append ("Dear ",signup.first_name,",\n\n Here is a link to take you to today's StopAdvisor session \n\n http://www.lifeguideonline.org/player/play/stopafullv1?jumpto=login&thiz=awelcome \n\n Remember if you forget your username or password email xxx@xxx for a new one. \n\n Best wishes \n\n StopAdvisor Team"),10) goto dmenu01 # after testing set to 172800

show dfreeexplore08 if (not(hasseen(username,"dfreeexplore08")))
#after dfreeexplore08 if sendemail ("login8", username, "Using StopAdvisor Today", append ("Dear ",signup.first_name,",\n\n Here is a link to take you to today's StopAdvisor session \n\n http://www.lifeguideonline.org/player/play/stopafullv1?jumpto=login&thiz=awelcome \n\n Remember if you forget your username or password email xxx@xxx for a new one. \n\n Best wishes \n\n StopAdvisor Team"),10) goto dmenu01 # after testing set to 172800

show dfreeexplore09 if (not(hasseen(username,"dfreeexplore09")))
#after dfreeexplore09 if sendemail ("login9", username, "Using StopAdvisor Today", append ("Dear ",signup.first_name,",\n\n Here is a link to take you to today's StopAdvisor session \n\n http://wusernameonline.org/player/play/stopafullv1?jumpto=login&thiz=awelcome \n\n Remember if you forget your username or password email xxx@xxx for a new one. \n\n Best wishes \n\n StopAdvisor Team"),10) goto dmenu01 # after testing set to 172800

show dfreeexplore10 if (not(hasseen(username,"dfreeexplore10")))
#after dfreeexplore10 if sendemail ("login10", username, "Using StopAdvisor Today", append ("Dear ",signup.first_name,",\n\n Here is a link to take you to today's StopAdvisor session \n\n http://www.lifeguideonline.org/player/play/stopafullv1?jumpto=login&thiz=awelcome \n\n Remember if you forget your username or password email xxx@xxx for a new one. \n\n Best wishes \n\n StopAdvisor Team"),10) goto dmenu01 # after testing set to 259200

show dfreeexplore11 if (not(hasseen(username,"dfreeexplore11")))
#after dfreeexplore11 if sendemail ("login11", username, "Using StopAdvisor Today", append ("Dear ",signup.first_name,",\n\n Here is a link to take you to today's StopAdvisor session \n\n http://www.lifeguideonline.org/player/play/stopafullv1?jumpto=login&thiz=awelcome \n\n Remember if you forget your username or password email xxx@xxx for a new one. \n\n Best wishes \n\n StopAdvisor Team"),10) goto dmenu01 # after testing set to 259200

show dfreeexplore12 if (not(hasseen(username,"dfreeexplore12")))
#after dfreeexplore12 if sendemail ("login12", username, "Using StopAdvisor Today", append ("Dear ",signup.first_name,",\n\n Here is a link to take you to today's StopAdvisor session \n\n http://www.lifeguideonline.org/player/play/stopafullv1?jumpto=login&thiz=awelcome \n\n Remember if you forget your username or password email xxx@xxx for a new one. \n\n Best wishes \n\n StopAdvisor Team"),10) goto dmenu01 # after testing set to 259200

show dfreeexplore13 if (not(hasseen(username,"dfreeexplore13")))

after dfreeexplore13 if (and(...
				loadvalue(username, "group") = "intervention",...
				sendemail("finished_sa", username, "Quit smoking internet study", append ("Hello ",dialogue_name,",\n\nYou have just completed the StopAdvisor ",...
					"programme - congratulations. You are still participating in University College London's Quit Smoking Internet Study. When consenting to participate in the study, ",...
					"you agreed to use a website whilst making a serious attempt to quit smoking, and then to complete some questionnaires about your smoking and the website.",...
					"\n\nYour next questionnaire isn't quite ready yet. We will email you again in the next few weeks to let you know when it is. Please log in again when you ",...
					"receive the email as the information is really important to us. \n\nBest wishes,\n\nProfessor Robert West and Professor Susan Michie \n--\nPlease do not reply to this email - if you want to contact us email stopsmoking@ucl.ac.uk."),1)...
				)) goto dmenu01

#S9 - This is essentially the last page to be shown in the Dialogues section 'dmenu01'

show dmenu01

#JB - to create variables for output on users progress
show dmenucontact
show dmenucredit

set yourprog to +(currenttime(), (-1 * (loadvalue(username, "quitdate"))))
set yourprogdays to (yourprog /86400)
set yourprogmoney to ((yourprog /86400) * 4.64)#* 4.64)

show dmenuprog01
set dmenuprog01.name to load signup.first_name for username
set dmenuprog01.showprogdays to decimalplaces (yourprogdays, 0)
set dmenuprog01.showprogmoney to decimalplaces (yourprogmoney, 2)

show dmenuprog01a
set dmenuprog01a.showprogdays to decimalplaces (yourprogdays, 0)

# JB - showing different health progress pages depending on how long they have been quit
#Where comparing currenttime and quitdate, the added time takes you to that point on the quit date
#Where 24 hours is 24*60*60 = 86400, any time after quit date is 86400+x  ; JB timings

#dmenuprog02 is for users who are on their first day post-quit(86400*2).
show dmenuprog02 if (currenttime() < +(loadvalue (username, "quitdate"), (172800)))

#dmenuprog03 is for users who after their first day (86400*2) but less than second (86400*3).
show dmenuprog03 if (and(...
							currenttime() >= +(loadvalue (username, "quitdate"), (172800)),...
							currenttime() < +(loadvalue (username, "quitdate"), (259200))...
							))

#dmenuprog04 is for users who after their second day (86400*3) but less than two weeks (86400*15).
show dmenuprog04 if (and(...
							currenttime() >= +(loadvalue (username, "quitdate"), (259200)),...
							currenttime() < +(loadvalue (username, "quitdate"), (1296000))...
							))

#dmenuprog04 is users who after their second week (86400*15)
show dmenuprog05 if (currenttime() >= +(loadvalue (username, "quitdate"), (1296000)))

#JB the code needed a second 'dummy' page (dmenufaq02) - when pressing back from any page which was shown
#after the top level it would jump there. Also meant important second menu level page was not
#next to page within its sub-levels.
show dmenufaq01
show dmenufaq02
show dmenufaqstopwith01
show dmenufaqstopwith02
show dmenufaqstopwith03
show dmenufaqstopwith04
show dmenufaqstopwith05
show dmenufaqstopwith06
show dmenufaqstopwith07
show dmenufaqstopwith08
show dmenufaqalltreats01
show dmenufaqstopwhy01
show dmenufaqstopwhy02
show dmenufaqstopwhy03
show dmenufaqstopwhy04
show dmenufaqstopwhy05
show dmenufaqstopwhy06
show dmenufaqstopwhy07
show dmenufaqstopprob01
show dmenufaqstopprob02
show dmenufaqstopprob03
show dmenufaqstopprob04
show dmenufaqstopprob05
show dmenufaqstopprob06
show dmenufaqstopprob07
show dmenufaqstopocc01
show dmenufaqstopocc02
show dmenufaqstopocc03
show dmenufaqstopocc04
show dmenufaqstopocc05
show dmenufaqchamp01
show dmenufaqchamp02
show dmenufaqchamp03
show dmenufaqchamp04
show dmenufaqchamp06
show dmenufaqchamp07
show dmenufaqchamp08
show dmenufaqchamp09
show dmenufaqchamp10
show dmenufaqchamp11
show dmenufaqnrtgen01
show dmenufaqnrtgen02
show dmenufaqnrtgen03
show dmenufaqnrtgen04
show dmenufaqnrtgen05
show dmenufaqnrtgen06
show dmenufaqnrtpat01
show dmenufaqnrtpat02
show dmenufaqnrtpat03
show dmenufaqnrtpat04
show dmenufaqnrtpat05
show dmenufaqnrtpat06
show dmenufaqnrtgum01
show dmenufaqnrtgum02
show dmenufaqnrtgum03
show dmenufaqnrtgum04
show dmenufaqnrtgum05
show dmenufaqnrtgum06
show dmenufaqnrtgum07
show dmenufaqnrtgum08
show dmenufaqtreat01
show dmenufaqtreat02
show dmenufaqtreat03
show dmenufaqtreat04
show dmenufaqtreat05
show dmenufaqzyb01
show dmenufaqzyb02
show dmenufaqzyb03
show dmenufaqzyb04
show dmenuaddict01
show dmenuaddict02
show dmenuaddict04
show dmenuaddict05
show dmenuaddict06
show dmenulink01
show dmenuteam01
show dmenuteam02
show dmenuteam03
show dmenuteam04
show dmenuteam05
show dmenuteam06
show dmenuteam07
show dmenurelax01
show dmenurelax02
show dmenumusic01
show dmenuquiz01
show dmenutest01
show dmenutest02
show dmenutest03
show dmenutest04
show dmenutest05
show dmenutest06
show dmenutest07
show dmenutest08
show dmenutest09
show dmenutest10
show dmenutest11
show dmenutest12
show dmenutest13
show dmenutest14
show dmenutest15
show dmenutest16
show dmenuexper01
show dmenuexper02
show dmenuexper03
show dmenuexper04
show dmenuexper05
show dmenuexper06
show dmenuexper07
show dmenuexper08
show dmenuexper09
show dmenuexper10
show dmenuexit

#JJ: RCT: Control group page and email "control"

show quitsmokingaccess
show quitsmoking

# JJ: Changing password pages
show resetpass
show welcomeeasyaccess
show easyaccess1
show easyaccess2
#JJ: This logic has been put on the page in the Error Mesage section
#after resetpass if (resetpassword(resetpass.email)) goto resetpass_confirm
show resetpass_confirm
show changepass
after changepass if (changepassword(username, changepass.oldpass, changepass.newpass)) goto changepass_confirm
show changepass_failed
show changepass_confirm
###

#JJ: RCT and Pilot - If intervention group logs in too early
show notreadya1
show notreadya2
show notreadya3
#JJ: RCT - If control group logs in too early (pages not needed for pilot) "control"
show notreadyb1
show notreadyb2

#show dplan01p1 if (not(hasseen(username, "dplan01p1")
#show dplan01p2 if (not(hasseen(username, "dplan01p1")
#show dplan01p2 if (not(hasseen(username, "dplan01p1")
#show dplan02p1 if (not(hasseen(username, "dplan02p1")
#show dplan02p2 if (not(hasseen(username, "dplan02p1")
#show dplan02p3 if (not(hasseen(username, "dplan02p1")
#show dplan03p1 if (not(hasseen(username, "dplan03p1")
#show dplan03p2 if (not(hasseen(username, "dplan03p1")
#show dplan03p3 if (not(hasseen(username, "dplan03p1")
#show dplan04p1 if (not(hasseen(username, "dplan04p1")
#show dplan04p2 if (not(hasseen(username, "dplan04p1")
#show dplan04p3 if (not(hasseen(username, "dplan04p1")
 
#after dsectionsplit02 if (and(loadvalue(username, "assessmentattempts") = 1, savevalue(username, "assessmentattempts", 1),savevalue(username, "firsttesttime", currenttime ()) )) goto dweekaheadandtips 
#after dsectionsplit02 if (and(loadvalue(username, "assessmentattempts") = 3, savevalue(username, "assessmentattempts", 3),savevalue(username, "firsttesttime", currenttime ()) )) goto dweekaheadandtips 

#show dacravhiconf01 if (daconf01.conf01 = "v_confident_01")
#show dhconlcrav01p1 if (dacravhiconf01.cravinghiconf01 = "not_bad_hiconf_01")
#show 
#show dacrav01
#p1p05.usemed01 = "notomed", p1p08confirmmed01.meds01 = "notusemed",p1p08confirmmed02.meds02 = "nomed02")

#DEMO FLOW LOGIC
#begin dialogue
#show choice01
#set choice01.name to (signup.first_name)
#show dawelcome
#show dasmok
#show dnsmok01p1
#show daconf
#show dlconf01p1
#show dacrav
#show dhcrav01p1
#show dhcrav01p2
#show dhcrav01p3
#show dhcrav01p4
#show dhcrav01p5
#show damed
#show medgumhi01
#show dplan01
#show dtakhom01
#show dend01
#show menu01

#end

# section for those who want more time to get medication

#show dhconlcrav01p1 if (not(hasseen(username, "dhconlcrav01p1")))
#show dhconlcrav02p1 if (not(hasseen(username, "dhconlcrav02p1")))
#show dhconlcrav02p2 if (not(hasseen(username, "dhconlcrav02p1")))
#show dhconlcrav03p1 if (not(hasseen(username, "dhconlcrav03p1")))